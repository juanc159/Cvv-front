import{_ as ue}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-BEoXigGb.js";import{_ as ie}from"./AppTextField.vue_vue_type_script_setup_true_lang-CsCt6hsx.js";import{_ as de}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-CkCvpngV.js";import{_ as re}from"./BtnBack.vue_vue_type_script_setup_true_lang-CTklSnVX.js";import{d as me,U as ce,q as pe,r as g,ax as _e,X as Z,M as fe,c as _,o as c,b as l,f as n,e as d,D as p,k as ve,F as M,p as N,x as D,E as ge,g as E,ad as U,a8 as q,C as T,af as w,ay as be,Y as ye,Z as Ve}from"./index-Dl5ek0NS.js";import{c as H}from"./createUrl-8-Jmup2S.js";import{b as ke,V as J}from"./VCard-rY6Noe6k.js";import{V as F}from"./VCardText--nLa4AsB.js";import{V as j,a as y}from"./VRow-D1RC1T7e.js";import{V as he}from"./VTable-Df_d6DeN.js";import{V as we}from"./VChip-CCQ5Itm2.js";import{V as xe}from"./VDialog-B_yTWE9k.js";import{V as Ce,a as Ae}from"./VToolbar-CoH-brNs.js";import{V as Me}from"./VForm-Cajyw0G7.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTooltip-CuN9trdF.js";import"./VOverlay-CcbbDn4H.js";import"./VImg-BPxl9zya.js";import"./forwardRefs-C-GTDzx5.js";import"./VInput-CmsT0ynG.js";import"./VTextField-DH2VakAb.js";/* empty css                   */import"./VCounter-BZS11_e3.js";import"./index-0F-JFElI.js";import"./VAvatar-sof9KUP9.js";/* empty css              */import"./dialog-transition-DX65Ay37.js";const S=x=>(ye("data-v-ee21f0d9"),x=x(),Ve(),x),De=S(()=>d("span",null,"Gestionar Notas",-1)),Fe={class:"text-center"},Se={class:"text-center"},$e=S(()=>d("p",{class:"text-center"}," Reporte de materia pendiente. ",-1)),Ie=S(()=>d("th",null,"No.",-1)),Re=S(()=>d("th",null,"ALUMNO",-1)),Be={key:0,class:"d-flex flex-column justify-center align-center"},Ee=["onClick"],Ue={key:0},qe=["colspan"],Te=me({__name:"Notes",setup(x){const $=ce(),C=pe(),{toast:L}=be(),Q=g({}),V=g(!1);g("");const z=g(),m=_e({form:!1,attempts:!1,submit:!1,momento:!1}),b=g({id:null,term_id:null,term_name:null,type_education_id:null,type_education_name:null,grade_name:null,grade_id:null,students:[]}),I=()=>{V.value=!V.value},k=g([]),u=g(null),A=Z(()=>{const o=new Map;return b.value.students.forEach(t=>{t.subjects.forEach(e=>{o.has(e.id)||o.set(e.id,{value:e.id,title:e.name})})}),Array.from(o.values())}),K=async()=>{var s;const t=`/pendingRegistration/${C.params.id}/show`;m.form=!0;const{data:e,response:i}=await w(H(t,{query:{company_id:$.company.id}}));m.form=!1,(s=i.value)!=null&&s.ok&&e.value?e.value.form&&(b.value={id:e.value.form.id||null,term_id:e.value.form.term_id||null,term_name:e.value.form.term_name||null,type_education_id:e.value.form.type_education_id||null,type_education_name:e.value.form.type_education_name||null,grade_name:e.value.form.grade_name||null,grade_id:e.value.form.grade_id||null,students:e.value.form.students||[]}):L("Error al cargar la sección","","danger")},R=async()=>{var s;const t=`/pendingRegistration/attempts/${C.params.id}`;m.attempts=!0;const{data:e,response:i}=await w(H(t,{query:{company_id:$.company.id}}));m.attempts=!1,(s=i.value)!=null&&s.ok&&e.value&&(k.value=e.value.data||[])},P=async o=>{var i,s;m.submit=!0;const{data:t,response:e}=await w("/pendingRegistration/attempts/store").post(o);m.submit=!1,(i=e.value)!=null&&i.ok&&t.value?t.value.code===200&&(await R(),V.value=!1):((s=t.value)==null?void 0:s.code)===422&&(Q.value=t.value.errors??{})},W=async(o,t)=>{var s,f;m.submit=!0;const{data:e,response:i}=await w(`/pendingRegistration/attempts/update/${o}`).post(t);m.submit=!1,(s=i.value)!=null&&s.ok&&e.value?e.value.code===200&&(await R(),V.value=!1):((f=e.value)==null?void 0:f.code)===422&&(Q.value=e.value.errors??{})},G=(o,t,e=null)=>{const i=o.student_id.value,s=t.value,f=k.value.filter(a=>a.student_id.value===i&&a.subject_id.value===s);u.value=e?{...e}:{pending_registration_id:C.params.id,student_id:{value:o.student_id.value,title:o.student_id.title},subject_id:{value:s,title:t.title},attempt_number:f.length+1,note:null,attempt_date:null},I()},ee=async()=>{var t;const o=await((t=z.value)==null?void 0:t.validate());if(o!=null&&o.valid){const e={pending_registration_id:C.params.id,student_id:u.value.student_id.value,subject_id:u.value.subject_id.value,attempt_number:u.value.attempt_number,note:u.value.note,attempt_date:u.value.attempt_date};u.value.id?await W(u.value.id,e):await P(e)}else L("Faltan campos por diligenciar","","danger")},h=Z(()=>Object.values(m).some(o=>o));fe(async()=>{await K(),await R()});const B=g(),te=o=>{B.value.componentData.title="¿Está seguro que desea eliminar el momento?",B.value.openModal(o)},ae=async o=>{var s;m.momento=!0;const t=`/pendingRegistration/attempts/delete/${o}`,{data:e,response:i}=await w(t).delete();m.momento=!1,(s=i.value)!=null&&s.ok&&e.value&&(k.value=k.value.filter(f=>f.id!==o))},O=(o,t)=>k.value.filter(e=>e.student_id.value===o&&e.subject_id.value===t).sort((e,i)=>i.attempt_number-e.attempt_number),le=(o,t)=>{const e=O(o,t);return e.length<4&&(e.length===0||!e[0].approved)};return(o,t)=>{const e=re,i=de,s=ie,f=ue;return c(),_("div",null,[l(J,{disabled:m.form,loading:m.form},{default:n(()=>[l(ke,{class:"d-flex justify-space-between"},{default:n(()=>[De]),_:1}),l(F,null,{default:n(()=>[l(j,null,{default:n(()=>[l(y,{cols:"12"},{default:n(()=>[d("h2",Fe,p(ve($).company.name),1),d("p",Se," Año Escolar: "+p(b.value.term_name||"N/A")+" | Fecha: "+p(new Date().toLocaleDateString("es-ES")),1),$e]),_:1})]),_:1}),l(j,null,{default:n(()=>[l(y,{cols:"12"},{default:n(()=>[d("h3",null," Sección: "+p(b.value.type_education_name||"N/A")+" - "+p(b.value.grade_name||"N/A"),1),l(he,{class:"bordered-table"},{default:n(()=>[d("thead",null,[d("tr",null,[Ie,Re,(c(!0),_(M,null,N(A.value,a=>(c(),_("th",{key:a.value},p(a.title),1))),128))])]),d("tbody",null,[(c(!0),_(M,null,N(b.value.students,(a,oe)=>{var X,Y;return c(),_("tr",{key:(X=a.student_id)==null?void 0:X.value},[d("td",null,p(oe+1),1),d("td",null,p(((Y=a.student_id)==null?void 0:Y.title)||"N/A"),1),(c(!0),_(M,null,N(A.value,v=>(c(),_("td",{key:v.value,class:ge({"bg-yellow-lighten-3":a.subjects.some(r=>r.id===v.value),"bg-grey-lighten-3":!a.subjects.some(r=>r.id===v.value)&&A.value.length>0})},[a.subjects.some(r=>r.id===v.value)?(c(),_("div",Be,[le(a.student_id.value,v.value)?(c(),E(U,{key:0,icon:"tabler-plus",size:"small",color:"primary",onClick:r=>G(a,v)},null,8,["onClick"])):D("",!0),(c(!0),_(M,null,N(O(a.student_id.value,v.value),(r,ne)=>(c(),E(we,{key:r.id,color:r.approved?"success":"warning",class:"ma-1"},{default:n(()=>[d("span",{onClick:se=>G(a,v,r),style:{cursor:"pointer"}}," Momento "+p(r.attempt_number)+": "+p(r.note)+" ("+p(r.attempt_date)+") ",9,Ee),ne===0?(c(),E(q,{key:0,color:"error",class:"ml-2",onClick:se=>te(r.id),icon:"tabler-trash"},null,8,["onClick"])):D("",!0)]),_:2},1032,["color"]))),128))])):D("",!0)],2))),128))])}),128)),b.value.students.length?D("",!0):(c(),_("tr",Ue,[d("td",{colspan:A.value.length+2,class:"text-center"}," No hay estudiantes seleccionados. ",8,qe)]))])]),_:1})]),_:1})]),_:1})]),_:1}),l(F,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:n(()=>[l(e,{disabled:h.value,loading:h.value},null,8,["disabled","loading"])]),_:1}),l(xe,{modelValue:V.value,"onUpdate:modelValue":t[8]||(t[8]=a=>V.value=a),"max-width":"500px",persistent:""},{default:n(()=>[l(i,{onClick:t[0]||(t[0]=a=>I())}),d("div",null,[l(Ce,{color:"primary"},{default:n(()=>[l(Ae,null,{default:n(()=>{var a;return[T(p((a=u.value)!=null&&a.id?"Editar Momento":"Agregar Momento"),1)]}),_:1})]),_:1})]),l(J,null,{default:n(()=>[l(F,null,{default:n(()=>[l(Me,{ref_key:"formValidation",ref:z},{default:n(()=>[l(j,null,{default:n(()=>[l(y,{cols:"12"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.student_id.title,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.student_id.title=a),label:"Estudiante",disabled:""},null,8,["modelValue"])]),_:1}),l(y,{cols:"12"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.subject_id.title,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.subject_id.title=a),label:"Materia",disabled:""},null,8,["modelValue"])]),_:1}),l(y,{cols:"12",md:"6"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.attempt_number,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value.attempt_number=a),disabled:"",label:"Número de Momento",type:"number",rules:[a=>!!a&&a>=1&&a<=4||"Debe ser entre 1 y 4"]},null,8,["modelValue","disabled","rules"])]),_:1}),l(y,{cols:"12",md:"6"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.note,"onUpdate:modelValue":t[4]||(t[4]=a=>u.value.note=a),label:"Nota (0-20)",type:"number",rules:[a=>!!a&&a>=0&&a<=20||"Debe estar entre 0 y 20"]},null,8,["modelValue","rules"])]),_:1}),l(y,{cols:"12",md:"6"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.attempt_date,"onUpdate:modelValue":t[5]||(t[5]=a=>u.value.attempt_date=a),label:"Fecha del Momento",type:"date",rules:[a=>!!a||"La fecha es obligatoria"]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(F,{class:"d-flex justify-end gap-3 flex-wrap"},{default:n(()=>[l(U,{loading:h.value,color:"secondary",variant:"tonal",onClick:t[6]||(t[6]=a=>I())},{default:n(()=>[l(q,{start:"",icon:"tabler-x"}),T(" Cancelar ")]),_:1},8,["loading"]),l(U,{disabled:h.value,loading:h.value,onClick:t[7]||(t[7]=a=>ee()),color:"primary"},{default:n(()=>[l(q,{start:"",icon:"tabler-device-floppy"}),T(" Guardar ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["disabled","loading"]),l(f,{ref_key:"refModalQuestion",ref:B,onSuccess:ae},null,512)])}}}),pt=Ne(Te,[["__scopeId","data-v-ee21f0d9"]]);export{pt as default};
