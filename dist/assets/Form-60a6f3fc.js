import{V as N,r as m,e as X}from"./VForm-9b23effe.js";import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-3fad4267.js";import{_ as Z}from"./AppSelect.vue_vue_type_script_setup_true_lang-d411851f.js";import{d as x,r as p,R as h,Q as ee,L as ae,w as le,ab as w,o as _,c as E,b as r,f as t,k as e,g as K,B as C,e as S,ae as T,F as re,m as oe,a6 as te,ac as se,p as ie,ay as ne,az as ue,aA as de,C as me}from"./index-b0a545ba.js";import{u as pe}from"./useImageUpload-a83b3d45.js";import{u as fe}from"./useCrudTeacherStore-3c4994cc.js";import{V as Ve}from"./VCardText-0a42020e.js";import{V as g}from"./VRow-e9822336.js";import{V as i}from"./VCol-46eb5194.js";import{V as ce}from"./VFileInput-b18d14e8.js";import{V as ve}from"./VImg-ebcb317a.js";import{V as ge}from"./VCard-cdef38b1.js";import{V as be}from"./VDataTable-418c9175.js";import{V as ye}from"./VChip-195a4914.js";import"./helpers-3edea678.js";import"./VField-519a5b1f.js";import"./VTextField-d0ddbc81.js";import"./VSelect-5df3832e.js";import"./VList-b116c9ae.js";import"./ssrBoot-5bd626fd.js";import"./VAvatar-7fd99590.js";import"./VDivider-14f927f3.js";import"./dialog-transition-b2da0c73.js";import"./VMenu-0b8336a1.js";import"./sweetalert2.esm.all-562d67d8.js";/* empty css              */const _e={style:{"block-size":"200px","inline-size":"200px"}},We=x({__name:"Form",setup(Ce){const U=ie(),{toast:$}=de(),k=p();p();const I=p(),b=fe(),G=h(),{form:s,loading:q,jobPositions:P,typeEducations:B,sections:A}=ee(b),d=p({}),y=p([]),f=p(pe()),R=["jpg","jpeg","png"];f.value.allowedExtensions=R;const M=async()=>{var a,v;s.value.company_id=G.company.id,s.value.complementaries=V.value;const l=await((a=k.value)==null?void 0:a.validate());if(l!=null&&l.valid){const n=await b.fetchSave();(n==null?void 0:n.code)===200&&(y.value=[],d.value={},f.value.clearData(),await((v=k.value)==null?void 0:v.resetValidation()),ne.push({name:"Teacher-Index"})),(n==null?void 0:n.code)===422&&(d.value=n.errors??{})}else $("Faltan Campos Por Diligenciar","","danger")},J=l=>{f.value.handleImageSelected(l),setTimeout(()=>{s.value.photo=f.value.imageFile},1e3)};ae(async()=>{b.clearForm(),await b.fetchDataForm(Number(U.params.id),U.params.action),V.value=JSON.parse(JSON.stringify(s.value.complementaries))}),le(s,(l,a)=>{l.id?y.value.photo=[]:y.value.photo=[m(f.value.imageUrl)]},{deep:!0});const u=p({grade_id:null,section_id:null,subjects:[]}),V=p([]),L=[{title:"Grado o nivel",key:"grade_name"},{title:"Sección",key:"section_name"},{title:"Materias",key:"subjects"},{title:"Acciones",key:"actions"}],O=()=>{u.value={grade_id:null,section_id:null,subjects:[]}};p([]),p([]);const H=async()=>{var a;const l=await((a=I.value)==null?void 0:a.validate());if(l!=null&&l.valid){const v=F.value.find(o=>o.value==u.value.grade_id),n=A.value.find(o=>o.value==u.value.section_id),c=D.value.filter(o=>u.value.subjects.includes(o.value));V.value.push({id:null,grade_id:u.value.grade_id,grade_name:v.title,section_id:u.value.section_id,section_name:n.title,subjects:c,delete:0}),O()}else $("Faltan Campos Por Diligenciar","","danger")},Q=l=>{V.value[l].id?V.value[l].delete=1:V.value.splice(l,1)},W=w(()=>V.value.filter(l=>l.delete!=1)),F=w(()=>s.value.type_education_id?B.value.find(l=>l.value==s.value.type_education_id).grades:[]),D=w(()=>u.value.grade_id?F.value.find(l=>l.value==u.value.grade_id).subjects:[]);return(l,a)=>{const v=ue,n=Z,c=Y;return _(),E("div",null,[r(ge,{loading:e(q).form,disabled:e(q).form},{default:t(()=>[r(Ve,null,{default:t(()=>[r(g,null,{default:t(()=>[r(i,null,{default:t(()=>[r(v,{"sub-title":"Formulario Teacher",action:String(l.$route.params.action),"btn-action":"list","validate-crud":!0,"btn-back":!0,onChangeScreenBack:l.$router.back},null,8,["action","onChangeScreenBack"])]),_:1})]),_:1}),r(e(N),{ref_key:"formValidation",ref:k,"lazy-validation":""},{default:t(()=>[r(g,null,{default:t(()=>[r(i,{cols:"12",sm:"3"},{default:t(()=>[r(n,{items:e(B),clearable:"",rules:["requiredValidator"in l?l.requiredValidator:e(m)],modelValue:e(s).type_education_id,"onUpdate:modelValue":a[0]||(a[0]=o=>e(s).type_education_id=o),label:"Tipo de educación"},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(n,{items:e(P),rules:["requiredValidator"in l?l.requiredValidator:e(m)],modelValue:e(s).job_position_id,"onUpdate:modelValue":a[1]||(a[1]=o=>e(s).job_position_id=o),label:"Cargo"},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(c,{clearable:"",modelValue:e(s).name,"onUpdate:modelValue":a[2]||(a[2]=o=>e(s).name=o),rules:["requiredValidator"in l?l.requiredValidator:e(m)],"error-messages":e(d).name,label:"Nombre",onKeypress:a[3]||(a[3]=o=>e(d).name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(c,{clearable:"",modelValue:e(s).last_name,"onUpdate:modelValue":a[4]||(a[4]=o=>e(s).last_name=o),rules:["requiredValidator"in l?l.requiredValidator:e(m)],"error-messages":e(d).last_name,label:"Apellido",onKeypress:a[5]||(a[5]=o=>e(d).last_name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(c,{clearable:"",modelValue:e(s).email,"onUpdate:modelValue":a[6]||(a[6]=o=>e(s).email=o),rules:["requiredValidator"in l?l.requiredValidator:e(m),"emailValidator"in l?l.emailValidator:e(X)],"error-messages":e(d).email,label:"Correo",onKeypress:a[7]||(a[7]=o=>e(d).email=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(c,{clearable:"",modelValue:e(s).password,"onUpdate:modelValue":a[8]||(a[8]=o=>e(s).password=o),"error-messages":e(d).password,label:"Contraseña",onKeypress:a[9]||(a[9]=o=>e(d).password="")},null,8,["modelValue","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(c,{clearable:"",modelValue:e(s).phone,"onUpdate:modelValue":a[10]||(a[10]=o=>e(s).phone=o),rules:["requiredValidator"in l?l.requiredValidator:e(m)],"error-messages":e(d).phone,label:"Teléfono",onKeypress:a[11]||(a[11]=o=>e(d).phone=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[(_(),K(ce,{accept:"image/*",rules:e(y).photo,key:e(f).key,onChange:a[12]||(a[12]=o=>J(o)),"onClick:clear":e(f).clearData},{label:t(()=>a[18]||(a[18]=[C(" Foto "),S("b",{class:"text-warning"},"*",-1)])),_:1},8,["rules","onClick:clear"]))]),_:1})]),_:1}),r(g,null,{default:t(()=>[r(i,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[S("div",_e,[r(ve,{src:e(f).imageUrl??e(s).photo},null,8,["src"])])]),_:1})]),_:1})]),_:1},512),r(e(N),{ref_key:"complementaryValidation",ref:I,"lazy-validation":""},{default:t(()=>[r(g,null,{default:t(()=>[r(i,{cols:"12"},{default:t(()=>a[19]||(a[19]=[S("h3",null,"Información complementaria",-1)])),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(n,{clearable:"",items:e(F),rules:["requiredValidator"in l?l.requiredValidator:e(m)],modelValue:e(u).grade_id,"onUpdate:modelValue":a[13]||(a[13]=o=>e(u).grade_id=o),label:"Grados y niveles"},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(n,{clearable:"",items:e(A),rules:["requiredValidator"in l?l.requiredValidator:e(m)],modelValue:e(u).section_id,"onUpdate:modelValue":a[14]||(a[14]=o=>e(u).section_id=o),label:"Secciones"},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(n,{clearable:"",multiple:"",rules:["requiredValidator"in l?l.requiredValidator:e(m)],items:e(D),modelValue:e(u).subjects,"onUpdate:modelValue":a[15]||(a[15]=o=>e(u).subjects=o),label:"Materias"},null,8,["rules","items","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:t(()=>[r(T,{color:"success",onClick:a[16]||(a[16]=o=>H())},{default:t(()=>a[20]||(a[20]=[C("Agregar")])),_:1})]),_:1}),r(i,{cols:"12"},{default:t(()=>[r(e(be),{headers:L,items:e(W),"items-per-page":999},{"item.subjects":t(({item:o})=>[(_(!0),E(re,null,oe(o.subjects,(j,z)=>(_(),K(ye,{color:"primary",class:"mr-2",key:z},{default:t(()=>[C(me(j.title),1)]),_:2},1024))),128))]),"item.actions":t(({item:o,index:j})=>[r(T,{icon:"",size:"x-small",color:"error",variant:"text",onClick:z=>Q(j)},{default:t(()=>[r(te,{size:"22",icon:"tabler-trash"}),r(se,{location:"top",transition:"scale-transition",activator:"parent",text:"Eliminar"})]),_:2},1032,["onClick"])]),bottom:t(()=>a[21]||(a[21]=[])),_:1},8,["items"])]),_:1})]),_:1})]),_:1},512),r(g,null,{default:t(()=>[r(i,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[r(T,{loading:e(q).form,color:"primary",onClick:a[17]||(a[17]=o=>M())},{default:t(()=>a[22]||(a[22]=[C(" Guardar ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading","disabled"])])}}});export{We as default};
