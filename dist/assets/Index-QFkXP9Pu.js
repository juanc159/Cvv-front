import{_ as ve}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-BTbV_m4u.js";import{r as ge}from"./validators-aR-Q5zwJ.js";import{d as ae,r as m,bd as ye,be as W,bf as be,a as he,h,o as u,f as a,b as e,ad as O,l as o,e as f,c as A,a7 as oe,a9 as $,D as g,F as H,q as K,aT as U,y as P,E as Y,aH as Ve,ac as we,V as ke,aa as Ce,Y as xe,N as De,b6 as Se,ab as Ne,b7 as Z,b5 as Ae}from"./index-BaV16FCr.js";import{_ as te}from"./AppSelect.vue_vue_type_script_setup_true_lang-CxyaLK82.js";import{V as N,b as $e,a as I}from"./VCard-Cu9KQF3n.js";import{V as J}from"./VForm-Cakuzm8b.js";import{V as y,a as _}from"./VRow-BFfZTps2.js";import{V}from"./VCardText-CDLeL-c9.js";import{V as Ee}from"./VImg-Dx556MLp.js";import{V as Fe}from"./VSpacer-Cwv-1Gxm.js";import{_ as qe}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-Di4ag9Hi.js";import{u as Be}from"./useFileUpload-fXYGTIKH.js";import{c as ze}from"./createUrl-CKSj2AD3.js";import{b as X}from"./helpers-C0EwqvCj.js";import{V as Me}from"./VFileInput-D7OBFRer.js";import{V as ee}from"./VSwitch-DSGlLTq5.js";import{V as Ue}from"./VDivider-kUj94-mG.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-D7H4qe_I.js";import"./VDialog-CPKJ-TIk.js";import"./dialog-transition-DCflx0be.js";import"./VSelect-Bjp9kztP.js";import"./VTextField-CL-0Z5oA.js";/* empty css                   */import"./VCounter-C2NgZD61.js";import"./VList-RAYwNb6B.js";import"./ssrBoot-BMrzvYku.js";import"./VAvatar-BBYtPJKV.js";import"./VMenu-Bue79pR2.js";import"./VCheckboxBtn-Bs1gRmrB.js";import"./VSelectionControl-CEJbriLn.js";import"./VChip-DTwUZwmi.js";/* empty css              */import"./filter-NG0Xi5ff.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import"./index-0F-JFElI.js";import"./constants-2GBt7OCP.js";const Pe={class:"flex"},je={class:"w-full h-auto relative"},Ie={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},Te=f("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquí. ",-1),Re=f("span",{class:"text-disabled"},"o",-1),Qe={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},Le={class:"mt-2"},Ge={class:"clamp-text text-wrap"},Oe={key:0,class:"mt-2"},Ze=f("span",null,"Cargando...",-1),He={key:1,class:"mt-2 text-success"},Ke=f("span",null,"¡Archivo cargado exitosamente!",-1),Ye=[Ke],Je={key:2,class:"mt-2 text-danger"},We=f("span",null,"Error al cargar el archivo",-1),Xe=[We],ea=ae({__name:"DragAndDrop",setup(le){const T=m(),w=m(),p=m([]),{open:E,onChange:l}=ye({});function b(v){v==null||v.forEach(d=>{if(d.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}p.value.push({file:d,url:W(d).value??"",progress:void 0,status:"pending"})})}l(v=>{if(v)for(const d of v)p.value.push({file:d,url:W(d).value??"",progress:void 0,status:"pending"})}),be(w,b);const C=async()=>{var d,x;const v=await((d=T.value)==null?void 0:d.validate());if(v!=null&&v.valid){if(p.value.length===0){alert("No hay archivos para guardar");return}q.value=!0;for(let D=0;D<p.value.length;D++){const c=p.value[D];c.status="uploading";try{const k=new FormData;k.append("file",c.file),k.append("field",B.value);const{data:j,response:R}=await U("/savefiles").post(k);(x=R.value)!=null&&x.ok&&j.value&&(c.status="completed",c.progress=100)}catch(k){c.status="failed",c.progress=void 0,console.error("Error al guardar el archivo",c.file.name,k),alert(`Error al guardar el archivo ${c.file.name}`)}}q.value=!1}},q=m(!1),B=m(),F=[{title:"Foto",value:"photo"},{title:"Boletín",value:"boletin"}];return(v,d)=>{const x=te,D=he("IconBtn");return u(),h(N,{class:"mb-6",title:"Archivos"},{default:a(()=>[e(V,null,{default:a(()=>[e(J,{ref_key:"formValidation",ref:T,onSubmit:O(()=>{},["prevent"])},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",md:"6"},{default:a(()=>[e(x,{requiredField:!0,label:"Campo",items:F,modelValue:B.value,"onUpdate:modelValue":d[0]||(d[0]=c=>B.value=c),rules:["requiredValidator"in v?v.requiredValidator:o(ge)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(V,null,{default:a(()=>[f("div",Pe,[f("div",je,[f("div",{ref_key:"dropZoneRef",ref:w,class:"cursor-pointer",onClick:d[2]||(d[2]=()=>o(E)())},[p.value.length===0?(u(),A("div",Ie,[e(D,{variant:"tonal",class:"rounded-sm"},{default:a(()=>[e(oe,{icon:"tabler-upload"})]),_:1}),Te,Re,e($,{variant:"tonal"},{default:a(()=>[g("Explorar archivos")]),_:1})])):(u(),A("div",Qe,[e(y,{class:"match-height w-100"},{default:a(()=>[(u(!0),A(H,null,K(p.value,(c,k)=>(u(),h(_,{key:k,cols:"12",sm:"4"},{default:a(()=>[e(N,{ripple:!1,border:"",class:"d-flex flex-column"},{default:a(()=>[e(V,{onClick:d[1]||(d[1]=O(()=>{},["stop"]))},{default:a(()=>[e(Ee,{src:c.url,width:"150px",height:"100px"},null,8,["src"]),f("div",Le,[f("span",Ge,Y(c.file.name),1),f("span",null,Y(c.file.size/1e3)+" KB ",1)]),c.status==="uploading"?(u(),A("div",Oe,[e(Ve,{size:24,value:c.progress,color:"primary"},null,8,["value"]),Ze])):P("",!0),c.status==="completed"?(u(),A("div",He,Ye)):P("",!0),c.status==="failed"?(u(),A("div",Je,Xe)):P("",!0)]),_:2},1024),e(Fe),e($e,null,{default:a(()=>[e($,{variant:"outlined",block:"",onClick:O(j=>p.value.splice(k,1),["stop"])},{default:a(()=>[g(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e($,{disabled:q.value,loading:q.value,color:"primary",onClick:C},{default:a(()=>[g(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),aa=f("b",{class:"text-warning"},"*",-1),oa={class:"demo-space-x"},ta={class:"demo-space-x"},la={class:"demo-space-x"},sa={class:"demo-space-x"},Ra=ae({__name:"Index",setup(le){const T=we(),w=ke(),{toast:p}=Ae(),E=m(Be());E.value.allowedExtensions=["xls","xlsx"];const l=Ce({form:!1,download_notes:!1,block_uploading_of_grades_to_teachers:!1,delete_all_student_grade_scores_permission:!1,viewing_notes:!1}),b=m({company_id:null,type_education_id:null,teacher_id:null,archive:null}),C=m({}),q=m(),B=m(),F=m([]),v=m([]),d=m(!1),x=m({}),D=s=>!!s||"Campo requerido",c=async()=>{var t;b.value.archive=E.value.imageFile,b.value.company_id=w.company.id;const s=await((t=q.value)==null?void 0:t.validate());if(s!=null&&s.valid){const n=new FormData;n.append("company_id",String(b.value.company_id)),n.append("user_id",String(w.user.id)),n.append("type_education_id",String(b.value.type_education_id)),n.append("teacher_id",String(b.value.teacher_id||"")),n.append("archive",b.value.archive),l.form=!0;try{const{data:i,response:S}=await Z("/import-consolidated-notes").post(n);S.status==200&&i?i.status==="success"?T.startLoading(i.batch_id)?(p("Importación iniciada correctamente","","success"),b.value={company_id:w.company.id,type_education_id:null,teacher_id:null,archive:null},E.value.clearData()):p("Error iniciando la importación","","danger"):i.status==="error"&&(p("Error en la importación",i.message,"danger"),i.errors&&(C.value=i.errors)):p("Error en la respuesta del servidor","","danger")}catch(i){console.error("❌ [FORM] Error en submitForm:",i),p("Error al procesar el archivo","","danger")}finally{l.form=!1}}else p("Faltan Campos Por Diligenciar","","danger")},k=async()=>{l.form=!0;const{data:s,response:t}=await Z("note-dataForm").get({params:{company_id:w.company.id}});t.status==200&&s&&(F.value=s.typeEducations,d.value=s.blockData,v.value=s.teachers),l.form=!1},j=s=>!0,R=async()=>{var n;const{data:s,response:t}=await U("/type_educations/visualization/show").get();(n=t.value)!=null&&n.ok&&s.value&&(x.value=s.value.selectedNotes)},z=m({type_education_id:null}),se=async()=>{var t,n;const s=await((t=B.value)==null?void 0:t.validate());if(s!=null&&s.valid){l.download_notes=!0;const i=F.value.find(r=>r.value==z.value.type_education_id),{data:S,response:M}=await U(ze("/note-downloadAllConsolidated",{query:{type_education_id:z.value.type_education_id,company_id:w.company.id}}));l.download_notes=!1,(n=M.value)!=null&&n.ok&&S.value&&X(S.value.excel,"Consolidado "+(i==null?void 0:i.title))}else p("Faltan Campos Por Diligenciar","","danger")},ne=async()=>{var t;const s=await((t=B.value)==null?void 0:t.validate());if(s!=null&&s.valid){l.download_notes=!0;const n=F.value.find(M=>M.value==z.value.type_education_id),{response:i,data:S}=await Z("/note-downloadConsolidatedPocentage").get({params:{type_education_id:z.value.type_education_id,company_id:w.company.id}});l.download_notes=!1,S.code==200&&X(S.excel,"Consolidado porcentajes "+(n==null?void 0:n.title))}else p("Faltan Campos Por Diligenciar","","danger")},re=async s=>{var i;l.block_uploading_of_grades_to_teachers=!0;const{data:t,response:n}=await U("/note-blockPayrollUpload").post({value:s});(i=n.value)!=null&&i.ok&&t.value,l.block_uploading_of_grades_to_teachers=!1},de=async s=>{var i;l.block_uploading_of_grades_to_teachers=!0;const{data:t,response:n}=await U("/note-resetOptionDownloadPdf").post({company_id:w.company.id});(i=n.value)!=null&&i.ok&&t.value,l.block_uploading_of_grades_to_teachers=!1},ie=xe(()=>d.value?"Sí":"No"),ue=async()=>{l.viewing_notes=!0;const{data:s,response:t}=await U("/type_educations/visualization/store").post({selectedNotes:x.value});l.viewing_notes=!1},Q=m(),ce=()=>{Q.value.openModal(),Q.value.componentData.title="Esta seguro que desea activar a todos los estudiantes en un estado insolventes"};De(async()=>{await R(),await k()});const L=m(),_e=()=>{L.value.openModal(),L.value.componentData.title="Esta seguro que desea eliminar todas las notas de los estudiantes"},pe=async()=>{var n;l.delete_all_student_grade_scores_permission=!0;const{data:s,response:t}=await U("/note-deleteAllStudentGradeScores").post({company_id:w.company.id});(n=t.value)!=null&&n.ok&&s.value,l.delete_all_student_grade_scores_permission=!1};return(s,t)=>{const n=te,i=qe,S=ea,M=ve;return u(),A("div",null,[(u(),h(N,{key:0,disabled:o(l).form,loading:o(l).form},{default:a(()=>[e(I,{"primary-title":""},{default:a(()=>[g(" Cargar Notas ")]),_:1}),e(V,null,{default:a(()=>[e(o(J),{ref_key:"formValidation",ref:q,"lazy-validation":""},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[e(n,{clearable:"",modelValue:o(b).type_education_id,"onUpdate:modelValue":t[0]||(t[0]=r=>o(b).type_education_id=r),rules:[D],"error-messages":o(C).type_education_id,label:"Tipo",onChange:t[1]||(t[1]=r=>o(C).type_education_id=""),requiredField:!0,items:o(F)},null,8,["modelValue","rules","error-messages","items"])]),_:1}),e(_,{cols:"12",sm:"4"},{default:a(()=>[e(Se,null,{default:a(()=>[g("Archivo "),aa]),_:1}),(u(),h(Me,{key:o(E).key,onChange:o(E).handleImageSelected,"onClick:clear":o(E).clearData,rules:[D]},null,8,["onChange","onClick:clear","rules"]))]),_:1}),e(_,{cols:"12",sm:"4"},{default:a(()=>[e(i,{clearable:"",modelValue:o(b).teacher_id,"onUpdate:modelValue":t[2]||(t[2]=r=>o(b).teacher_id=r),"error-messages":o(C).teacher_id,label:"Docente",onChange:t[3]||(t[3]=r=>o(C).teacher_id=""),items:o(v)},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e($,{loading:o(l).form,color:"primary",onClick:t[4]||(t[4]=r=>c())},{default:a(()=>[e(oe,{start:"",icon:"tabler-upload"}),g(" Cargar Archivo ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),(u(),h(N,{key:1,disabled:o(l).download_notes,loading:o(l).download_notes,class:"mt-3"},{default:a(()=>[e(I,{"primary-title":""},{default:a(()=>[g("Descargar Notas")]),_:1}),e(V,null,{default:a(()=>[e(o(J),{ref_key:"formValidationDownload",ref:B,"lazy-validation":""},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[e(n,{clearable:"",modelValue:o(z).type_education_id,"onUpdate:modelValue":t[5]||(t[5]=r=>o(z).type_education_id=r),rules:[D],"error-messages":o(C).type_education_id,label:"Tipo",onChange:t[6]||(t[6]=r=>o(C).type_education_id=""),requiredField:!0,items:o(F)},null,8,["modelValue","rules","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-start gap-3 flex-wrap mt-5"},{default:a(()=>[e($,{loading:o(l).download_notes,disabled:o(l).download_notes,color:"primary",onClick:t[7]||(t[7]=r=>se())},{default:a(()=>[g(" Descargar Consolidado ")]),_:1},8,["loading","disabled"]),o(z).type_education_id=="3"?(u(),h($,{key:0,loading:o(l).download_notes,disabled:o(l).download_notes,color:"primary",onClick:t[8]||(t[8]=r=>ne())},{default:a(()=>[g(" Descargar Reporte % ")]),_:1},8,["loading","disabled"])):P("",!0)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),e(y,null,{default:a(()=>[e(_,{cols:"4"},{default:a(()=>[j("note.block_uploading_of_grades_to_teachers")?(u(),h(N,{key:0,disabled:o(l).block_uploading_of_grades_to_teachers,loading:o(l).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(I,{"primary-title":""},{default:a(()=>[g("Bloquear carga de notas a los profesores")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[f("div",oa,[e(ee,{modelValue:o(d),"onUpdate:modelValue":[t[9]||(t[9]=r=>Ne(d)?d.value=r:null),t[10]||(t[10]=r=>re(r))],label:o(ie),color:"success"},null,8,["modelValue","label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):P("",!0)]),_:1}),e(_,{cols:"4"},{default:a(()=>[j("note.reset_option_download_pdf")?(u(),h(N,{key:0,disabled:o(l).block_uploading_of_grades_to_teachers,loading:o(l).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(I,{"primary-title":""},{default:a(()=>[g("Reiniciar opción descarga pdf y boletin")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[f("div",ta,[e($,{color:"primary",onClick:ce},{default:a(()=>[g("Reiniciar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):P("",!0)]),_:1}),e(_,{cols:"4"},{default:a(()=>[j("note.delete_all_student_grade_scores_permission")?(u(),h(N,{key:0,disabled:o(l).delete_all_student_grade_scores_permission,loading:o(l).delete_all_student_grade_scores_permission,class:"mt-3"},{default:a(()=>[e(I,{"primary-title":""},{default:a(()=>[g("Borrar todas las notas de los alumnos")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[f("div",la,[e($,{color:"primary",onClick:_e},{default:a(()=>[g("Eliminar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):P("",!0)]),_:1})]),_:1}),(u(),h(N,{key:2,disabled:o(l).viewing_notes,loading:o(l).viewing_notes,class:"mt-3",title:"Visualización de las notas"},{default:a(()=>[(u(!0),A(H,null,K(o(F),r=>(u(),h(V,{key:r.value},{default:a(()=>[e(Ue),e(y,null,{default:a(()=>[e(_,null,{default:a(()=>[f("span",null,Y(r.title),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:a(()=>[(u(!0),A(H,null,K(r.cantNotes,(G,me)=>(u(),h(_,{cols:"12",sm:"4",key:me},{default:a(()=>[f("div",sa,[e(ee,{modelValue:o(x)[r.value]["note_"+G],"onUpdate:modelValue":fe=>o(x)[r.value]["note_"+G]=fe,label:"Nota "+G,color:"success"},null,8,["modelValue","onUpdate:modelValue","label"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128)),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e($,{loading:o(l).form,disabled:o(l).form,color:"primary",onClick:t[11]||(t[11]=r=>ue())},{default:a(()=>[g(" Guardar Visualización ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])),(u(),h(N,{key:3,title:"Carga de archivos masivos",class:"mt-3"},{default:a(()=>[e(V,null,{default:a(()=>[e(S)]),_:1})]),_:1})),e(M,{ref_key:"refModalQuestion",ref:Q,onSuccess:de},null,512),e(M,{ref_key:"refModalQuestionDeleteNoteStudents",ref:L,onSuccess:pe},null,512)])}}});export{Ra as default};
