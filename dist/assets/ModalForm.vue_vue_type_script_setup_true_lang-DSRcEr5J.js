import{r as f,c as F,e as G}from"./validators-DuXW2sp9.js";import{d as I,V as J,U as L,r as t,Y as q,c as Y,b as o,f as d,aI as z,l as e,aJ as k,o as U,e as H,D as g,E as K,a9 as O,h as Q,y as W,a8 as B}from"./index-BjO4aHmb.js";import{_ as X}from"./AppSelect.vue_vue_type_script_setup_true_lang-BC5XkvOm.js";import{_ as Z}from"./AppTextField.vue_vue_type_script_setup_true_lang-B39xe8cM.js";import{_ as h}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-DTpYiiFY.js";import{c as ee}from"./createUrl-aOI1u8hS.js";import{V as ae}from"./VDialog-fQSA88d4.js";import{V as le}from"./VCard-Vu9nndUs.js";import{V as re,a as oe}from"./VToolbar-BLl-6srQ.js";import{V as D}from"./VCardText-C-uXbslX.js";import{V as se}from"./VForm-DbUEs9NO.js";import{V as de,a as p}from"./VRow-B3OxSNxL.js";const _e=I({__name:"ModalForm",emits:["execute"],setup(ie,{expose:T,emit:$}){const A=J(),{company:w}=L(A),V=t({}),_=t(),N=$,y=t("Crear usuario"),c=t(!1),n=t(!1),i=t(!1),r=t({id:null,name:null,surname:null,email:null,password:null,confirmedPassword:null,role_id:null,company_id:null}),P=()=>{for(const a in r.value)r.value[a]=null},v=()=>{c.value=!c.value},S=async(a=null,l=!1)=>{n.value=l,P(),v(),y.value=a?"Editar usuario":"Crear usuario",r.value.id=a,r.value.company_id=w.value.id,await R()},C=t([]),M=t([]),R=async()=>{var u;const a=r.value.id?`/user/${r.value.id}/edit`:"/user/create";i.value=!0;const{data:l,response:m}=await k(ee(a,{query:{company_id:w.value.id}}));i.value=!1,(u=m.value)!=null&&u.ok&&l.value&&(C.value=l.value.roles,M.value=l.value.companies,l.value.form&&(r.value=l.value.form))},E=async()=>{var l,m;const a=await((l=_.value)==null?void 0:l.validate());if(a!=null&&a.valid){const u=r.value.id?`/user/update/${r.value.id}`:"/user/store";i.value=!0;const{response:b,data:s}=await k(u).post(r.value);i.value=!1,(m=b.value)!=null&&m.ok&&s.value&&(N("execute"),v())}},x=q(()=>r.value.id?[]:[a=>f(a)]),j=q(()=>r.value.id?[a=>F(r.value.password,a)]:[a=>f(a),a=>F(r.value.password,a)]);return T({openModal:S}),(a,l)=>{const m=h,u=Z,b=X;return U(),Y("div",null,[o(ae,{modelValue:e(c),"onUpdate:modelValue":l[7]||(l[7]=s=>z(c)?c.value=s:null),overlay:!1,"max-width":"40rem",transition:"dialog-transition",persistent:""},{default:d(()=>[o(m,{onClick:v}),o(le,{loading:e(i),disabled:e(i),class:"w-100"},{default:d(()=>[H("div",null,[o(re,{color:"primary"},{default:d(()=>[o(oe,null,{default:d(()=>[g(K(e(y)),1)]),_:1})]),_:1})]),o(D,null,{default:d(()=>[o(se,{ref_key:"refForm",ref:_,onSubmit:O(()=>{},["prevent"])},{default:d(()=>[o(de,null,{default:d(()=>[o(p,{cols:"12"},{default:d(()=>[o(u,{requiredField:!0,clearable:"",disabled:e(n),label:"Nombres",rules:["requiredValidator"in a?a.requiredValidator:e(f)],modelValue:e(r).name,"onUpdate:modelValue":l[0]||(l[0]=s=>e(r).name=s),"error-messages":e(V).name},null,8,["disabled","rules","modelValue","error-messages"])]),_:1}),o(p,{cols:"12"},{default:d(()=>[o(u,{requiredField:!0,clearable:"",disabled:e(n),label:"Apellidos",rules:["requiredValidator"in a?a.requiredValidator:e(f)],modelValue:e(r).surname,"onUpdate:modelValue":l[1]||(l[1]=s=>e(r).surname=s),"error-messages":e(V).surname},null,8,["disabled","rules","modelValue","error-messages"])]),_:1}),o(p,{cols:"12"},{default:d(()=>[o(u,{requiredField:!0,clearable:"",disabled:e(n),label:"Correo",type:"email",rules:["requiredValidator"in a?a.requiredValidator:e(f),"emailValidator"in a?a.emailValidator:e(G)],modelValue:e(r).email,"onUpdate:modelValue":l[2]||(l[2]=s=>e(r).email=s),"error-messages":e(V).email},null,8,["disabled","rules","modelValue","error-messages"])]),_:1}),o(p,{cols:"12"},{default:d(()=>[o(u,{requiredField:!0,clearable:"",disabled:e(n),label:"Contraseña",type:"password",rules:e(x),modelValue:e(r).password,"onUpdate:modelValue":l[3]||(l[3]=s=>e(r).password=s),"error-messages":e(V).password},null,8,["disabled","rules","modelValue","error-messages"])]),_:1}),o(p,{cols:"12"},{default:d(()=>[o(u,{requiredField:!0,label:"Confirmar Contraseña",type:"password",rules:e(j),modelValue:e(r).confirmedPassword,"onUpdate:modelValue":l[4]||(l[4]=s=>e(r).confirmedPassword=s)},null,8,["rules","modelValue"])]),_:1}),o(p,{cols:"12"},{default:d(()=>[o(b,{requiredField:!0,items:e(C),label:"Rol",rules:["requiredValidator"in a?a.requiredValidator:e(f)],modelValue:e(r).role_id,"onUpdate:modelValue":l[5]||(l[5]=s=>e(r).role_id=s),"error-messages":e(V).role_id,clearable:"",disabled:e(n)},null,8,["items","rules","modelValue","error-messages","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),o(D,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:d(()=>[o(B,{color:"secondary",disabled:e(i),loading:e(i),onClick:v},{default:d(()=>[g("Cancelar ")]),_:1},8,["disabled","loading"]),e(n)?W("",!0):(U(),Q(B,{key:0,disabled:e(i),loading:e(i),onClick:l[6]||(l[6]=s=>E()),color:"primary"},{default:d(()=>[g(" Guardar ")]),_:1},8,["disabled","loading"]))]),_:1})]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"])])}}});export{_e as _};
