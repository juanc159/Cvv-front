import{r as Q}from"./validators-COK9GSQm.js";import{cx as W,r as V,d as z,R as S,a as X,g as x,o as h,f as i,b as l,c as F,p as D,F as L,x as Y,k as n,ae as R,z as Z,U as ee,ax as te,af as A,e as I,D as se,ad as w,C as P}from"./index-D4-NfYnJ.js";import{e as ae,a as B,V as le}from"./VList-DtEMIpY0.js";import{V as G}from"./VSwitch-BBUEg59e.js";import{_ as ie}from"./AppTextField.vue_vue_type_script_setup_true_lang-vc_62UIO.js";import{_ as oe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-yDwemtKd.js";import{V as re}from"./VDialog-CKcLcjnB.js";import{V as ne}from"./VCard-vH-sQLkq.js";import{V as U}from"./VCardText-1IxvLWK9.js";import{V as de}from"./VForm-BtA9WIm2.js";import{V as q,a as N}from"./VRow-bHrgtuSs.js";import{V as j}from"./VSkeletonLoader-DJ59nXoN.js";const M=W("useRoleStore",{state:()=>({arrayFather:V([]),selectedFather:V([]),selectedElements:V([]),keyIdComparation:V("id"),keyArray:V("permissions")}),getters:{},actions:{clearPermissionsSelected(){this.selectedElements=[1]},handleCardCheckboxChange(s){this.selectedFather.includes(s)?this.selectAllPermissions(s):this.deselectAllPermissions(s)},selectAllPermissions(s){const d=this.arrayFather.findIndex(t=>t[this.keyIdComparation]==s);d!==-1?this.arrayFather[d][this.keyArray].forEach(m=>{this.selectedElements.includes(m[this.keyIdComparation])||this.selectedElements.push(m.id)}):this.arrayFather.forEach(t=>{this.searchInChildrenToAdd(t,s)})},searchInChildrenToAdd(s,d){s.children.forEach(t=>{t[this.keyIdComparation]===d&&!this.selectedElements.includes(t.id)&&this.selectedElements.push(t.id),t.children&&t.children.length>0&&this.searchInChildrenToAdd(t,d)})},deselectAllPermissions(s){const d=t=>{const m=t.findIndex(p=>p[this.keyIdComparation]==s);if(m!==-1){const p=t[m][this.keyArray].map(g=>g.id);return this.selectedElements=this.selectedElements.filter(g=>!p.includes(g)),!0}for(const p of t)if(p.children&&p.children.length>0&&d(p.children))return!0;return!1};d(this.arrayFather)}}}),ue=z({__name:"ListGroup",props:{father:{required:!0,type:Object}},setup(s){const d=M(),{selectedElements:t,selectedFather:m}=S(d),{father:p}=s;return(g,v)=>{const _=X("ListGroup",!0);return h(),x(ae,null,{activator:i(({props:c})=>[l(B,Z(c,{title:s.father.title,"prepend-icon":s.father.icon}),null,16,["title","prepend-icon"])]),default:i(()=>[l(B,null,{default:i(()=>[(h(!0),F(L,null,D(s.father.permissions,({id:c,description:y,check_state:O},e)=>(h(),F(L,{key:e},[c!=1&&e==0?(h(),x(G,{key:0,class:"mb-2",label:"Todos",value:s.father.id,id:"selectAll-"+s.father.id,modelValue:n(m),"onUpdate:modelValue":[v[0]||(v[0]=o=>R(m)?m.value=o:null),o=>n(d).handleCardCheckboxChange(s.father.id)]},null,8,["value","id","modelValue","onUpdate:modelValue"])):Y("",!0),l(G,{disabled:c==1,class:"my-0 py-0",label:y,value:c,id:`permissions-${c}`,modelValue:n(t),"onUpdate:modelValue":v[1]||(v[1]=o=>R(t)?t.value=o:null)},null,8,["disabled","label","value","id","modelValue"])],64))),128))]),_:1}),(h(!0),F(L,null,D(s.father.children,(c,y)=>(h(),x(_,{key:y,father:c},null,8,["father"]))),128))]),_:1})}}}),me={class:"text-h4 text-center mb-2"},ce=I("p",{class:"text-body-1 text-center mb-6"},"Establecer permisos del rol",-1),fe=I("h5",{class:"text-h5 my-6"},"Permisos de rol",-1),Le=z({__name:"ModalForm",emits:["updateDataTable"],setup(s,{expose:d,emit:t}){const m=ee(),{company:p}=S(m),g=t,v=V({}),_=M(),{selectedElements:c,arrayFather:y,selectedFather:O}=S(_),e=te({isDialogVisible:!1,isLoading:!1,titleForm:"Crear",menus:[]}),o=V({id:null,description:null,company_id:null,permissions:[]}),k=(u=!1)=>{e.isDialogVisible=u},T=()=>{o.value.id=null,o.value.description=null,o.value.permissions=[]},H=async()=>{_.clearPermissionsSelected(),T(),e.isLoading=!0,k(!0),e.titleForm="Crear";const{data:u,isFetching:a}=await A("role/create").get();e.isLoading=a.value,o.value.company_id=p.value.id,e.menus=u.value.menus,y.value=e.menus},J=async({id:u})=>{var b,r;_.clearPermissionsSelected(),T(),e.isLoading=!0,k(!0),e.titleForm="Editar";const{response:a,data:f,isFetching:C}=await A(`role/${u}/edit`).get();e.isLoading=C.value,(b=a.value)!=null&&b.ok&&((r=f.value)==null?void 0:r.code)==200&&(e.menus=f.value.menus,o.value.id=f.value.role.id,o.value.description=f.value.role.description,o.value.company_id=f.value.role.company_id,c.value=f.value.role.permissions,y.value=e.menus)},K=async()=>{var a,f,C;o.value.permissions=c.value;const u=await((a=$.value)==null?void 0:a.validate());if(u!=null&&u.valid){e.isLoading=!0;const{response:b,data:r,isFetching:E}=await A("role").post(o.value);e.isLoading=E.value,(f=b.value)!=null&&f.ok&&((C=r.value)==null?void 0:C.code)==200&&(g("updateDataTable"),k(!1)),r.value.code===422&&(v.value=r.value.errors??{})}},$=V();return d({handleCreate:H,handleEdit:J}),(u,a)=>{const f=oe,C=ie,b=ue;return h(),x(re,{modelValue:n(e).isDialogVisible,"onUpdate:modelValue":a[5]||(a[5]=r=>n(e).isDialogVisible=r),"max-width":"1080px",persistent:"",transition:"dialog-transition"},{default:i(()=>[l(f,{onClick:a[0]||(a[0]=r=>k())}),l(ne,null,{default:i(()=>[l(U,{class:"pa-sm-10 pa-2"},{default:i(()=>[I("h4",me,se(`${n(e).titleForm} rol`),1),ce,l(de,{ref_key:"formRole",ref:$},{default:i(()=>[l(q,null,{default:i(()=>[l(N,{cols:"12"},{default:i(()=>[l(j,{type:"text",loading:n(e).isLoading},{default:i(()=>[l(C,{requiredField:!0,label:"Nombre de rol",modelValue:n(o).description,"onUpdate:modelValue":a[1]||(a[1]=r=>n(o).description=r),rules:["requiredValidator"in u?u.requiredValidator:n(Q)],clearable:"","error-messages":n(v).description,onInput:a[2]||(a[2]=r=>n(v).description="")},null,8,["modelValue","rules","error-messages"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512),fe,l(j,{type:"list-item, list-item, list-item, list-item, list-item, list-item",loading:n(e).isLoading},{default:i(()=>[l(q,null,{default:i(()=>[l(N,null,{default:i(()=>[l(le,{border:""},{default:i(()=>[(h(!0),F(L,null,D(n(e).menus,(r,E)=>(h(),x(b,{key:E,father:r},null,8,["father"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),l(U,{class:"d-flex align-center justify-center gap-4"},{default:i(()=>[l(w,{color:"secondary",onClick:a[3]||(a[3]=r=>k())},{default:i(()=>[P("Cancelar")]),_:1}),l(w,{"prepend-icon":"tabler-device-floppy",onClick:a[4]||(a[4]=r=>K()),loading:n(e).isLoading},{default:i(()=>[P(" Guardar cambios")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{Le as _};
