import{r as p}from"./validators-DQNwaKQj.js";import{d as fe,V as ve,r as m,Y as pe,c as A,o as _,b as e,f as r,a7 as f,b8 as Ve,e as s,F as O,q as W,G as ge,E as U,h as L,y as P,a9 as E,D as y,ac as z,l as V,b7 as T,aS as _e,Z as ye,$ as be}from"./index-CtOr4Wu7.js";import{_ as qe}from"./AppSelect.vue_vue_type_script_setup_true_lang-K6gbidqT.js";import{_ as Ce}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-6vZWU1pl.js";import{o as X}from"./helpers-BPprKBaR.js";import{a as Q,V as B}from"./VCard-COZucsTL.js";import{V as I}from"./VCardText-v8gCKQRH.js";import{V as G,a as v}from"./VRow-C1C7EzPn.js";import{V as R}from"./VDivider-Du-RozYy.js";import{V as D}from"./VForm-BhvUgRDX.js";import{V as ee}from"./VSpacer-xsYKkl2P.js";import{V as le}from"./VDialog-CybUf8DC.js";import{V as ae}from"./VTextField-B5WBRC1t.js";import{V as we}from"./VTable-ClsD0PQ0.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VSelect-BZZhkYMh.js";import"./VList-BoAmY9IJ.js";import"./ssrBoot-CB8iZIPO.js";import"./VAvatar-e7AxYF9T.js";import"./VImg-Ctxsnw81.js";import"./dialog-transition-dwJwLnHT.js";import"./VMenu-D4hRRJEr.js";import"./VCheckboxBtn-Cah7cXyy.js";import"./VSelectionControl-Uad4iysT.js";import"./VChip-X8cnhpwt.js";import"./constants-2GBt7OCP.js";/* empty css              *//* empty css                   */import"./VCounter-DANGpuYg.js";const Y=N=>(ye("data-v-fdd83625"),N=N(),be(),N),ke=Y(()=>s("span",{class:"text-white text-h5"},"Generador de constancias masivas",-1)),he={class:"certificates-section"},Ee=Y(()=>s("h3",{class:"text-h6 mb-4"},"Seleccione el tipo de constancia",-1)),Ie={class:"d-flex align-center mb-3"},Fe={class:"text-h6"},Ue={class:"text-body-2 text-grey-darken-1"},Ge=Y(()=>s("thead",null,[s("tr",null,[s("th",{style:{width:"40%"}},"Nombre"),s("th",{style:{width:"30%"}},"Documento"),s("th",{style:{width:"30%"}},"Literal")])],-1)),Ne=fe({__name:"Masive",setup(N){const $=ve(),{toast:re}=_e(),te=m(""),g=m(!1),d=m(null),q=m([]),C=m(!0),w=m(null),Z=m(),b=m(!1),S=m(!1),k=m(""),ie=pe(()=>{if(!k.value.trim())return q.value;const a=k.value.trim().toLowerCase();return q.value.filter(l=>l.full_name.toLowerCase().includes(a)||l.identity_document.toLowerCase().includes(a))}),oe=(a=!1)=>{H(),b.value=a,a||K()},i=m({grade_id:null,section_id:null,ordering:null}),H=()=>{var a;i.value={grade_id:null,section_id:null,ordering:null},(a=w.value)==null||a.resetValidation()},x=[{value:1,title:"A"},{value:2,title:"B"},{value:3,title:"C"},{value:4,title:"D"},{value:5,title:"E"}],de=[{value:1,title:"Primer Nivel"},{value:2,title:"Segundo Nivel"}],ne=[{value:4,title:"1er Grado"},{value:5,title:"2do Grado"},{value:6,title:"3er Grado"},{value:7,title:"4to Grado"},{value:8,title:"5to Grado"},{value:9,title:"6to Grado"}],M=[{value:"full_name",title:"Apellidos y nombres"},{value:"identity_document",title:"Documento"}],j=async a=>{try{const l={grade_id:i.value.grade_id,section_id:i.value.section_id,ordering:i.value.ordering,company_id:$.company.id};if(a==="/documents/searchStudentFor"){const{data:n,response:u}=await T(a).get({params:l});if(u.status===200&&(n!=null&&n.students))q.value=n.students.map(t=>({...t,literal:t.literal||""})),b.value=!1,S.value=!0;else throw new Error("Invalid response format")}else{const{data:n,response:u}=await T(a).get({params:l});if(u.status===200&&(n!=null&&n.pdf))X(n.pdf);else throw new Error("Invalid response format")}}catch(l){console.error(`Error downloading certificate from ${a}:`,l)}},se=async()=>{var l;const a=await((l=Z.value)==null?void 0:l.validate());if(console.log("Validation result:",a),!(a!=null&&a.valid)){re("Faltan Campos Por Diligenciar","","danger");return}try{g.value=!0;const{data:n,response:u}=await T("/student/saveLiterals").post({students:q.value.map(t=>({id:t.id,literal:t.literal})),company_id:$.company.id});if(u.status===200){const{data:t,response:c}=await T("/documents/prosecutionPrimaryEducation").get({params:{grade_id:i.value.grade_id,section_id:i.value.section_id,ordering:i.value.ordering,company_id:$.company.id}});if(c.status===200&&(t!=null&&t.pdf))X(t.pdf),S.value=!1;else throw new Error("Invalid response format")}}catch(n){console.error("Error saving literals:",n)}finally{g.value=!1}},ue=[{id:1,title:"Constancia de Prosecución - Educación Inicial (Primer y Segundo Nivel)",icon:"tabler-school",description:"Certificado para estudiantes del Nivel de Educación Inicial que cursan Primer o Segundo Nivel.",requiresAdditionalInfo:!0,handler:()=>j("/documents/prosecutionInitialEducation")},{id:2,title:"Certificado de Educación Inicial (Tercer Nivel)",icon:"tabler-school",description:"Certificado para estudiantes del Nivel de Educación Inicial que cursan Tercer Nivel.",requiresAdditionalInfo:!0,handler:()=>j("/documents/certificateInitialEducation")},{id:3,title:"Constancia de Prosecución - Educación Primaria",icon:"tabler-school",description:"Certificado para estudiantes del Nivel de Educación Primaria que cursan desde 1er hasta 6to grado.",requiresAdditionalInfo:!0,handler:()=>j("/documents/searchStudentFor")}],ce=async()=>{const a=w.value;if(!a)return!1;const{valid:l}=await a.validate();return l},me=a=>{d.value=a,a.requiresAdditionalInfo&&(b.value=!0)},F=async(a=!0)=>{if(d.value&&!(a&&!await ce())){g.value=!0;try{await d.value.handler()}catch(l){console.error("Error al generar certificado:",l)}finally{g.value=!1}}},J=()=>{var a;S.value=!1,q.value=[],k.value="",(a=w.value)==null||a.resetValidation()},K=()=>{d.value=null,te.value="",S.value=!1,b.value=!1,k.value="",q.value=[],H()};return(a,l)=>{const n=Ce,u=qe;return _(),A("div",null,[e(B,{class:"elevation-3",loading:g.value},{default:r(()=>[e(Q,{class:"d-flex align-center pa-4 bg-primary"},{default:r(()=>[e(f,{icon:"tabler-certificate",class:"me-2",color:"white"}),ke]),_:1}),e(I,{class:"pa-6"},{default:r(()=>[e(Ve,null,{default:r(()=>[s("div",he,[Ee,e(G,null,{default:r(()=>[(_(),A(O,null,W(ue,t=>e(v,{key:t.id,cols:"12",sm:"6",md:"4"},{default:r(()=>{var c;return[e(B,{class:ge(["certificate-card pa-4 cursor-pointer",{selected:((c=d.value)==null?void 0:c.id)===t.id}]),onClick:h=>me(t),elevation:"2",hover:""},{default:r(()=>{var h;return[s("div",Ie,[e(f,{icon:t.icon,size:"32",class:"me-3",color:((h=d.value)==null?void 0:h.id)===t.id?"primary":"grey"},null,8,["icon","color"]),s("h4",Fe,U(t.title),1)]),s("p",Ue,U(t.description),1)]}),_:2},1032,["class","onClick"])]}),_:2},1024)),64))]),_:1})])]),_:1})]),_:1}),e(R),e(I,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:r(()=>[e(E,{color:"error",variant:"outlined",onClick:K},{default:r(()=>[e(f,{icon:"tabler-x",class:"me-2"}),y(" Cancelar ")]),_:1}),d.value&&!d.value.requiresAdditionalInfo?(_(),L(E,{key:0,color:"primary",onClick:l[0]||(l[0]=t=>F(!1)),disabled:!d.value,loading:g.value},{default:r(()=>[e(f,{icon:"tabler-printer",class:"me-2"}),y(" Generar Constancia ")]),_:1},8,["disabled","loading"])):P("",!0)]),_:1})]),_:1},8,["loading"]),e(le,{modelValue:b.value,"onUpdate:modelValue":l[14]||(l[14]=t=>b.value=t),width:"600",persistent:""},{default:r(()=>[e(n,{onClick:l[1]||(l[1]=t=>oe())}),e(B,null,{default:r(()=>[e(Q,{class:"bg-primary text-white pa-4"},{default:r(()=>{var t,c;return[e(f,{icon:(t=d.value)==null?void 0:t.icon,class:"me-2",color:"white"},null,8,["icon"]),y(" "+U((c=d.value)==null?void 0:c.title),1)]}),_:1}),e(I,{class:"pa-6"},{default:r(()=>{var t,c,h;return[((t=d.value)==null?void 0:t.id)===1?(_(),L(D,{key:0,onSubmit:z(F,["prevent"]),modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=o=>C.value=o),ref_key:"form",ref:w},{default:r(()=>[e(G,null,{default:r(()=>[e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.grade_id,"onUpdate:modelValue":l[2]||(l[2]=o=>i.value.grade_id=o),items:de,label:"Seleccione el grado ",required:""},null,8,["rules","modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.section_id,"onUpdate:modelValue":l[3]||(l[3]=o=>i.value.section_id=o),items:x,label:"Seleccione la sección",required:""},null,8,["rules","modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.ordering,"onUpdate:modelValue":l[4]||(l[4]=o=>i.value.ordering=o),items:M,label:"Seleccione el ordenamiento",required:""},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0),((c=d.value)==null?void 0:c.id)===2?(_(),L(D,{key:1,onSubmit:z(F,["prevent"]),modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=o=>C.value=o),ref_key:"form",ref:w},{default:r(()=>[e(G,null,{default:r(()=>[e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.section_id,"onUpdate:modelValue":l[6]||(l[6]=o=>i.value.section_id=o),items:x,label:"Seleccione la sección",required:""},null,8,["rules","modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.ordering,"onUpdate:modelValue":l[7]||(l[7]=o=>i.value.ordering=o),items:M,label:"Seleccione el ordenamiento",required:""},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0),((h=d.value)==null?void 0:h.id)===3?(_(),L(D,{key:2,onSubmit:z(F,["prevent"]),modelValue:C.value,"onUpdate:modelValue":l[12]||(l[12]=o=>C.value=o),ref_key:"form",ref:w},{default:r(()=>[e(G,null,{default:r(()=>[e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.grade_id,"onUpdate:modelValue":l[9]||(l[9]=o=>i.value.grade_id=o),items:ne,label:"Seleccione el grado",required:""},null,8,["rules","modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.section_id,"onUpdate:modelValue":l[10]||(l[10]=o=>i.value.section_id=o),items:x,label:"Seleccione la sección",required:""},null,8,["rules","modelValue"])]),_:1}),e(v,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(p)],clearable:"",requiredField:!0,modelValue:i.value.ordering,"onUpdate:modelValue":l[11]||(l[11]=o=>i.value.ordering=o),items:M,label:"Seleccione el ordenamiento",required:""},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0)]}),_:1}),e(R),e(I,{class:"d-flex align-center justify-center gap-4"},{default:r(()=>[e(ee),e(E,{color:"error",variant:"outlined",onClick:l[13]||(l[13]=t=>b.value=!1)},{default:r(()=>[e(f,{icon:"tabler-x",class:"me-2"}),y(" Cancelar ")]),_:1}),e(E,{color:"primary",onClick:F,loading:g.value,disabled:!d.value},{default:r(()=>[e(f,{icon:"tabler-printer",class:"me-2"}),y(" Generar Constancia ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:S.value,"onUpdate:modelValue":l[17]||(l[17]=t=>S.value=t),width:"80rem",persistent:""},{default:r(()=>[e(n,{onClick:l[15]||(l[15]=t=>J())}),e(B,null,{default:r(()=>[e(Q,{class:"bg-primary text-white pa-4"},{default:r(()=>[e(f,{icon:"tabler-users",class:"me-2",color:"white"}),y(" Lista de Estudiantes ")]),_:1}),e(I,{class:"pa-6"},{default:r(()=>[e(G,{class:"mb-4"},{default:r(()=>[e(v,{cols:"12"},{default:r(()=>[e(ae,{modelValue:k.value,"onUpdate:modelValue":l[16]||(l[16]=t=>k.value=t),label:"Buscar por nombre o documento","prepend-inner-icon":"tabler-search",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{ref_key:"formValidateStudents",ref:Z},{default:r(()=>[e(we,null,{default:r(()=>[Ge,s("tbody",null,[(_(!0),A(O,null,W(ie.value,t=>(_(),A("tr",{key:t.id},[s("td",null,U(t.full_name),1),s("td",null,U(t.identity_document),1),s("td",null,[e(ae,{modelValue:t.literal,"onUpdate:modelValue":c=>t.literal=c,rules:["requiredValidator"in a?a.requiredValidator:V(p)],maxlength:"1",label:"Literal",required:""},null,8,["modelValue","onUpdate:modelValue","rules"])])]))),128))])]),_:1})]),_:1},512)]),_:1}),e(R),e(I,{class:"d-flex align-center justify-center gap-4"},{default:r(()=>[e(ee),e(E,{color:"error",variant:"outlined",onClick:J},{default:r(()=>[e(f,{icon:"tabler-x",class:"me-2"}),y(" Cancelar ")]),_:1}),e(E,{color:"primary",onClick:se,loading:g.value},{default:r(()=>[e(f,{icon:"tabler-printer",class:"me-2"}),y(" Guardar y Generar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),nl=Se(Ne,[["__scopeId","data-v-fdd83625"]]);export{nl as default};
