import{cj as A,r as c,V as h,aT as o,b5 as S}from"./index-BaV16FCr.js";const _=A("notification",()=>{const t=c([]),s=c(0),r=c(null),u=c(!1),f=h(),{toast:d}=S();return{notifications:t,unreadCount:s,nextPageUrl:r,fetchNotifications:async(i="/notification/getNotifications",e=!1)=>{var l;const{response:n,data:a}=await o(i).get();if((l=n.value)!=null&&l.ok&&a.value){if(e)t.value=a.value.notifications;else{const v=a.value.notifications.filter(m=>!t.value.some(p=>p.id===m.id));t.value.push(...v)}r.value=a.value.nextPageUrl,i==="/notification/getNotifications"&&(s.value=a.value.unreadCount)}},markAsRead:async i=>{t.value.forEach(e=>{i.includes(e.id)&&!e.isSeen&&(e.isSeen=!0,s.value=Math.max(0,s.value-1))}),await o("/notification/markMultipleAsRead").post({notification_ids:i})},markAsUnread:async i=>{t.value.forEach(e=>{i.includes(e.id)&&e.isSeen&&(e.isSeen=!1,s.value++)}),await o("/notification/markMultipleAsUnread").post({notification_ids:i})},remove:async i=>{const e=t.value.findIndex(n=>n.id===i);e!==-1&&t.value.splice(e,1),await o("/notifications/remove").post({notification_ids:[i]})},markAllRead:async()=>{const i=t.value.filter(e=>!e.isSeen).map(e=>e.id);i.length!==0&&(t.value.forEach(e=>e.isSeen=!0),s.value=0,await o("/notification/markMultipleAsRead").post({notification_ids:i}),d("Todo marcado como leído","","success"))},initializeListener:()=>{var i;u.value||!((i=f.user)!=null&&i.id)||(window.Echo.private("App.Models.User."+f.user.id).listen(".update-notification",e=>{s.value=e.activeNotificationsCount,e.notifications&&Array.isArray(e.notifications)&&e.notifications.forEach(n=>{const a=t.value.findIndex(l=>l.id===n.id);a!==-1&&(n.is_removed?t.value.splice(a,1):t.value[a].isSeen=n.isSeen)})}).notification(e=>{s.value++,t.value.unshift({id:e.id,title:e.title,subtitle:e.subtitle,text:e.text||null,img:e.img||null,icon:e.icon||"tabler-bell",time:"Ahora mismo",isSeen:!1,color:e.color||"primary",action_url:e.action_url,openInNewTab:e.openInNewTab}),d(e.title,e.subtitle||"Nueva notificación","info")}),u.value=!0)},stopListening:i=>{i&&window.Echo.leave(`App.Models.User.${i}`)}}});export{_ as u};
