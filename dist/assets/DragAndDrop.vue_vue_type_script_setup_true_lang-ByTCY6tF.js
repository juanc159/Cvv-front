import{r as $}from"./validators-Ry998vJq.js";import{d as R,r as c,co as U,cp as w,cq as Z,g as B,f as t,a as F,o as i,b as e,ac as v,k as A,e as l,c as d,a8 as O,ad as h,C as g,F as T,p as G,x as V,D as E,cn as K,af as L}from"./index-DGPbDN3C.js";import{_ as M}from"./AppSelect.vue_vue_type_script_setup_true_lang-DrChu70f.js";import{V as q,c as P}from"./VCard-Cd5LzZ9C.js";import{V as m}from"./VCardText-Ck9j2ztd.js";import{V as H}from"./VForm-CjqQXUGV.js";import{V as x,a as y}from"./VRow-B_7Qk2u7.js";import{V as J}from"./VImg-GOtdv2YA.js";import{V as Q}from"./VSpacer-BbtevGiM.js";const W={class:"flex"},X={class:"w-full h-auto relative"},Y={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},ee=l("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquí. ",-1),ae=l("span",{class:"text-disabled"},"o",-1),te={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},se={class:"mt-2"},oe={class:"clamp-text text-wrap"},le={key:0,class:"mt-2"},re=l("span",null,"Cargando...",-1),ne={key:1,class:"mt-2 text-success"},ie=l("span",null,"¡Archivo cargado exitosamente!",-1),de=[ie],ue={key:2,class:"mt-2 text-danger"},ce=l("span",null,"Error al cargar el archivo",-1),fe=[ce],Ce=R({__name:"DragAndDrop",setup(pe){const k=c(),C=c(),r=c([]),{open:D,onChange:I}=U({});function N(o){o==null||o.forEach(s=>{if(s.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}r.value.push({file:s,url:w(s).value??"",progress:void 0,status:"pending"})})}I(o=>{if(o)for(const s of o)r.value.push({file:s,url:w(s).value??"",progress:void 0,status:"pending"})}),Z(C,N);const j=async()=>{var s,p;const o=await((s=k.value)==null?void 0:s.validate());if(o!=null&&o.valid){if(r.value.length===0){alert("No hay archivos para guardar");return}f.value=!0;for(let u=0;u<r.value.length;u++){const a=r.value[u];a.status="uploading";try{const n=new FormData;n.append("file",a.file),n.append("field",_.value);const{data:b,response:S}=await L("/savefiles").post(n);(p=S.value)!=null&&p.ok&&b.value&&(a.status="completed",a.progress=100,console.log(`Archivo ${a.file.name} guardado correctamente`))}catch(n){a.status="failed",a.progress=void 0,console.error("Error al guardar el archivo",a.file.name,n),alert(`Error al guardar el archivo ${a.file.name}`)}}f.value=!1}},f=c(!1),_=c(),z=[{title:"Foto",value:"photo"},{title:"Boletín",value:"boletin"}];return(o,s)=>{const p=M,u=F("IconBtn");return i(),B(q,{class:"mb-6",title:"Archivos"},{default:t(()=>[e(m,null,{default:t(()=>[e(H,{ref_key:"formValidation",ref:k,onSubmit:v(()=>{},["prevent"])},{default:t(()=>[e(x,null,{default:t(()=>[e(y,{cols:"12",md:"6"},{default:t(()=>[e(p,{requiredField:!0,label:"Campo",items:z,modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=a=>_.value=a),rules:["requiredValidator"in o?o.requiredValidator:A($)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(m,null,{default:t(()=>[l("div",W,[l("div",X,[l("div",{ref_key:"dropZoneRef",ref:C,class:"cursor-pointer",onClick:s[2]||(s[2]=()=>A(D)())},[r.value.length===0?(i(),d("div",Y,[e(u,{variant:"tonal",class:"rounded-sm"},{default:t(()=>[e(O,{icon:"tabler-upload"})]),_:1}),ee,ae,e(h,{variant:"tonal"},{default:t(()=>[g("Explorar archivos")]),_:1})])):(i(),d("div",te,[e(x,{class:"match-height w-100"},{default:t(()=>[(i(!0),d(T,null,G(r.value,(a,n)=>(i(),B(y,{key:n,cols:"12",sm:"4"},{default:t(()=>[e(q,{ripple:!1,border:"",class:"d-flex flex-column"},{default:t(()=>[e(m,{onClick:s[1]||(s[1]=v(()=>{},["stop"]))},{default:t(()=>[e(J,{src:a.url,width:"150px",height:"100px"},null,8,["src"]),l("div",se,[l("span",oe,E(a.file.name),1),l("span",null,E(a.file.size/1e3)+" KB ",1)]),a.status==="uploading"?(i(),d("div",le,[e(K,{size:24,value:a.progress,color:"primary"},null,8,["value"]),re])):V("",!0),a.status==="completed"?(i(),d("div",ne,de)):V("",!0),a.status==="failed"?(i(),d("div",ue,fe)):V("",!0)]),_:2},1024),e(Q),e(P,null,{default:t(()=>[e(h,{variant:"outlined",block:"",onClick:v(b=>r.value.splice(n,1),["stop"])},{default:t(()=>[g(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(m,null,{default:t(()=>[e(x,null,{default:t(()=>[e(y,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[e(h,{disabled:f.value,loading:f.value,color:"primary",onClick:j},{default:t(()=>[g(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Ce as _};
