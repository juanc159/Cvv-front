import{_ as me}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-DDbD3EeL.js";import{r as pe}from"./validators-BvQ1oDJn.js";import{d as oe,r as v,a_ as fe,a$ as X,b0 as ve,a as ge,h as y,o as n,f as a,b as e,a9 as J,l as o,e as c,c as $,a6 as G,a8 as q,D as _,F as K,q as Y,aJ as N,y as P,E as k,aA as ye,V as he,aU as be,Y as ee,ay as Ve,N as ke,aI as we,aV as xe}from"./index-RzV1QAoP.js";import{_ as le}from"./AppSelect.vue_vue_type_script_setup_true_lang-D8yGCHXs.js";import{V as E,b as Ce,a as T}from"./VCard-DaNQ3_6f.js";import{V as H}from"./VForm-C5IeNRcC.js";import{V,a as f}from"./VRow-CO85CijB.js";import{V as w}from"./VCardText-Dm2CnPNw.js";import{V as De}from"./VImg-B6DACBgf.js";import{V as Pe}from"./VSpacer-D_eHqLun.js";import{_ as $e}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-DHoB7WpV.js";import{u as Ae,V as Fe}from"./VFileInput-DIcwipHv.js";import{c as Se}from"./createUrl-DCK_vFzY.js";import{b as ze}from"./helpers-wifU2dAA.js";import{V as Q}from"./VChip-DsDkGwaf.js";import{V as Ee}from"./VAlert-BFzuWoZg.js";import{V as Ne}from"./VInput-DoFUtF3M.js";import{V as ae}from"./VSwitch-DXmhg9vX.js";import{V as qe}from"./VDivider-D39uZXIY.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-DeSKSFZb.js";import"./VDialog-Cs4xHY-b.js";import"./VOverlay-BvGCFOa_.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-DQiKwflT.js";import"./VTooltip-Dej9oMs9.js";import"./VSelect-DXIcYGLO.js";import"./VTextField-B3IkfSa7.js";/* empty css                   */import"./VCounter-3jTD3ZlP.js";import"./VList-BzOepPo2.js";import"./ssrBoot-BbaJipyo.js";import"./VAvatar-DN0PlqS7.js";import"./VMenu-DYssu-La.js";import"./VCheckboxBtn-DhUXxJCj.js";import"./VSelectionControl-BJXbCgDq.js";/* empty css              */import"./filter-Bf_zHf23.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import"./index-0F-JFElI.js";import"./constants-2GBt7OCP.js";const Ue={class:"flex"},Me={class:"w-full h-auto relative"},Be={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},Ie=c("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquí. ",-1),Re=c("span",{class:"text-disabled"},"o",-1),Te={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},je={class:"mt-2"},Oe={class:"clamp-text text-wrap"},Le={key:0,class:"mt-2"},Qe=c("span",null,"Cargando...",-1),Ge={key:1,class:"mt-2 text-success"},Ze=c("span",null,"¡Archivo cargado exitosamente!",-1),Je=[Ze],Ke={key:2,class:"mt-2 text-danger"},Ye=c("span",null,"Error al cargar el archivo",-1),He=[Ye],We=oe({__name:"DragAndDrop",setup(te){const U=v(),x=v(),r=v([]),{open:A,onChange:t}=fe({});function b(p){p==null||p.forEach(d=>{if(d.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}r.value.push({file:d,url:X(d).value??"",progress:void 0,status:"pending"})})}t(p=>{if(p)for(const d of p)r.value.push({file:d,url:X(d).value??"",progress:void 0,status:"pending"})}),ve(x,b);const F=async()=>{var d,S;const p=await((d=U.value)==null?void 0:d.validate());if(p!=null&&p.valid){if(r.value.length===0){alert("No hay archivos para guardar");return}M.value=!0;for(let z=0;z<r.value.length;z++){const u=r.value[z];u.status="uploading";try{const C=new FormData;C.append("file",u.file),C.append("field",I.value);const{data:j,response:O}=await N("/savefiles").post(C);(S=O.value)!=null&&S.ok&&j.value&&(u.status="completed",u.progress=100,console.log(`Archivo ${u.file.name} guardado correctamente`))}catch(C){u.status="failed",u.progress=void 0,console.error("Error al guardar el archivo",u.file.name,C),alert(`Error al guardar el archivo ${u.file.name}`)}}M.value=!1}},M=v(!1),I=v(),B=[{title:"Foto",value:"photo"},{title:"Boletín",value:"boletin"}];return(p,d)=>{const S=le,z=ge("IconBtn");return n(),y(E,{class:"mb-6",title:"Archivos"},{default:a(()=>[e(w,null,{default:a(()=>[e(H,{ref_key:"formValidation",ref:U,onSubmit:J(()=>{},["prevent"])},{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",md:"6"},{default:a(()=>[e(S,{requiredField:!0,label:"Campo",items:B,modelValue:I.value,"onUpdate:modelValue":d[0]||(d[0]=u=>I.value=u),rules:["requiredValidator"in p?p.requiredValidator:o(pe)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(w,null,{default:a(()=>[c("div",Ue,[c("div",Me,[c("div",{ref_key:"dropZoneRef",ref:x,class:"cursor-pointer",onClick:d[2]||(d[2]=()=>o(A)())},[r.value.length===0?(n(),$("div",Be,[e(z,{variant:"tonal",class:"rounded-sm"},{default:a(()=>[e(G,{icon:"tabler-upload"})]),_:1}),Ie,Re,e(q,{variant:"tonal"},{default:a(()=>[_("Explorar archivos")]),_:1})])):(n(),$("div",Te,[e(V,{class:"match-height w-100"},{default:a(()=>[(n(!0),$(K,null,Y(r.value,(u,C)=>(n(),y(f,{key:C,cols:"12",sm:"4"},{default:a(()=>[e(E,{ripple:!1,border:"",class:"d-flex flex-column"},{default:a(()=>[e(w,{onClick:d[1]||(d[1]=J(()=>{},["stop"]))},{default:a(()=>[e(De,{src:u.url,width:"150px",height:"100px"},null,8,["src"]),c("div",je,[c("span",Oe,k(u.file.name),1),c("span",null,k(u.file.size/1e3)+" KB ",1)]),u.status==="uploading"?(n(),$("div",Le,[e(ye,{size:24,value:u.progress,color:"primary"},null,8,["value"]),Qe])):P("",!0),u.status==="completed"?(n(),$("div",Ge,Je)):P("",!0),u.status==="failed"?(n(),$("div",Ke,He)):P("",!0)]),_:2},1024),e(Pe),e(Ce,null,{default:a(()=>[e(q,{variant:"outlined",block:"",onClick:J(j=>r.value.splice(C,1),["stop"])},{default:a(()=>[_(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(w,null,{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(q,{disabled:M.value,loading:M.value,color:"primary",onClick:F},{default:a(()=>[_(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Xe={class:"d-flex align-center"},ea={class:"d-flex align-center mb-2"},aa=c("strong",null,"Sistema de cola activo",-1),oa=c("div",{class:"text-body-2"},' Puedes subir múltiples archivos. Se procesarán uno después del otro automáticamente. Usa el botón "Ver Todas" para gestionar todos los procesos. ',-1),la={key:0,class:"text-body-2 mt-2"},ta=c("strong",null,"Progreso actual:",-1),sa=c("b",{class:"text-warning"},"*",-1),ra={class:"demo-space-x"},na={class:"demo-space-x"},ia={class:"demo-space-x"},Ka=oe({__name:"Index",setup(te){const U=he(),{toast:x}=xe(),r=Ve(),A=v(Ae());A.value.allowedExtensions=["xls","xlsx"];const t=be({form:!1,download_notes:!1,block_uploading_of_grades_to_teachers:!1,viewing_notes:!1}),b=v({company_id:null,type_education_id:null,teacher_id:null,archive:null}),F=v({}),M=v(),I=v(),B=v([]),p=v([]),d=v(!1),S=v({}),z=i=>!!i||"Campo requerido",u=ee(()=>r.hasActiveProcess()),C=async()=>{var l,m,h;b.value.archive=A.value.imageFile,b.value.company_id=U.company.id;const i=await((l=M.value)==null?void 0:l.validate());if(i!=null&&i.valid){const D=new FormData;D.append("company_id",String(b.value.company_id)),D.append("type_education_id",String(b.value.type_education_id)),D.append("teacher_id",String(b.value.teacher_id||"")),D.append("archive",b.value.archive),t.form=!0;try{console.log("📤 [FORM] Enviando formulario...");const{data:g,response:s}=await N("note-store").post(D);if(console.log("📥 [FORM] Respuesta del servidor:",g.value),(m=s.value)!=null&&m.ok&&g.value)if(g.value.status==="success"){console.log("🚀 [FORM] Iniciando loading para batch_id:",g.value.batch_id);const R=((h=A.value.imageFile)==null?void 0:h.name)||"Archivo desconocido";r.startLoading(g.value.batch_id,R)?(x("Importación iniciada correctamente","","success"),b.value={company_id:U.company.id,type_education_id:null,teacher_id:null,archive:null},A.value.clearData()):x("Error iniciando la importación","","danger")}else g.value.status==="error"&&(x("Error en la importación",g.value.message,"danger"),g.value.errors&&(F.value=g.value.errors));else x("Error en la respuesta del servidor","","danger")}catch(g){console.error("❌ [FORM] Error en submitForm:",g),x("Error al procesar el archivo","","danger")}finally{t.form=!1}}else x("Faltan Campos Por Diligenciar","","danger")},j=async()=>{var m;t.form=!0;const{data:i,response:l}=await N("note-dataForm").get();(m=l.value)!=null&&m.ok&&i.value&&(B.value=i.value.typeEducations,d.value=i.value.blockData,p.value=i.value.teachers),t.form=!1},O=i=>!0,se=async()=>{var m;const{data:i,response:l}=await N("/type_educations/visualization/show").get();(m=l.value)!=null&&m.ok&&i.value&&(S.value=i.value.selectedNotes)},L=v({type_education_id:null}),re=async()=>{var l,m;const i=await((l=I.value)==null?void 0:l.validate());if(i!=null&&i.valid){t.download_notes=!0;const h=B.value.find(s=>s.value==L.value.type_education_id),{data:D,response:g}=await N(Se("/note-downloadAllConsolidated",{query:{type_education_id:L.value.type_education_id,company_id:U.company.id}}));t.download_notes=!1,(m=g.value)!=null&&m.ok&&D.value&&ze(D.value.excel,"Consolidado "+(h==null?void 0:h.title))}else x("Faltan Campos Por Diligenciar","","danger")},ne=async i=>{var h;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:m}=await N("/note-blockPayrollUpload").post({value:i});(h=m.value)!=null&&h.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},ie=async i=>{var h;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:m}=await N("/note-resetOptionDownloadPdf").post({company_id:U.company.id});(h=m.value)!=null&&h.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},de=ee(()=>d.value?"Sí":"No"),ue=async()=>{t.viewing_notes=!0;const{data:i,response:l}=await N("/type_educations/visualization/store").post({selectedNotes:S.value});t.viewing_notes=!1},Z=v(),ce=()=>{Z.value.openModal(),Z.value.componentData.title="Esta seguro que desea activar a todos los estudiantes en un estado insolventes"};return ke(async()=>{await se(),console.log("🚀 [PAGE] Component mounted - Queue system enabled"),await j()}),(i,l)=>{const m=le,h=$e,D=We,g=me;return n(),$("div",null,[o(r).allProcesses.value.length>0?(n(),y(E,{key:0,class:"mb-3"},{default:a(()=>[e(T,{class:"d-flex align-center justify-space-between"},{default:a(()=>[c("div",Xe,[_(" 🔄 Importaciones "),e(Q,{color:"primary",size:"small",class:"ms-2"},{default:a(()=>[_(k(o(r).activeProcesses.value.length)+" activa"+k(o(r).activeProcesses.value.length!==1?"s":""),1)]),_:1}),o(r).queuedProcesses.value.length>0?(n(),y(Q,{key:0,color:"warning",size:"small",class:"ms-2"},{default:a(()=>[_(k(o(r).queuedProcesses.value.length)+" en cola ",1)]),_:1})):P("",!0),o(r).completedProcesses.value.length>0?(n(),y(Q,{key:1,color:"success",size:"small",class:"ms-2"},{default:a(()=>[_(k(o(r).completedProcesses.value.length)+" completada"+k(o(r).completedProcesses.value.length!==1?"s":""),1)]),_:1})):P("",!0)]),e(q,{variant:"outlined",size:"small",onClick:l[0]||(l[0]=s=>o(r).showProcessListModal())},{default:a(()=>[e(G,{start:"",icon:"tabler-list"}),_(" Ver Todas ("+k(o(r).allProcesses.value.length)+") ",1)]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(Ee,{type:"info",variant:"tonal"},{default:a(()=>[c("div",ea,[e(G,{icon:"tabler-info-circle",class:"me-2"}),aa]),oa,o(u)?(n(),$("div",la,[ta,_(" "+k(Math.round(o(r).currentProgress.value||0))+"% ",1)])):P("",!0)]),_:1})]),_:1})]),_:1})):P("",!0),(n(),y(E,{key:1,disabled:o(t).form,loading:o(t).form},{default:a(()=>[e(T,{"primary-title":""},{default:a(()=>[_(" Cargar Notas "),o(r).allProcesses.value.length>0?(n(),y(Q,{key:0,color:"info",size:"small",class:"ms-2"},{default:a(()=>[_(k(o(r).allProcesses.value.length)+" proceso"+k(o(r).allProcesses.value.length!==1?"s":""),1)]),_:1})):P("",!0)]),_:1}),e(w,null,{default:a(()=>[e(o(H),{ref_key:"formValidation",ref:M,"lazy-validation":""},{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[e(m,{clearable:"",modelValue:o(b).type_education_id,"onUpdate:modelValue":l[1]||(l[1]=s=>o(b).type_education_id=s),rules:[z],"error-messages":o(F).type_education_id,label:"Tipo",onChange:l[2]||(l[2]=s=>o(F).type_education_id=""),requiredField:!0,items:o(B)},null,8,["modelValue","rules","error-messages","items"])]),_:1}),e(f,{cols:"12",sm:"4"},{default:a(()=>[e(Ne,null,{default:a(()=>[_("Archivo "),sa]),_:1}),(n(),y(Fe,{key:o(A).key,onChange:o(A).handleImageSelected,"onClick:clear":o(A).clearData,rules:[z]},null,8,["onChange","onClick:clear","rules"]))]),_:1}),e(f,{cols:"12",sm:"4"},{default:a(()=>[e(h,{clearable:"",modelValue:o(b).teacher_id,"onUpdate:modelValue":l[3]||(l[3]=s=>o(b).teacher_id=s),"error-messages":o(F).teacher_id,label:"Docente",onChange:l[4]||(l[4]=s=>o(F).teacher_id=""),items:o(p)},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(q,{loading:o(t).form,color:"primary",onClick:l[5]||(l[5]=s=>C())},{default:a(()=>[e(G,{start:"",icon:"tabler-upload"}),_(" Cargar Archivo ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),(n(),y(E,{key:2,disabled:o(t).download_notes,loading:o(t).download_notes,class:"mt-3"},{default:a(()=>[e(T,{"primary-title":""},{default:a(()=>[_("Descargar Notas")]),_:1}),e(w,null,{default:a(()=>[e(o(H),{ref_key:"formValidationDownload",ref:I,"lazy-validation":""},{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[e(m,{clearable:"",modelValue:o(L).type_education_id,"onUpdate:modelValue":l[6]||(l[6]=s=>o(L).type_education_id=s),rules:[z],"error-messages":o(F).type_education_id,label:"Tipo",onChange:l[7]||(l[7]=s=>o(F).type_education_id=""),requiredField:!0,items:o(B)},null,8,["modelValue","rules","error-messages","items"])]),_:1})]),_:1}),e(V,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(q,{loading:o(t).download_notes,disabled:o(t).download_notes,color:"primary",onClick:l[8]||(l[8]=s=>re())},{default:a(()=>[_(" Descargar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),e(V,null,{default:a(()=>[e(f,{cols:"4"},{default:a(()=>[O("note.block_uploading_of_grades_to_teachers")?(n(),y(E,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(T,{"primary-title":""},{default:a(()=>[_("Bloquear carga de notas a los profesores")]),_:1}),e(w,null,{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[c("div",ra,[e(ae,{modelValue:o(d),"onUpdate:modelValue":[l[9]||(l[9]=s=>we(d)?d.value=s:null),l[10]||(l[10]=s=>ne(s))],label:o(de),color:"success"},null,8,["modelValue","label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):P("",!0)]),_:1}),e(f,{cols:"4"},{default:a(()=>[O("note.reset_option_download_pdf")?(n(),y(E,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(T,{"primary-title":""},{default:a(()=>[_("Reiniciar opción descarga pdf y boletin")]),_:1}),e(w,null,{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[c("div",na,[e(q,{color:"primary",onClick:ce},{default:a(()=>[_("Reiniciar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):P("",!0)]),_:1})]),_:1}),(n(),y(E,{key:3,disabled:o(t).viewing_notes,loading:o(t).viewing_notes,class:"mt-3",title:"Visualización de las notas"},{default:a(()=>[(n(!0),$(K,null,Y(o(B),s=>(n(),y(w,{key:s.value},{default:a(()=>[e(qe),e(V,null,{default:a(()=>[e(f,null,{default:a(()=>[c("span",null,k(s.title),1)]),_:2},1024)]),_:2},1024),e(V,null,{default:a(()=>[(n(!0),$(K,null,Y(s.cantNotes,(R,W)=>(n(),y(f,{cols:"12",sm:"4",key:W},{default:a(()=>[c("div",ia,[e(ae,{modelValue:o(S)[s.value]["note_"+R],"onUpdate:modelValue":_e=>o(S)[s.value]["note_"+R]=_e,label:"Nota "+R,color:"success"},null,8,["modelValue","onUpdate:modelValue","label"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128)),e(w,null,{default:a(()=>[e(V,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(q,{loading:o(t).form,disabled:o(t).form,color:"primary",onClick:l[11]||(l[11]=s=>ue())},{default:a(()=>[_(" Guardar Visualización ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])),(n(),y(E,{key:4,title:"Carga de archivos masivos",class:"mt-3"},{default:a(()=>[e(w,null,{default:a(()=>[e(D)]),_:1})]),_:1})),e(g,{ref_key:"refModalQuestion",ref:Z,onSuccess:ie},null,512)])}}});export{Ka as default};
