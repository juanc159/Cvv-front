import{r as p,e as X}from"./validators-C4jeh3Yb.js";import{s as x}from"./helpers-CiFxscXz.js";import{d as ee,V as ae,r as c,t as le,aa as oe,N as re,Y as I,w as te,c as G,o as y,b as r,f as s,e as F,l as e,af as se,h as $,D as q,a9 as B,a7 as ie,ac as ne,F as ue,q as de,E as me,y as pe,aU as M,aZ as ce,b6 as fe}from"./index-D-B3Y6bN.js";import{_ as ve}from"./BtnBack.vue_vue_type_script_setup_true_lang-ClbZzXL1.js";import{_ as Ve}from"./AppTextField.vue_vue_type_script_setup_true_lang-D_9FJekz.js";import{_ as be}from"./AppSelect.vue_vue_type_script_setup_true_lang-ChBFCt2Y.js";import{c as ge}from"./createUrl-BpthdiFz.js";import{u as _e}from"./useFileUpload-DFov6PR2.js";import{a as ye,V as ke}from"./VCard-DOX-owg-.js";import{V as T}from"./VCardText-CSI-zWXl.js";import{V as L}from"./VForm-C_LgAls0.js";import{V as D,a as i}from"./VRow-DClxnqCZ.js";import{V as qe}from"./VFileInput-t_HraGXZ.js";import{V as Fe}from"./VImg-CbATnCB8.js";import{V as we}from"./VDataTable-aIqS1hkh.js";import{V as je}from"./VChip-DMXltytW.js";import"./constants-2GBt7OCP.js";import"./ModalQuestion.vue_vue_type_script_setup_true_lang-D9SNDYHe.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-TPY2zCiM.js";import"./VDialog-BqIMSebF.js";import"./dialog-transition-C_MzqWLQ.js";import"./VTextField-BgKJCdm0.js";/* empty css                   */import"./VCounter-CFz81t17.js";import"./VSelect-B1lBZF6L.js";import"./VList-B5u8dM2Y.js";import"./ssrBoot-B0h8wzj8.js";import"./VAvatar-CgTtSMK2.js";import"./VDivider-BDuFbcMr.js";import"./VMenu-B1_tQ2QR.js";import"./VCheckboxBtn-BHPBMDG2.js";import"./VSelectionControl-DL0p7_yN.js";import"./index-0F-JFElI.js";import"./sweetalert2.esm.all-DV3w3JmD.js";/* empty css              */import"./VTable-pZ5m0kiD.js";import"./filter-DbAUetCK.js";const Ce=F("span",null," Formulario docente ",-1),Ue=F("b",{class:"text-warning"},"*",-1),Ie={style:{"block-size":"200px","inline-size":"200px"}},$e=F("h3",null,"Información complementaria",-1),fa=ee({__name:"Form",setup(Be){const S=ae(),{toast:A}=fe(),m=c({}),w=c(!1),E=le(),N=c(),z=c(),f=oe({form:!1}),j=c([]),P=c([]),C=c([]),t=c({id:null,type_education_id:null,job_position_id:null,name:null,last_name:null,email:null,password:null,phone:null,photo:null,company_id:null,complementaries:[]}),O=()=>{for(const l in t.value)t.value[l]=null;t.value.complementaries=[]},R=async()=>{var u;t.value.id=E.params.id||null;const l=t.value.id?`/teacher/${t.value.id}/edit`:"/teacher/create";f.form=!0;const{data:a,response:d}=await M(ge(l,{query:{company_id:S.company.id}}));f.form=!1,(u=d.value)!=null&&u.ok&&a.value&&(j.value=a.value.typeEducations,P.value=a.value.jobPositions,C.value=a.value.sections,a.value.form&&(t.value=a.value.form))},J=async()=>{var a,d;const l=await((a=N.value)==null?void 0:a.validate());if(l!=null&&l.valid){t.value.company_id=S.company.id;const u=new FormData;for(const b in t.value)["complementaries"].includes(b)||u.append(b,t.value[b]);u.append("complementaries",JSON.stringify(t.value.complementaries));const g=t.value.id?`/teacher/update/${t.value.id}`:"/teacher/store";f.form=!0;const{data:o,response:_}=await M(g).post(u);f.form=!1,(d=_.value)!=null&&d.ok&&o.value&&o.value.code==200&&ce.push({name:"Teacher-List"}),o.value.code===422&&(m.value=o.value.errors??{})}else A("Faltan Campos Por Diligenciar","","danger")};E.params.action=="view"&&(w.value=!0),re(async()=>{O(),await R()});const k=I(()=>Object.values(f).some(l=>l)),V=c([]),v=c(_e()),Y=["jpg","jpeg","png"];v.value.allowedExtensions=Y;const Z=l=>{v.value.handleImageSelected(l),setTimeout(()=>{t.value.photo=v.value.imageFile},1e3)};te(t,(l,a)=>{l.id?(V.value.photo=[],V.value.password=[]):(V.value.photo=[p(v.value.imageUrl)],V.value.password=[p])},{deep:!0});const H=[{title:"Grado o nivel",key:"grade_name"},{title:"Sección",key:"section_name"},{title:"Materias",key:"subjects"},{title:"Acciones",key:"actions"}],n=c({grade_id:null,section_id:null,subjects:[]}),K=()=>{n.value={grade_id:null,section_id:null,subjects:[]}},Q=async()=>{var a;const l=await((a=z.value)==null?void 0:a.validate());if(l!=null&&l.valid){const d=U.value.find(o=>o.value==n.value.grade_id),u=C.value.find(o=>o.value==n.value.section_id),g=h.value.filter(o=>n.value.subjects.includes(o.value));t.value.complementaries.push({id:null,grade_id:n.value.grade_id,grade_name:d.title,section_id:n.value.section_id,section_name:u.title,subjects:g,delete:0}),K()}else A("Faltan Campos Por Diligenciar","","danger")},W=l=>{t.value.complementaries.splice(l,1)},U=I(()=>t.value.type_education_id?j.value.find(l=>l.value==t.value.type_education_id).grades:[]),h=I(()=>n.value.grade_id?U.value.find(l=>l.value==n.value.grade_id).subjects:[]);return(l,a)=>{const d=be,u=Ve,g=ve;return y(),G("div",null,[r(ke,{disabled:e(f).form,loading:e(f).form},{default:s(()=>[r(ye,{class:"d-flex justify-space-between"},{default:s(()=>[Ce]),_:1}),r(T,null,{default:s(()=>[r(L,{ref_key:"formValidation",ref:N,onSubmit:se(()=>{},["prevent"]),disabled:e(w)},{default:s(()=>[r(D,null,{default:s(()=>[r(i,{cols:"12",sm:"3"},{default:s(()=>[r(d,{items:e(j),clearable:"",rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(t).type_education_id,"onUpdate:modelValue":a[0]||(a[0]=o=>e(t).type_education_id=o),label:"Tipo de educación",requiredField:!0},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(d,{items:e(P),rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(t).job_position_id,"onUpdate:modelValue":a[1]||(a[1]=o=>e(t).job_position_id=o),label:"Cargo",requiredField:!0},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(u,{clearable:"",modelValue:e(t).name,"onUpdate:modelValue":a[2]||(a[2]=o=>e(t).name=o),rules:["requiredValidator"in l?l.requiredValidator:e(p)],"error-messages":e(m).name,label:"Nombre",onInput:a[3]||(a[3]=o=>e(m).name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(u,{clearable:"",modelValue:e(t).last_name,"onUpdate:modelValue":a[4]||(a[4]=o=>e(t).last_name=o),rules:["requiredValidator"in l?l.requiredValidator:e(p)],"error-messages":e(m).last_name,label:"Apellido",onInput:a[5]||(a[5]=o=>e(m).last_name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(u,{clearable:"",modelValue:e(t).email,"onUpdate:modelValue":a[6]||(a[6]=o=>e(t).email=o),rules:["requiredValidator"in l?l.requiredValidator:e(p),"emailValidator"in l?l.emailValidator:e(X)],"error-messages":e(m).email,label:"Correo",onInput:a[7]||(a[7]=o=>e(m).email=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(u,{clearable:"",modelValue:e(t).password,"onUpdate:modelValue":a[8]||(a[8]=o=>e(t).password=o),"error-messages":e(m).password,label:"Contraseña",onInput:a[9]||(a[9]=o=>e(m).password=""),requiredField:!e(t).id,rules:e(V).password},null,8,["modelValue","error-messages","requiredField","rules"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(u,{clearable:"",modelValue:e(t).phone,"onUpdate:modelValue":a[10]||(a[10]=o=>e(t).phone=o),rules:["requiredValidator"in l?l.requiredValidator:e(p)],"error-messages":e(m).phone,label:"Teléfono",onInput:a[11]||(a[11]=o=>e(m).phone=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[(y(),$(qe,{accept:"image/*",rules:e(V).photo,key:e(v).key,onChange:a[12]||(a[12]=o=>Z(o)),"onClick:clear":e(v).clearData},{label:s(()=>[q(" Foto "),Ue]),_:1},8,["rules","onClick:clear"]))]),_:1})]),_:1}),r(D,null,{default:s(()=>[r(i,{cols:"12",class:"d-flex justify-center"},{default:s(()=>[F("div",Ie,[r(Fe,{src:e(v).imageUrl??("storageBack"in l?l.storageBack:e(x))(e(t).photo)},null,8,["src"])])]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1}),r(T,null,{default:s(()=>[r(L,{ref_key:"complementaryValidation",ref:z,"lazy-validation":""},{default:s(()=>[r(D,null,{default:s(()=>[r(i,{cols:"12"},{default:s(()=>[$e]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(d,{clearable:"",items:e(U),rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(n).grade_id,"onUpdate:modelValue":a[13]||(a[13]=o=>e(n).grade_id=o),label:"Grados y niveles"},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(d,{clearable:"",items:e(C),rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(n).section_id,"onUpdate:modelValue":a[14]||(a[14]=o=>e(n).section_id=o),label:"Secciones"},null,8,["items","rules","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(d,{clearable:"",multiple:"",rules:["requiredValidator"in l?l.requiredValidator:e(p)],items:e(h),modelValue:e(n).subjects,"onUpdate:modelValue":a[15]||(a[15]=o=>e(n).subjects=o),label:"Materias"},null,8,["rules","items","modelValue"])]),_:1}),r(i,{cols:"12",sm:"3"},{default:s(()=>[r(B,{color:"success",onClick:a[16]||(a[16]=o=>Q())},{default:s(()=>[q("Agregar")]),_:1})]),_:1}),r(i,{cols:"12"},{default:s(()=>[r(we,{headers:H,items:e(t).complementaries,"items-per-page":999},{"item.subjects":s(({item:o})=>[(y(!0),G(ue,null,de(o.subjects,(_,b)=>(y(),$(je,{color:"primary",class:"mr-2",key:b},{default:s(()=>[q(me(_.title),1)]),_:2},1024))),128))]),"item.actions":s(({item:o,index:_})=>[r(B,{icon:"",size:"x-small",color:"error",variant:"text",onClick:b=>W(_)},{default:s(()=>[r(ie,{size:"22",icon:"tabler-trash"}),r(ne,{location:"top",transition:"scale-transition",activator:"parent",text:"Eliminar"})]),_:2},1032,["onClick"])]),bottom:s(()=>[]),_:1},8,["items"])]),_:1})]),_:1})]),_:1},512)]),_:1}),r(T,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:s(()=>[r(g,{disabled:e(k),loading:e(k)},null,8,["disabled","loading"]),e(w)?pe("",!0):(y(),$(B,{key:0,disabled:e(k),loading:e(k),onClick:a[17]||(a[17]=o=>J()),color:"primary"},{default:s(()=>[q(" Guardar ")]),_:1},8,["disabled","loading"]))]),_:1})]),_:1},8,["disabled","loading"])])}}});export{fa as default};
