import{V as Q,r as W}from"./VForm-BRC6XYpK.js";import{cu as X,r as V,d as M,R as D,a as Y,o as v,g as F,f as i,b as l,z as Z,c as k,F as x,p as I,k as r,ae as w,G as ee,U as te,ax as se,af as S,e as T,D as ae,ad as P,C as B}from"./index-1WWuo6NY.js";import{a as G,e as le,V as ie}from"./VList-gC342nkX.js";import{V as U}from"./VSwitch-Dm29A9h1.js";import{_ as oe}from"./AppTextField.vue_vue_type_script_setup_true_lang-CDXSNgFz.js";import{_ as re}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-j27Nq_yt.js";import{V as ne}from"./VDialog-BwrZDoL0.js";import{V as q}from"./VGrid-B4Cy2rWm.js";import{V as N,a as j}from"./VRow-DK9zpBao.js";import{V as z}from"./VSkeletonLoader-BMDD3Q0z.js";import{V as de}from"./VCard-BJHuRcVX.js";const O=X("useRoleStore",{state:()=>({arrayFather:V([]),selectedFather:V([]),selectedElements:V([]),keyIdComparation:V("id"),keyArray:V("permissions")}),getters:{},actions:{clearPermissionsSelected(){this.selectedElements=[1]},handleCardCheckboxChange(s){this.selectedFather.includes(s)?this.selectAllPermissions(s):this.deselectAllPermissions(s)},selectAllPermissions(s){console.log("this.arrayFather",this.arrayFather);const n=this.arrayFather.findIndex(t=>t[this.keyIdComparation]==s);n!==-1?this.arrayFather[n][this.keyArray].forEach(m=>{this.selectedElements.includes(m[this.keyIdComparation])||this.selectedElements.push(m.id)}):this.arrayFather.forEach(t=>{this.searchInChildrenToAdd(t,s)})},searchInChildrenToAdd(s,n){s.children.forEach(t=>{t[this.keyIdComparation]===n&&!this.selectedElements.includes(t.id)&&this.selectedElements.push(t.id),t.children&&t.children.length>0&&this.searchInChildrenToAdd(t,n)})},deselectAllPermissions(s){const n=t=>{const m=t.findIndex(f=>f[this.keyIdComparation]==s);if(m!==-1){const f=t[m][this.keyArray].map(h=>h.id);return this.selectedElements=this.selectedElements.filter(h=>!f.includes(h)),!0}for(const f of t)if(f.children&&f.children.length>0&&n(f.children))return!0;return!1};n(this.arrayFather)}}}),ue=M({__name:"ListGroup",props:{father:{required:!0,type:Object}},setup(s){const n=O(),{selectedElements:t,selectedFather:m}=D(n);return(f,h)=>{const b=Y("ListGroup",!0);return v(),F(le,null,{activator:i(({props:d})=>[l(G,Z(d,{title:s.father.title,"prepend-icon":s.father.icon}),null,16,["title","prepend-icon"])]),default:i(()=>[l(G,null,{default:i(()=>[(v(!0),k(x,null,I(s.father.permissions,({id:d,description:g,check_state:L},E)=>(v(),k(x,{key:E},[d!=1&&E==0?(v(),F(U,{key:0,class:"mb-2",label:"Todos",value:s.father.id,id:"selectAll-"+s.father.id,modelValue:r(m),"onUpdate:modelValue":[h[0]||(h[0]=e=>w(m)?m.value=e:null),e=>r(n).handleCardCheckboxChange(s.father.id)]},null,8,["value","id","modelValue","onUpdate:modelValue"])):ee("",!0),l(U,{disabled:d==1,class:"my-0 py-0",label:g,value:d,id:`permissions-${d}`,modelValue:r(t),"onUpdate:modelValue":h[1]||(h[1]=e=>w(t)?t.value=e:null)},null,8,["disabled","label","value","id","modelValue"])],64))),128))]),_:1}),(v(!0),k(x,null,I(s.father.children,(d,g)=>(v(),F(b,{key:g,father:d},null,8,["father"]))),128))]),_:1})}}}),me={class:"text-h4 text-center mb-2"},ce=T("p",{class:"text-body-1 text-center mb-6"},"Establecer permisos del rol",-1),pe=T("h5",{class:"text-h5 my-6"},"Permisos de rol",-1),xe=M({__name:"ModalForm",emits:["updateDataTable"],setup(s,{expose:n,emit:t}){const m=te(),{company:f}=D(m),h=t,b=V({}),d=O(),{selectedElements:g,arrayFather:L,selectedFather:E}=D(d),e=se({isDialogVisible:!1,isLoading:!1,titleForm:"Crear",menus:[]}),c=V({id:null,description:null,company_id:null,permissions:[]}),_=(u=!1)=>{e.isDialogVisible=u},$=()=>{c.value.id=null,c.value.description=null,c.value.permissions=[]},H=async()=>{d.clearPermissionsSelected(),$(),e.isLoading=!0,_(!0),e.titleForm="Crear";const{data:u,isFetching:a}=await S("role/create").get();e.isLoading=a.value,c.value.company_id=f.value.id,e.menus=u.value.menus,L.value=e.menus},J=async({id:u})=>{var C,o;d.clearPermissionsSelected(),$(),e.isLoading=!0,_(!0),e.titleForm="Editar";const{response:a,data:p,isFetching:y}=await S(`role/${u}/edit`).get();e.isLoading=y.value,(C=a.value)!=null&&C.ok&&((o=p.value)==null?void 0:o.code)==200&&(e.menus=p.value.menus,c.value.id=p.value.role.id,c.value.description=p.value.role.description,c.value.company_id=p.value.role.company_id,g.value=p.value.role.permissions,L.value=e.menus)},K=async()=>{var a,p,y;c.value.permissions=g.value;const u=await((a=R.value)==null?void 0:a.validate());if(u!=null&&u.valid){e.isLoading=!0;const{response:C,data:o,isFetching:A}=await S("role").post(c.value);e.isLoading=A.value,(p=C.value)!=null&&p.ok&&((y=o.value)==null?void 0:y.code)==200&&(h("updateDataTable"),_(!1)),o.value.code===422&&(b.value=o.value.errors??{})}},R=V();return n({handleCreate:H,handleEdit:J}),(u,a)=>{const p=re,y=oe,C=ue;return v(),F(ne,{modelValue:r(e).isDialogVisible,"onUpdate:modelValue":a[5]||(a[5]=o=>r(e).isDialogVisible=o),"max-width":"1080px",persistent:"",transition:"dialog-transition"},{default:i(()=>[l(p,{onClick:a[0]||(a[0]=o=>_())}),l(de,null,{default:i(()=>[l(q,{class:"pa-sm-10 pa-2"},{default:i(()=>[T("h4",me,ae(`${r(e).titleForm} rol`),1),ce,l(Q,{ref_key:"formRole",ref:R},{default:i(()=>[l(N,null,{default:i(()=>[l(j,{cols:"12"},{default:i(()=>[l(z,{type:"text",loading:r(e).isLoading},{default:i(()=>[l(y,{requiredField:!0,label:"Nombre de rol",modelValue:r(c).description,"onUpdate:modelValue":a[1]||(a[1]=o=>r(c).description=o),rules:["requiredValidator"in u?u.requiredValidator:r(W)],clearable:"","error-messages":r(b).description,onInput:a[2]||(a[2]=o=>r(b).description="")},null,8,["modelValue","rules","error-messages"])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512),pe,l(z,{type:"list-item, list-item, list-item, list-item, list-item, list-item",loading:r(e).isLoading},{default:i(()=>[l(N,null,{default:i(()=>[l(j,null,{default:i(()=>[l(ie,{border:""},{default:i(()=>[(v(!0),k(x,null,I(r(e).menus,(o,A)=>(v(),F(C,{key:A,father:o},null,8,["father"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),l(q,{class:"d-flex align-center justify-center gap-4"},{default:i(()=>[l(P,{color:"secondary",onClick:a[3]||(a[3]=o=>_())},{default:i(()=>[B("Cancelar")]),_:1}),l(P,{"prepend-icon":"tabler-device-floppy",onClick:a[4]||(a[4]=o=>K()),loading:r(e).isLoading},{default:i(()=>[B(" Guardar cambios")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{xe as _};
