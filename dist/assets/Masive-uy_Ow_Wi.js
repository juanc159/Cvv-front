import{r as v}from"./validators-C2Y1mJAW.js";import{d as fe,U as pe,r as m,X as ve,c as A,o as _,b as e,f as r,a8 as f,az as Ve,e as s,F as K,p as O,E as ge,D as U,g as L,x as P,ad as E,C as b,ac as z,k as V,ay as _e,Y as be,Z as ye}from"./index-CQ5LwE8r.js";import{_ as qe}from"./AppSelect.vue_vue_type_script_setup_true_lang-D4wrV86H.js";import{_ as Ce}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-DrPHqJSJ.js";import{u as T}from"./useAxios-BA9-clw4.js";import{o as W}from"./helpers-B_zKm85t.js";import{b as Q,V as x}from"./VCard-JKtH56dP.js";import{V as I}from"./VCardText-D6bON79e.js";import{V as N,a as p}from"./VRow-ocuWGgYQ.js";import{V as R}from"./VDivider-CvhtBvMu.js";import{V as B}from"./VForm-DLT830yQ.js";import{V as ee}from"./VSpacer-btdGLzUy.js";import{V as le}from"./VDialog-d0rYhkcX.js";import{V as ae}from"./VTextField-C4UCk_EU.js";import{V as we}from"./VTable-DAb8weJk.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTooltip-oTjvs5Vh.js";import"./VOverlay-bLSEVn9u.js";import"./VImg-De6hWsIg.js";import"./forwardRefs-C-GTDzx5.js";import"./VInput-BqCcxrym.js";import"./VSelect-BWOslUTJ.js";import"./VList-DktQQALS.js";import"./ssrBoot-DSYWuai_.js";import"./VAvatar-DbSbetP_.js";import"./dialog-transition-CWo1Z0Yi.js";import"./VMenu-RovNws4k.js";import"./VCheckboxBtn-CI2ehhay.js";import"./VSelectionControl-D0KUwFUG.js";import"./VChip-B9yyqRQ0.js";import"./constants-2GBt7OCP.js";/* empty css              *//* empty css                   */import"./VCounter-CLbdetcI.js";const Y=G=>(be("data-v-bc8be076"),G=G(),ye(),G),ke=Y(()=>s("span",{class:"text-white text-h5"},"Generador de constancias masivas",-1)),he={class:"certificates-section"},Ee=Y(()=>s("h3",{class:"text-h6 mb-4"},"Seleccione el tipo de constancia",-1)),Ie={class:"d-flex align-center mb-3"},Fe={class:"text-h6"},Ue={class:"text-body-2 text-grey-darken-1"},Ne=Y(()=>s("thead",null,[s("tr",null,[s("th",{style:{width:"40%"}},"Nombre"),s("th",{style:{width:"30%"}},"Documento"),s("th",{style:{width:"30%"}},"Literal")])],-1)),Ge=fe({__name:"Masive",setup(G){const D=pe(),{toast:re}=_e(),te=m(""),g=m(!1),d=m(null),q=m([]),C=m(!0),w=m(null),X=m(),y=m(!1),S=m(!1),k=m(""),ie=ve(()=>{if(!k.value.trim())return q.value;const a=k.value.trim().toLowerCase();return q.value.filter(l=>l.full_name.toLowerCase().includes(a)||l.identity_document.toLowerCase().includes(a))}),oe=(a=!1)=>{Z(),y.value=a,a||J()},i=m({grade_id:null,section_id:null,ordering:null}),Z=()=>{var a;i.value={grade_id:null,section_id:null,ordering:null},(a=w.value)==null||a.resetValidation()},$=[{value:1,title:"A"},{value:2,title:"B"},{value:3,title:"C"},{value:4,title:"D"},{value:5,title:"E"}],de=[{value:1,title:"Primer Nivel"},{value:2,title:"Segundo Nivel"}],ne=[{value:4,title:"1er Grado"},{value:5,title:"2do Grado"},{value:6,title:"3er Grado"},{value:7,title:"4to Grado"},{value:8,title:"5to Grado"},{value:9,title:"6to Grado"}],M=[{value:"full_name",title:"Apellidos y nombres"},{value:"identity_document",title:"Documento"}],j=async a=>{try{const l={grade_id:i.value.grade_id,section_id:i.value.section_id,ordering:i.value.ordering,company_id:D.company.id};if(a==="/documents/searchStudentFor"){const{data:n,response:u}=await T(a).get({params:l});if(u.status===200&&(n!=null&&n.students))q.value=n.students.map(t=>({...t,literal:t.literal||""})),y.value=!1,S.value=!0;else throw new Error("Invalid response format")}else{const{data:n,response:u}=await T(a).get({params:l});if(u.status===200&&(n!=null&&n.pdf))W(n.pdf);else throw new Error("Invalid response format")}}catch(l){console.error(`Error downloading certificate from ${a}:`,l)}},se=async()=>{var l;const a=await((l=X.value)==null?void 0:l.validate());if(console.log("Validation result:",a),!(a!=null&&a.valid)){re("Faltan Campos Por Diligenciar","","danger");return}try{g.value=!0;const{data:n,response:u}=await T("/student/saveLiterals").post({students:q.value.map(t=>({id:t.id,literal:t.literal})),company_id:D.company.id});if(u.status===200){const{data:t,response:c}=await T("/documents/prosecutionPrimaryEducation").get({params:{grade_id:i.value.grade_id,section_id:i.value.section_id,ordering:i.value.ordering,company_id:D.company.id}});if(c.status===200&&(t!=null&&t.pdf))W(t.pdf),S.value=!1;else throw new Error("Invalid response format")}}catch(n){console.error("Error saving literals:",n)}finally{g.value=!1}},ue=[{id:1,title:"Constancia de Prosecución - Educación Inicial (Primer y Segundo Nivel)",icon:"tabler-school",description:"Certificado para estudiantes del Nivel de Educación Inicial que cursan Primer o Segundo Nivel.",requiresAdditionalInfo:!0,handler:()=>j("/documents/prosecutionInitialEducation")},{id:2,title:"Certificado de Educación Inicial (Tercer Nivel)",icon:"tabler-school",description:"Certificado para estudiantes del Nivel de Educación Inicial que cursan Tercer Nivel.",requiresAdditionalInfo:!0,handler:()=>j("/documents/certificateInitialEducation")},{id:3,title:"Constancia de Prosecución - Educación Primaria",icon:"tabler-school",description:"Certificado para estudiantes del Nivel de Educación Primaria que cursan desde 1er hasta 6to grado.",requiresAdditionalInfo:!0,handler:()=>j("/documents/searchStudentFor")}],ce=async()=>{const a=w.value;if(!a)return!1;const{valid:l}=await a.validate();return l},me=a=>{d.value=a,a.requiresAdditionalInfo&&(y.value=!0)},F=async(a=!0)=>{if(d.value&&!(a&&!await ce())){g.value=!0;try{await d.value.handler()}catch(l){console.error("Error al generar certificado:",l)}finally{g.value=!1}}},H=()=>{var a;S.value=!1,q.value=[],k.value="",(a=w.value)==null||a.resetValidation()},J=()=>{d.value=null,te.value="",S.value=!1,y.value=!1,k.value="",q.value=[],Z()};return(a,l)=>{const n=Ce,u=qe;return _(),A("div",null,[e(x,{class:"elevation-3",loading:g.value},{default:r(()=>[e(Q,{class:"d-flex align-center pa-4 bg-primary"},{default:r(()=>[e(f,{icon:"tabler-certificate",class:"me-2",color:"white"}),ke]),_:1}),e(I,{class:"pa-6"},{default:r(()=>[e(Ve,null,{default:r(()=>[s("div",he,[Ee,e(N,null,{default:r(()=>[(_(),A(K,null,O(ue,t=>e(p,{key:t.id,cols:"12",sm:"6",md:"4"},{default:r(()=>{var c;return[e(x,{class:ge(["certificate-card pa-4 cursor-pointer",{selected:((c=d.value)==null?void 0:c.id)===t.id}]),onClick:h=>me(t),elevation:"2",hover:""},{default:r(()=>{var h;return[s("div",Ie,[e(f,{icon:t.icon,size:"32",class:"me-3",color:((h=d.value)==null?void 0:h.id)===t.id?"primary":"grey"},null,8,["icon","color"]),s("h4",Fe,U(t.title),1)]),s("p",Ue,U(t.description),1)]}),_:2},1032,["class","onClick"])]}),_:2},1024)),64))]),_:1})])]),_:1})]),_:1}),e(R),e(I,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:r(()=>[e(E,{color:"error",variant:"outlined",onClick:J},{default:r(()=>[e(f,{icon:"tabler-x",class:"me-2"}),b(" Cancelar ")]),_:1}),d.value&&!d.value.requiresAdditionalInfo?(_(),L(E,{key:0,color:"primary",onClick:l[0]||(l[0]=t=>F(!1)),disabled:!d.value,loading:g.value},{default:r(()=>[e(f,{icon:"tabler-printer",class:"me-2"}),b(" Generar Constancia ")]),_:1},8,["disabled","loading"])):P("",!0)]),_:1})]),_:1},8,["loading"]),e(le,{modelValue:y.value,"onUpdate:modelValue":l[14]||(l[14]=t=>y.value=t),width:"600",persistent:""},{default:r(()=>[e(n,{onClick:l[1]||(l[1]=t=>oe())}),e(x,null,{default:r(()=>[e(Q,{class:"bg-primary text-white pa-4"},{default:r(()=>{var t,c;return[e(f,{icon:(t=d.value)==null?void 0:t.icon,class:"me-2",color:"white"},null,8,["icon"]),b(" "+U((c=d.value)==null?void 0:c.title),1)]}),_:1}),e(I,{class:"pa-6"},{default:r(()=>{var t,c,h;return[((t=d.value)==null?void 0:t.id)===1?(_(),L(B,{key:0,onSubmit:z(F,["prevent"]),modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=o=>C.value=o),ref_key:"form",ref:w},{default:r(()=>[e(N,null,{default:r(()=>[e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.grade_id,"onUpdate:modelValue":l[2]||(l[2]=o=>i.value.grade_id=o),items:de,label:"Seleccione el grado ",required:""},null,8,["rules","modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.section_id,"onUpdate:modelValue":l[3]||(l[3]=o=>i.value.section_id=o),items:$,label:"Seleccione la sección",required:""},null,8,["rules","modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.ordering,"onUpdate:modelValue":l[4]||(l[4]=o=>i.value.ordering=o),items:M,label:"Seleccione el ordenamiento",required:""},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0),((c=d.value)==null?void 0:c.id)===2?(_(),L(B,{key:1,onSubmit:z(F,["prevent"]),modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=o=>C.value=o),ref_key:"form",ref:w},{default:r(()=>[e(N,null,{default:r(()=>[e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.section_id,"onUpdate:modelValue":l[6]||(l[6]=o=>i.value.section_id=o),items:$,label:"Seleccione la sección",required:""},null,8,["rules","modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.ordering,"onUpdate:modelValue":l[7]||(l[7]=o=>i.value.ordering=o),items:M,label:"Seleccione el ordenamiento",required:""},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0),((h=d.value)==null?void 0:h.id)===3?(_(),L(B,{key:2,onSubmit:z(F,["prevent"]),modelValue:C.value,"onUpdate:modelValue":l[12]||(l[12]=o=>C.value=o),ref_key:"form",ref:w},{default:r(()=>[e(N,null,{default:r(()=>[e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.grade_id,"onUpdate:modelValue":l[9]||(l[9]=o=>i.value.grade_id=o),items:ne,label:"Seleccione el grado",required:""},null,8,["rules","modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.section_id,"onUpdate:modelValue":l[10]||(l[10]=o=>i.value.section_id=o),items:$,label:"Seleccione la sección",required:""},null,8,["rules","modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:r(()=>[e(u,{rules:["requiredValidator"in a?a.requiredValidator:V(v)],clearable:"",requiredField:!0,modelValue:i.value.ordering,"onUpdate:modelValue":l[11]||(l[11]=o=>i.value.ordering=o),items:M,label:"Seleccione el ordenamiento",required:""},null,8,["rules","modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])):P("",!0)]}),_:1}),e(R),e(I,{class:"d-flex align-center justify-center gap-4"},{default:r(()=>[e(ee),e(E,{color:"error",variant:"outlined",onClick:l[13]||(l[13]=t=>y.value=!1)},{default:r(()=>[e(f,{icon:"tabler-x",class:"me-2"}),b(" Cancelar ")]),_:1}),e(E,{color:"primary",onClick:F,loading:g.value,disabled:!d.value},{default:r(()=>[e(f,{icon:"tabler-printer",class:"me-2"}),b(" Generar Constancia ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(le,{modelValue:S.value,"onUpdate:modelValue":l[17]||(l[17]=t=>S.value=t),width:"80rem",persistent:""},{default:r(()=>[e(n,{onClick:l[15]||(l[15]=t=>H())}),e(x,null,{default:r(()=>[e(Q,{class:"bg-primary text-white pa-4"},{default:r(()=>[e(f,{icon:"tabler-users",class:"me-2",color:"white"}),b(" Lista de Estudiantes ")]),_:1}),e(I,{class:"pa-6"},{default:r(()=>[e(N,{class:"mb-4"},{default:r(()=>[e(p,{cols:"12"},{default:r(()=>[e(ae,{modelValue:k.value,"onUpdate:modelValue":l[16]||(l[16]=t=>k.value=t),label:"Buscar por nombre o documento","prepend-inner-icon":"tabler-search",clearable:"",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{ref_key:"formValidateStudents",ref:X},{default:r(()=>[e(we,null,{default:r(()=>[Ne,s("tbody",null,[(_(!0),A(K,null,O(ie.value,t=>(_(),A("tr",{key:t.id},[s("td",null,U(t.full_name),1),s("td",null,U(t.identity_document),1),s("td",null,[e(ae,{modelValue:t.literal,"onUpdate:modelValue":c=>t.literal=c,rules:["requiredValidator"in a?a.requiredValidator:V(v)],maxlength:"1",label:"Literal",required:""},null,8,["modelValue","onUpdate:modelValue","rules"])])]))),128))])]),_:1})]),_:1},512)]),_:1}),e(R),e(I,{class:"d-flex align-center justify-center gap-4"},{default:r(()=>[e(ee),e(E,{color:"error",variant:"outlined",onClick:H},{default:r(()=>[e(f,{icon:"tabler-x",class:"me-2"}),b(" Cancelar ")]),_:1}),e(E,{color:"primary",onClick:se,loading:g.value},{default:r(()=>[e(f,{icon:"tabler-printer",class:"me-2"}),b(" Guardar y Generar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),fl=Se(Ge,[["__scopeId","data-v-bc8be076"]]);export{fl as default};
