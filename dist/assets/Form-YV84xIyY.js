import{r as p,e as Z}from"./validators-DQNwaKQj.js";import{s as x}from"./helpers-BPprKBaR.js";import{d as ee,V as ae,r as c,t as le,b5 as oe,N as te,Y as I,w as re,c as G,o as y,b as t,f as s,e as F,l as e,ac as se,h as $,D as q,a9 as T,a7 as ie,ad as ne,F as ue,q as de,E as me,y as pe,aT as M,aY as ce,aS as fe}from"./index-CtOr4Wu7.js";import{_ as ve}from"./BtnBack.vue_vue_type_script_setup_true_lang-LvM9IGc6.js";import{_ as Ve}from"./AppTextField.vue_vue_type_script_setup_true_lang-tPb9GRlz.js";import{_ as be}from"./AppSelect.vue_vue_type_script_setup_true_lang-K6gbidqT.js";import{c as ge}from"./createUrl-D9sypOAs.js";import{u as _e,V as ye}from"./VFileInput-kuWJjQCq.js";import{a as ke,V as qe}from"./VCard-COZucsTL.js";import{V as B}from"./VCardText-v8gCKQRH.js";import{V as L}from"./VForm-BhvUgRDX.js";import{V as S,a as i}from"./VRow-C1C7EzPn.js";import{V as Fe}from"./VImg-Ctxsnw81.js";import{V as we}from"./VDataTable-B3A_M1eK.js";import{V as je}from"./VChip-X8cnhpwt.js";import"./constants-2GBt7OCP.js";import"./ModalQuestion.vue_vue_type_script_setup_true_lang-B9CXAvdJ.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-6vZWU1pl.js";import"./VDialog-CybUf8DC.js";import"./dialog-transition-dwJwLnHT.js";import"./VTextField-B5WBRC1t.js";/* empty css                   */import"./VCounter-DANGpuYg.js";import"./VSelect-BZZhkYMh.js";import"./VList-BoAmY9IJ.js";import"./ssrBoot-CB8iZIPO.js";import"./VAvatar-e7AxYF9T.js";import"./VDivider-Du-RozYy.js";import"./VMenu-D4hRRJEr.js";import"./VCheckboxBtn-Cah7cXyy.js";import"./VSelectionControl-Uad4iysT.js";import"./index-0F-JFElI.js";import"./sweetalert2.esm.all-DV3w3JmD.js";/* empty css              */import"./VTable-ClsD0PQ0.js";import"./filter-RDRewW1g.js";const Ce=F("span",null," Formulario docente ",-1),Ue=F("b",{class:"text-warning"},"*",-1),Ie={style:{"block-size":"200px","inline-size":"200px"}},$e=F("h3",null,"Información complementaria",-1),ca=ee({__name:"Form",setup(Te){const D=ae(),{toast:A}=fe(),m=c({}),w=c(!1),E=le(),N=c(),z=c(),f=oe({form:!1}),j=c([]),P=c([]),C=c([]),r=c({id:null,type_education_id:null,job_position_id:null,name:null,last_name:null,email:null,password:null,phone:null,photo:null,company_id:null,complementaries:[]}),O=()=>{for(const l in r.value)r.value[l]=null;r.value.complementaries=[]},R=async()=>{var u;r.value.id=E.params.id||null;const l=r.value.id?`/teacher/${r.value.id}/edit`:"/teacher/create";f.form=!0;const{data:a,response:d}=await M(ge(l,{query:{company_id:D.company.id}}));f.form=!1,(u=d.value)!=null&&u.ok&&a.value&&(j.value=a.value.typeEducations,P.value=a.value.jobPositions,C.value=a.value.sections,a.value.form&&(r.value=a.value.form))},Y=async()=>{var a,d;const l=await((a=N.value)==null?void 0:a.validate());if(l!=null&&l.valid){r.value.company_id=D.company.id;const u=new FormData;for(const b in r.value)["complementaries"].includes(b)||u.append(b,r.value[b]);u.append("complementaries",JSON.stringify(r.value.complementaries));const g=r.value.id?`/teacher/update/${r.value.id}`:"/teacher/store";f.form=!0;const{data:o,response:_}=await M(g).post(u);f.form=!1,(d=_.value)!=null&&d.ok&&o.value&&o.value.code==200&&ce.push({name:"Teacher-List"}),o.value.code===422&&(m.value=o.value.errors??{})}else A("Faltan Campos Por Diligenciar","","danger")};E.params.action=="view"&&(w.value=!0),te(async()=>{O(),await R()});const k=I(()=>Object.values(f).some(l=>l)),V=c([]),v=c(_e()),J=["jpg","jpeg","png"];v.value.allowedExtensions=J;const H=l=>{v.value.handleImageSelected(l),setTimeout(()=>{r.value.photo=v.value.imageFile},1e3)};re(r,(l,a)=>{l.id?(V.value.photo=[],V.value.password=[]):(V.value.photo=[p(v.value.imageUrl)],V.value.password=[p])},{deep:!0});const K=[{title:"Grado o nivel",key:"grade_name"},{title:"Sección",key:"section_name"},{title:"Materias",key:"subjects"},{title:"Acciones",key:"actions"}],n=c({grade_id:null,section_id:null,subjects:[]}),Q=()=>{n.value={grade_id:null,section_id:null,subjects:[]}},W=async()=>{var a;const l=await((a=z.value)==null?void 0:a.validate());if(l!=null&&l.valid){const d=U.value.find(o=>o.value==n.value.grade_id),u=C.value.find(o=>o.value==n.value.section_id),g=h.value.filter(o=>n.value.subjects.includes(o.value));r.value.complementaries.push({id:null,grade_id:n.value.grade_id,grade_name:d.title,section_id:n.value.section_id,section_name:u.title,subjects:g,delete:0}),Q()}else A("Faltan Campos Por Diligenciar","","danger")},X=l=>{r.value.complementaries.splice(l,1)},U=I(()=>r.value.type_education_id?j.value.find(l=>l.value==r.value.type_education_id).grades:[]),h=I(()=>n.value.grade_id?U.value.find(l=>l.value==n.value.grade_id).subjects:[]);return(l,a)=>{const d=be,u=Ve,g=ve;return y(),G("div",null,[t(qe,{disabled:e(f).form,loading:e(f).form},{default:s(()=>[t(ke,{class:"d-flex justify-space-between"},{default:s(()=>[Ce]),_:1}),t(B,null,{default:s(()=>[t(L,{ref_key:"formValidation",ref:N,onSubmit:se(()=>{},["prevent"]),disabled:e(w)},{default:s(()=>[t(S,null,{default:s(()=>[t(i,{cols:"12",sm:"3"},{default:s(()=>[t(d,{items:e(j),clearable:"",rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(r).type_education_id,"onUpdate:modelValue":a[0]||(a[0]=o=>e(r).type_education_id=o),label:"Tipo de educación",requiredField:!0},null,8,["items","rules","modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(d,{items:e(P),rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(r).job_position_id,"onUpdate:modelValue":a[1]||(a[1]=o=>e(r).job_position_id=o),label:"Cargo",requiredField:!0},null,8,["items","rules","modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(u,{clearable:"",modelValue:e(r).name,"onUpdate:modelValue":a[2]||(a[2]=o=>e(r).name=o),rules:["requiredValidator"in l?l.requiredValidator:e(p)],"error-messages":e(m).name,label:"Nombre",onInput:a[3]||(a[3]=o=>e(m).name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(u,{clearable:"",modelValue:e(r).last_name,"onUpdate:modelValue":a[4]||(a[4]=o=>e(r).last_name=o),rules:["requiredValidator"in l?l.requiredValidator:e(p)],"error-messages":e(m).last_name,label:"Apellido",onInput:a[5]||(a[5]=o=>e(m).last_name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(u,{clearable:"",modelValue:e(r).email,"onUpdate:modelValue":a[6]||(a[6]=o=>e(r).email=o),rules:["requiredValidator"in l?l.requiredValidator:e(p),"emailValidator"in l?l.emailValidator:e(Z)],"error-messages":e(m).email,label:"Correo",onInput:a[7]||(a[7]=o=>e(m).email=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(u,{clearable:"",modelValue:e(r).password,"onUpdate:modelValue":a[8]||(a[8]=o=>e(r).password=o),"error-messages":e(m).password,label:"Contraseña",onInput:a[9]||(a[9]=o=>e(m).password=""),requiredField:!e(r).id,rules:e(V).password},null,8,["modelValue","error-messages","requiredField","rules"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(u,{clearable:"",modelValue:e(r).phone,"onUpdate:modelValue":a[10]||(a[10]=o=>e(r).phone=o),rules:["requiredValidator"in l?l.requiredValidator:e(p)],"error-messages":e(m).phone,label:"Teléfono",onInput:a[11]||(a[11]=o=>e(m).phone=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[(y(),$(ye,{accept:"image/*",rules:e(V).photo,key:e(v).key,onChange:a[12]||(a[12]=o=>H(o)),"onClick:clear":e(v).clearData},{label:s(()=>[q(" Foto "),Ue]),_:1},8,["rules","onClick:clear"]))]),_:1})]),_:1}),t(S,null,{default:s(()=>[t(i,{cols:"12",class:"d-flex justify-center"},{default:s(()=>[F("div",Ie,[t(Fe,{src:e(v).imageUrl??("storageBack"in l?l.storageBack:e(x))(e(r).photo)},null,8,["src"])])]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1}),t(B,null,{default:s(()=>[t(L,{ref_key:"complementaryValidation",ref:z,"lazy-validation":""},{default:s(()=>[t(S,null,{default:s(()=>[t(i,{cols:"12"},{default:s(()=>[$e]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(d,{clearable:"",items:e(U),rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(n).grade_id,"onUpdate:modelValue":a[13]||(a[13]=o=>e(n).grade_id=o),label:"Grados y niveles"},null,8,["items","rules","modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(d,{clearable:"",items:e(C),rules:["requiredValidator"in l?l.requiredValidator:e(p)],modelValue:e(n).section_id,"onUpdate:modelValue":a[14]||(a[14]=o=>e(n).section_id=o),label:"Secciones"},null,8,["items","rules","modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(d,{clearable:"",multiple:"",rules:["requiredValidator"in l?l.requiredValidator:e(p)],items:e(h),modelValue:e(n).subjects,"onUpdate:modelValue":a[15]||(a[15]=o=>e(n).subjects=o),label:"Materias"},null,8,["rules","items","modelValue"])]),_:1}),t(i,{cols:"12",sm:"3"},{default:s(()=>[t(T,{color:"success",onClick:a[16]||(a[16]=o=>W())},{default:s(()=>[q("Agregar")]),_:1})]),_:1}),t(i,{cols:"12"},{default:s(()=>[t(we,{headers:K,items:e(r).complementaries,"items-per-page":999},{"item.subjects":s(({item:o})=>[(y(!0),G(ue,null,de(o.subjects,(_,b)=>(y(),$(je,{color:"primary",class:"mr-2",key:b},{default:s(()=>[q(me(_.title),1)]),_:2},1024))),128))]),"item.actions":s(({item:o,index:_})=>[t(T,{icon:"",size:"x-small",color:"error",variant:"text",onClick:b=>X(_)},{default:s(()=>[t(ie,{size:"22",icon:"tabler-trash"}),t(ne,{location:"top",transition:"scale-transition",activator:"parent",text:"Eliminar"})]),_:2},1032,["onClick"])]),bottom:s(()=>[]),_:1},8,["items"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(B,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:s(()=>[t(g,{disabled:e(k),loading:e(k)},null,8,["disabled","loading"]),e(w)?pe("",!0):(y(),$(T,{key:0,disabled:e(k),loading:e(k),onClick:a[17]||(a[17]=o=>Y()),color:"primary"},{default:s(()=>[q(" Guardar ")]),_:1},8,["disabled","loading"]))]),_:1})]),_:1},8,["disabled","loading"])])}}});export{ca as default};
