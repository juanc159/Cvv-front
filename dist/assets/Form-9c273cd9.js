import{V as E,r as m,e as Y}from"./VForm-fa69f99f.js";import{_ as Z}from"./AppTextField.vue_vue_type_script_setup_true_lang-ca6c5f3e.js";import{_ as x}from"./AppSelect.vue_vue_type_script_setup_true_lang-991ed3d0.js";import{d as ee,j as ae,r as c,a0 as le,$ as oe,E as te,w as re,a6 as j,o as y,c as N,b as l,f as r,n as e,g as z,t as k,e as w,a9 as S,F as ie,i as se,a1 as ne,a7 as ue,aw as de,ax as me,v as pe}from"./index-d7cd4679.js";import{u as ce}from"./useImageUpload-0e495373.js";import{u as fe}from"./useCrudTeacherStore-6c0beb31.js";import{V as Ve}from"./VCardText-7ded879f.js";import{V as g}from"./VRow-6f2922fc.js";import{V as s}from"./VCol-613d1fb3.js";import{V as ve}from"./VFileInput-5bacc0d0.js";import{V as ge}from"./VImg-6fa5e3fc.js";import{V as be}from"./VCard-e3db9ab7.js";import{V as _e}from"./VDataTable-98eca19a.js";import{V as ye}from"./VChip-000d3afd.js";import"./helpers-3edea678.js";import"./VField-72ba6fec.js";import"./VTextField-7aa7290a.js";import"./VSelect-77da1a23.js";import"./VList-0ccd67c2.js";import"./ssrBoot-1fa108f3.js";import"./VAvatar-a7a3edab.js";import"./VDivider-c727d838.js";import"./dialog-transition-e366f808.js";import"./VMenu-fbbddea5.js";import"./sweetalert2.all-ae952bba.js";import"./_commonjsHelpers-725317a4.js";/* empty css              */const ke=w("b",{class:"text-warning"},"*",-1),Ce={style:{"block-size":"200px","inline-size":"200px"}},qe=w("h3",null,"Información complementaria",-1),Ze=ee({__name:"Form",setup(Fe){const T=ae(),{toast:$}=me(),C=c();c();const U=c(),b=fe(),G=le(),{form:i,loading:q,jobPositions:K,typeEducations:P,subjects:I,sections:B,grades:D}=oe(b),d=c({}),_=c([]),p=c(ce()),h=["jpg","jpeg","png"];p.value.allowedExtensions=h;const M=async()=>{var o,V;i.value.company_id=G.company.id,i.value.complementaries=f.value;const a=await((o=C.value)==null?void 0:o.validate());if(a!=null&&a.valid){const n=await b.fetchSave();(n==null?void 0:n.code)===200&&(_.value=[],d.value={},p.value.clearData(),await((V=C.value)==null?void 0:V.resetValidation())),(n==null?void 0:n.code)===422&&(d.value=n.errors??{})}else $("Faltan Campos Por Diligenciar","","danger")},R=a=>{p.value.handleImageSelected(a),setTimeout(()=>{i.value.photo=p.value.imageFile},1e3)};te(async()=>{b.clearForm(),await b.fetchDataForm(Number(T.params.id),T.params.action),f.value=JSON.parse(JSON.stringify(i.value.complementaries))}),re(i,(a,o)=>{a.id?_.value.photo=[]:_.value.photo=[m(p.value.imageUrl)]},{deep:!0});const u=c({grade_id:null,section_id:null,subjects:[]}),f=c([]),J=[{title:"Grado o nivel",key:"grade_name"},{title:"Sección",key:"section_name"},{title:"Materias",key:"subjects"},{title:"Acciones",key:"actions"}],O=()=>{u.value={grade_id:null,section_id:null,subjects:[]}},H=async()=>{var o;const a=await((o=U.value)==null?void 0:o.validate());if(a!=null&&a.valid){const V=D.value.find(t=>t.value==u.value.grade_id),n=B.value.find(t=>t.value==u.value.section_id),v=I.value.filter(t=>u.value.subjects.includes(t.value));f.value.push({id:null,grade_id:u.value.grade_id,grade_name:V.title,section_id:u.value.section_id,section_name:n.title,subjects:v,delete:0}),O()}else $("Faltan Campos Por Diligenciar","","danger")},L=a=>{f.value[a].id?f.value[a].delete=1:f.value.splice(a,1)},Q=j(()=>f.value.filter(a=>a.delete!=1)),W=j(()=>D.value.filter(a=>a.type_education_id==i.value.type_education_id)),X=j(()=>I.value.filter(a=>a.type_education_id==i.value.type_education_id));return(a,o)=>{const V=de,n=x,v=Z;return y(),N("div",null,[l(be,{loading:e(q).form,disabled:e(q).form},{default:r(()=>[l(Ve,null,{default:r(()=>[l(g,null,{default:r(()=>[l(s,null,{default:r(()=>[l(V,{"sub-title":"Formulario Teacher",action:String(a.$route.params.action),"btn-action":"list","validate-crud":!0,"btn-back":!0,onChangeScreenBack:a.$router.back},null,8,["action","onChangeScreenBack"])]),_:1})]),_:1}),l(e(E),{ref_key:"formValidation",ref:C,"lazy-validation":""},{default:r(()=>[l(g,null,{default:r(()=>[l(s,{cols:"12",sm:"3"},{default:r(()=>[l(n,{items:e(P),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(i).type_education_id,"onUpdate:modelValue":o[0]||(o[0]=t=>e(i).type_education_id=t),label:"Tipo de educación"},null,8,["items","rules","modelValue"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(n,{items:e(K),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(i).job_position_id,"onUpdate:modelValue":o[1]||(o[1]=t=>e(i).job_position_id=t),label:"Cargo"},null,8,["items","rules","modelValue"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(v,{clearable:"",modelValue:e(i).name,"onUpdate:modelValue":o[2]||(o[2]=t=>e(i).name=t),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).name,label:"Nombre",onKeypress:o[3]||(o[3]=t=>e(d).name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(v,{clearable:"",modelValue:e(i).last_name,"onUpdate:modelValue":o[4]||(o[4]=t=>e(i).last_name=t),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).last_name,label:"Apellido",onKeypress:o[5]||(o[5]=t=>e(d).last_name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(v,{clearable:"",modelValue:e(i).email,"onUpdate:modelValue":o[6]||(o[6]=t=>e(i).email=t),rules:["requiredValidator"in a?a.requiredValidator:e(m),"emailValidator"in a?a.emailValidator:e(Y)],"error-messages":e(d).email,label:"Correo",onKeypress:o[7]||(o[7]=t=>e(d).email=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(v,{clearable:"",modelValue:e(i).phone,"onUpdate:modelValue":o[8]||(o[8]=t=>e(i).phone=t),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).phone,label:"Teléfono",onKeypress:o[9]||(o[9]=t=>e(d).phone=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[(y(),z(ve,{accept:"image/*",rules:e(_).photo,key:e(p).key,onChange:o[10]||(o[10]=t=>R(t)),"onClick:clear":e(p).clearData},{label:r(()=>[k(" Foto "),ke]),_:1},8,["rules","onClick:clear"]))]),_:1})]),_:1}),l(g,null,{default:r(()=>[l(s,{cols:"12",class:"d-flex justify-center"},{default:r(()=>[w("div",Ce,[l(ge,{src:e(p).imageUrl??e(i).photo},null,8,["src"])])]),_:1})]),_:1})]),_:1},512),l(e(E),{ref_key:"complementaryValidation",ref:U,"lazy-validation":""},{default:r(()=>[l(g,null,{default:r(()=>[l(s,{cols:"12"},{default:r(()=>[qe]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(n,{clearable:"",items:e(W),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(u).grade_id,"onUpdate:modelValue":o[11]||(o[11]=t=>e(u).grade_id=t),label:"Grados y niveles"},null,8,["items","rules","modelValue"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(n,{clearable:"",items:e(B),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(u).section_id,"onUpdate:modelValue":o[12]||(o[12]=t=>e(u).section_id=t),label:"Secciones"},null,8,["items","rules","modelValue"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(n,{clearable:"",multiple:"",rules:["requiredValidator"in a?a.requiredValidator:e(m)],items:e(X),modelValue:e(u).subjects,"onUpdate:modelValue":o[13]||(o[13]=t=>e(u).subjects=t),label:"Materias"},null,8,["rules","items","modelValue"])]),_:1}),l(s,{cols:"12",sm:"3"},{default:r(()=>[l(S,{color:"success",onClick:o[14]||(o[14]=t=>H())},{default:r(()=>[k("Agregar")]),_:1})]),_:1}),l(s,{cols:"12"},{default:r(()=>[l(e(_e),{headers:J,items:e(Q),"items-per-page":999},{"item.subjects":r(({item:t})=>[(y(!0),N(ie,null,se(t.subjects,(F,A)=>(y(),z(ye,{color:"primary",class:"mr-2",key:A},{default:r(()=>[k(pe(F.title),1)]),_:2},1024))),128))]),"item.actions":r(({item:t,index:F})=>[l(S,{icon:"",size:"x-small",color:"error",variant:"text",onClick:A=>L(F)},{default:r(()=>[l(ne,{size:"22",icon:"tabler-trash"}),l(ue,{location:"top",transition:"scale-transition",activator:"parent",text:"Eliminar"})]),_:2},1032,["onClick"])]),bottom:r(()=>[]),_:1},8,["items"])]),_:1})]),_:1})]),_:1},512),l(g,null,{default:r(()=>[l(s,{cols:"12",class:"d-flex justify-center"},{default:r(()=>[l(S,{loading:e(q).form,color:"primary",onClick:o[15]||(o[15]=t=>M())},{default:r(()=>[k(" Guardar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading","disabled"])])}}});export{Ze as default};
