import{h as y,b as Q}from"./helpers-Cnp_z4K8.js";import{V as j,r as B}from"./VForm-CpTkIOA0.js";import{_ as W}from"./DragAndDrop.vue_vue_type_script_setup_true_lang-BKWRlwm1.js";import{_ as X}from"./AppSelect.vue_vue_type_script_setup_true_lang-B4bOJrVh.js";import{d as Y,U as ee,ax as ae,r as _,M as oe,af as p,Z as le,o as r,c as $,k as a,g as c,f as e,G as V,b as o,C as f,ad as q,e as D,ae as te,F as I,p as L,D as se,ay as ie}from"./index-WEYjfviR.js";import{u as ne,V as de}from"./VFileInput-2B9aZUpi.js";import{c as re}from"./createUrl-C6wMW-m3.js";import{V as b,b as S}from"./VCard-6Fjj8wGG.js";import{V as m,a as u}from"./VRow-D59lUUrL.js";import{V as ue}from"./VInput-z-wn8k9l.js";import{V as g}from"./VGrid-DDsKsHMS.js";import{V as x}from"./VSwitch-RXay36b5.js";import{V as me}from"./VDivider-Czn9hx4z.js";import"./constants-2GBt7OCP.js";import"./forwardRefs-C-GTDzx5.js";import"./VImg-CEO3XFy-.js";import"./VSpacer-uJdlUf9D.js";import"./VAvatar-BarwGb-d.js";import"./VTooltip-CG751diI.js";import"./VOverlay-paiSBwrq.js";import"./VSelect-Y5DnodUr.js";import"./VTextField-zXAThMB7.js";import"./VList-Dwob2BkB.js";import"./ssrBoot-CgdycEz6.js";import"./dialog-transition-DUAJ1yaQ.js";import"./VMenu-ChWDw_ZU.js";import"./VCheckboxBtn-bwvZst3y.js";import"./VSelectionControl-P9xOOYur.js";import"./VChip-C_laid1S.js";import"./sweetalert2.esm.all-DOYwHpwi.js";import"./index-0F-JFElI.js";const _e=D("b",{class:"text-warning"},"*",-1),ce={class:"demo-space-x"},fe={class:"demo-space-x"},pe={class:"demo-space-x"},Je=Y({__name:"Index",setup(ge){const U=ee(),{toast:A}=ie(),s=ae({form:!1,download_notes:!1,block_uploading_of_grades_to_teachers:!1,viewing_notes:!1}),v=_({company_id:null,type_education_id:null,archive:null}),P=_({}),T=_(),R=_(),k=_([]),w=_(ne());w.value.allowedExtensions=["xls","xlsx"];const h=_(!1),F=_({});oe(async()=>{var n;await G(),s.form=!0;const{data:l,response:t}=await p("note-dataForm").get();(n=t.value)!=null&&n.ok&&l.value&&(k.value=l.value.typeEducations,h.value=l.value.blockData),s.form=!1});const G=async()=>{var n;const{data:l,response:t}=await p("/type_educations/visualization/show").get();(n=t.value)!=null&&n.ok&&l.value&&(F.value=l.value.selectedNotes)},M=async()=>{var t;v.value.archive=w.value.imageFile,v.value.company_id=U.company.id;const l=await((t=T.value)==null?void 0:t.validate());if(l!=null&&l.valid){const n=new FormData;for(const d in v.value)n.append(d,v.value[d]);s.form=!0,await p("note-store").post(n),s.form=!1}else A("Faltan Campos Por Diligenciar","","danger")},N=_({type_education_id:null}),O=async()=>{var t,n;const l=await((t=R.value)==null?void 0:t.validate());if(l!=null&&l.valid){s.download_notes=!0;const d=k.value.find(z=>z.value==N.value.type_education_id),{data:i,response:C}=await p(re("/note-downloadAllConsolidated",{query:{type_education_id:N.value.type_education_id,company_id:U.company.id}}));s.download_notes=!1,(n=C.value)!=null&&n.ok&&i.value&&Q(i.value.excel,"Consolidado "+(d==null?void 0:d.title))}else A("Faltan Campos Por Diligenciar","","danger")},E=async l=>{var d;s.block_uploading_of_grades_to_teachers=!0;const{data:t,response:n}=await p("/note-blockPayrollUpload").post({value:l});(d=n.value)!=null&&d.ok&&t.value,s.block_uploading_of_grades_to_teachers=!1},Z=async l=>{var d;s.block_uploading_of_grades_to_teachers=!0;const{data:t,response:n}=await p("/note-resetOptionDownloadPdf").post({company_id:U.company.id});(d=n.value)!=null&&d.ok&&t.value,s.block_uploading_of_grades_to_teachers=!1},H=le(()=>h.value?"Sí":"No"),J=async()=>{s.viewing_notes=!0,await p("/type_educations/visualization/store").post({selectedNotes:F.value}),s.viewing_notes=!1};return(l,t)=>{const n=X,d=W;return r(),$("div",null,[("hasPermission"in l?l.hasPermission:a(y))("note.upload_notes")?(r(),c(b,{key:0,disabled:a(s).form,loading:a(s).form},{default:e(()=>[o(S,{"primary-title":""},{default:e(()=>[f("Cargar Notas")]),_:1}),o(g,null,{default:e(()=>[o(a(j),{ref_key:"formValidation",ref:T,"lazy-validation":""},{default:e(()=>[o(m,null,{default:e(()=>[o(u,{cols:"12",sm:"4"},{default:e(()=>[o(n,{clearable:"",modelValue:a(v).type_education_id,"onUpdate:modelValue":t[0]||(t[0]=i=>a(v).type_education_id=i),rules:["requiredValidator"in l?l.requiredValidator:a(B)],"error-messages":a(P).type_education_id,label:"Tipo",onChange:t[1]||(t[1]=i=>a(P).type_education_id=""),requiredField:!0,items:a(k)},null,8,["modelValue","rules","error-messages","items"])]),_:1}),o(u,{cols:"12",sm:"4"},{default:e(()=>[o(ue,null,{default:e(()=>[f("Archivo "),_e]),_:1}),(r(),c(de,{key:a(w).key,onChange:a(w).handleImageSelected,"onClick:clear":a(w).clearData,rules:["requiredValidator"in l?l.requiredValidator:a(B)]},null,8,["onChange","onClick:clear","rules"]))]),_:1})]),_:1}),o(m,null,{default:e(()=>[o(u,{cols:"12",class:"d-flex justify-center"},{default:e(()=>[o(q,{loading:a(s).form,disabled:a(s).form,color:"primary",onClick:t[2]||(t[2]=i=>M())},{default:e(()=>[f(" Cargar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])):V("",!0),("hasPermission"in l?l.hasPermission:a(y))("note.download_notes")?(r(),c(b,{key:1,disabled:a(s).download_notes,loading:a(s).download_notes,class:"mt-3"},{default:e(()=>[o(S,{"primary-title":""},{default:e(()=>[f("Descargar Notas")]),_:1}),o(g,null,{default:e(()=>[o(a(j),{ref_key:"formValidationDownload",ref:R,"lazy-validation":""},{default:e(()=>[o(m,null,{default:e(()=>[o(u,{cols:"12",sm:"4"},{default:e(()=>[o(n,{clearable:"",modelValue:a(N).type_education_id,"onUpdate:modelValue":t[3]||(t[3]=i=>a(N).type_education_id=i),rules:["requiredValidator"in l?l.requiredValidator:a(B)],"error-messages":a(P).type_education_id,label:"Tipo",onChange:t[4]||(t[4]=i=>a(P).type_education_id=""),requiredField:!0,items:a(k)},null,8,["modelValue","rules","error-messages","items"])]),_:1})]),_:1}),o(m,null,{default:e(()=>[o(u,{cols:"12",class:"d-flex justify-center"},{default:e(()=>[o(q,{loading:a(s).download_notes,disabled:a(s).download_notes,color:"primary",onClick:t[5]||(t[5]=i=>O())},{default:e(()=>[f(" Descargar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])):V("",!0),o(m,null,{default:e(()=>[o(u,{cols:"4"},{default:e(()=>[("hasPermission"in l?l.hasPermission:a(y))("note.block_uploading_of_grades_to_teachers")?(r(),c(b,{key:0,disabled:a(s).block_uploading_of_grades_to_teachers,loading:a(s).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:e(()=>[o(S,{"primary-title":""},{default:e(()=>[f("Bloquear carga de notas a los profesores")]),_:1}),o(g,null,{default:e(()=>[o(m,null,{default:e(()=>[o(u,{cols:"12",sm:"4"},{default:e(()=>[D("div",ce,[o(x,{modelValue:a(h),"onUpdate:modelValue":[t[6]||(t[6]=i=>te(h)?h.value=i:null),t[7]||(t[7]=i=>E(i))],label:a(H),color:"success"},null,8,["modelValue","label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):V("",!0)]),_:1}),o(u,{cols:"4"},{default:e(()=>[("hasPermission"in l?l.hasPermission:a(y))("note.reset_option_download_pdf")?(r(),c(b,{key:0,disabled:a(s).block_uploading_of_grades_to_teachers,loading:a(s).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:e(()=>[o(S,{"primary-title":""},{default:e(()=>[f("Reiniciar opción descarga pdf y boletin")]),_:1}),o(g,null,{default:e(()=>[o(m,null,{default:e(()=>[o(u,{cols:"12",sm:"4"},{default:e(()=>[D("div",fe,[o(q,{color:"primary",onClick:Z},{default:e(()=>[f("Reiniciar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):V("",!0)]),_:1})]),_:1}),("hasPermission"in l?l.hasPermission:a(y))("note.viewing_notes")?(r(),c(b,{key:2,disabled:a(s).viewing_notes,loading:a(s).viewing_notes,class:"mt-3",title:"Visualización de las notas"},{default:e(()=>[(r(!0),$(I,null,L(a(k),i=>(r(),c(g,{key:i.value},{default:e(()=>[o(me),o(m,null,{default:e(()=>[o(u,null,{default:e(()=>[D("span",null,se(i.title),1)]),_:2},1024)]),_:2},1024),o(m,null,{default:e(()=>[(r(!0),$(I,null,L(i.cantNotes,(C,z)=>(r(),c(u,{cols:"12",sm:"4",key:z},{default:e(()=>[D("div",pe,[o(x,{modelValue:a(F)[i.value]["note_"+C],"onUpdate:modelValue":K=>a(F)[i.value]["note_"+C]=K,label:"Nota "+C,color:"success"},null,8,["modelValue","onUpdate:modelValue","label"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128)),o(g,null,{default:e(()=>[o(m,null,{default:e(()=>[o(u,{cols:"12",class:"d-flex justify-center"},{default:e(()=>[o(q,{loading:a(s).form,disabled:a(s).form,color:"primary",onClick:t[8]||(t[8]=i=>J())},{default:e(()=>[f(" Guardar Visualización ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):V("",!0),("hasPermission"in l?l.hasPermission:a(y))("note.bulk_file_upload")?(r(),c(b,{key:3,title:"Carga de archivos masivos",class:"mt-3"},{default:e(()=>[o(g,null,{default:e(()=>[o(d)]),_:1})]),_:1})):V("",!0)])}}});export{Je as default};
