import{cj as A,r as c,V as h,aU as s,b6 as S}from"./index-D-B3Y6bN.js";const M=A("notification",()=>{const a=c([]),o=c(0),r=c(null),u=c(!1),f=h(),{toast:d}=S();return{notifications:a,unreadCount:o,nextPageUrl:r,fetchNotifications:async(i="/notification/getNotifications",e=!1)=>{var l;const{response:n,data:t}=await s(i).get();if((l=n.value)!=null&&l.ok&&t.value){if(e)a.value=t.value.notifications;else{const v=t.value.notifications.filter(m=>!a.value.some(p=>p.id===m.id));a.value.push(...v)}r.value=t.value.nextPageUrl,i==="/notification/getNotifications"&&(o.value=t.value.unreadCount)}},markAsRead:async i=>{a.value.forEach(e=>{i.includes(e.id)&&!e.isSeen&&(e.isSeen=!0,o.value=Math.max(0,o.value-1))}),await s("/notification/markMultipleAsRead").post({notification_ids:i})},markAsUnread:async i=>{a.value.forEach(e=>{i.includes(e.id)&&e.isSeen&&(e.isSeen=!1,o.value++)}),await s("/notification/markMultipleAsUnread").post({notification_ids:i})},remove:async i=>{const e=a.value.findIndex(n=>n.id===i);e!==-1&&a.value.splice(e,1),await s("/notifications/remove").post({notification_ids:[i]})},markAllRead:async()=>{const i=a.value.filter(e=>!e.isSeen).map(e=>e.id);i.length!==0&&(a.value.forEach(e=>e.isSeen=!0),o.value=0,await s("/notification/markMultipleAsRead").post({notification_ids:i}),d("Todo marcado como leÃ­do","","success"))},initializeListener:()=>{var i;u.value||!((i=f.user)!=null&&i.id)||(console.log("ðŸ”Œ Iniciando WebSocket Global para Notificaciones"),window.Echo.private("App.Models.User."+f.user.id).listen(".update-notification",e=>{o.value=e.activeNotificationsCount,e.notifications&&Array.isArray(e.notifications)&&e.notifications.forEach(n=>{const t=a.value.findIndex(l=>l.id===n.id);t!==-1&&(n.is_removed?a.value.splice(t,1):a.value[t].isSeen=n.isSeen)})}).notification(e=>{o.value++,a.value.unshift({id:e.id,title:e.title,subtitle:e.subtitle,text:e.text||null,img:e.img||null,icon:e.icon||"tabler-bell",time:"Ahora mismo",isSeen:!1,color:e.color||"primary",action_url:e.action_url,openInNewTab:e.openInNewTab}),d(e.title,e.subtitle||"Nueva notificaciÃ³n","info")}),u.value=!0)},stopListening:i=>{i&&(console.log(`ðŸ”Œ Desconectando canal de notificaciones: App.Models.User.${i}`),window.Echo.leave(`App.Models.User.${i}`))}}});export{M as u};
