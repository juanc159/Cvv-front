import{V as z,r as m,e as X}from"./VForm-d1f14f9f.js";import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-c24db756.js";import{_ as Z}from"./AppSelect.vue_vue_type_script_setup_true_lang-60172a9c.js";import{d as h,p as x,r as p,R as ee,Q as ae,L as le,w as re,ad as w,o as _,c as E,b as l,f as t,k as e,g as K,B as q,e as T,ag as S,F as oe,m as te,a8 as se,ae as ie,aA as ne,aB as ue,C as de}from"./index-5f64080f.js";import{u as me}from"./useImageUpload-449a8f0c.js";import{u as pe}from"./useCrudTeacherStore-123d3ebd.js";import{V as ce}from"./VCardText-a3602111.js";import{V as g}from"./VRow-2667029d.js";import{V as i}from"./VCol-7542f4b4.js";import{V as fe}from"./VFileInput-f276fd18.js";import{V as Ve}from"./VImg-5286d57c.js";import{V as ve}from"./VCard-51c7a21e.js";import{V as ge}from"./VDataTable-149a5213.js";import{V as be}from"./VChip-6ff3ff7a.js";import"./helpers-3edea678.js";import"./VField-cb70fae4.js";import"./VTextField-8828dcf4.js";import"./VSelect-63cc1915.js";import"./VList-6cc34887.js";import"./ssrBoot-4ac93284.js";import"./VAvatar-ffe6488a.js";import"./VDivider-ff0605eb.js";import"./dialog-transition-5543f58a.js";import"./VMenu-9fac0700.js";import"./sweetalert2.all-e795d634.js";import"./_commonjsHelpers-725317a4.js";/* empty css              */const ye=T("b",{class:"text-warning"},"*",-1),_e={style:{"block-size":"200px","inline-size":"200px"}},qe=T("h3",null,"Información complementaria",-1),Ye=h({__name:"Form",setup(Ce){const U=x(),{toast:$}=ue(),C=p();p();const B=p(),b=pe(),G=ee(),{form:s,loading:k,jobPositions:P,typeEducations:I,sections:A}=ae(b),d=p({}),y=p([]),c=p(me()),R=["jpg","jpeg","png"];c.value.allowedExtensions=R;const M=async()=>{var r,v;s.value.company_id=G.company.id,s.value.complementaries=f.value;const a=await((r=C.value)==null?void 0:r.validate());if(a!=null&&a.valid){const n=await b.fetchSave();(n==null?void 0:n.code)===200&&(y.value=[],d.value={},c.value.clearData(),await((v=C.value)==null?void 0:v.resetValidation())),(n==null?void 0:n.code)===422&&(d.value=n.errors??{})}else $("Faltan Campos Por Diligenciar","","danger")},J=a=>{c.value.handleImageSelected(a),setTimeout(()=>{s.value.photo=c.value.imageFile},1e3)};le(async()=>{b.clearForm(),await b.fetchDataForm(Number(U.params.id),U.params.action),f.value=JSON.parse(JSON.stringify(s.value.complementaries))}),re(s,(a,r)=>{a.id?y.value.photo=[]:y.value.photo=[m(c.value.imageUrl)]},{deep:!0});const u=p({grade_id:null,section_id:null,subjects:[]}),f=p([]),L=[{title:"Grado o nivel",key:"grade_name"},{title:"Sección",key:"section_name"},{title:"Materias",key:"subjects"},{title:"Acciones",key:"actions"}],O=()=>{u.value={grade_id:null,section_id:null,subjects:[]}};p([]),p([]);const H=async()=>{var r;const a=await((r=B.value)==null?void 0:r.validate());if(a!=null&&a.valid){const v=F.value.find(o=>o.value==u.value.grade_id),n=A.value.find(o=>o.value==u.value.section_id),V=D.value.filter(o=>u.value.subjects.includes(o.value));f.value.push({id:null,grade_id:u.value.grade_id,grade_name:v.title,section_id:u.value.section_id,section_name:n.title,subjects:V,delete:0}),O()}else $("Faltan Campos Por Diligenciar","","danger")},Q=a=>{f.value[a].id?f.value[a].delete=1:f.value.splice(a,1)},W=w(()=>f.value.filter(a=>a.delete!=1)),F=w(()=>s.value.type_education_id?I.value.find(a=>a.value==s.value.type_education_id).grades:[]),D=w(()=>u.value.grade_id?F.value.find(a=>a.value==u.value.grade_id).subjects:[]);return(a,r)=>{const v=ne,n=Z,V=Y;return _(),E("div",null,[l(ve,{loading:e(k).form,disabled:e(k).form},{default:t(()=>[l(ce,null,{default:t(()=>[l(g,null,{default:t(()=>[l(i,null,{default:t(()=>[l(v,{"sub-title":"Formulario Teacher",action:String(a.$route.params.action),"btn-action":"list","validate-crud":!0,"btn-back":!0,onChangeScreenBack:a.$router.back},null,8,["action","onChangeScreenBack"])]),_:1})]),_:1}),l(e(z),{ref_key:"formValidation",ref:C,"lazy-validation":""},{default:t(()=>[l(g,null,{default:t(()=>[l(i,{cols:"12",sm:"3"},{default:t(()=>[l(n,{items:e(I),clearable:"",rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(s).type_education_id,"onUpdate:modelValue":r[0]||(r[0]=o=>e(s).type_education_id=o),label:"Tipo de educación"},null,8,["items","rules","modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(n,{items:e(P),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(s).job_position_id,"onUpdate:modelValue":r[1]||(r[1]=o=>e(s).job_position_id=o),label:"Cargo"},null,8,["items","rules","modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(V,{clearable:"",modelValue:e(s).name,"onUpdate:modelValue":r[2]||(r[2]=o=>e(s).name=o),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).name,label:"Nombre",onKeypress:r[3]||(r[3]=o=>e(d).name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(V,{clearable:"",modelValue:e(s).last_name,"onUpdate:modelValue":r[4]||(r[4]=o=>e(s).last_name=o),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).last_name,label:"Apellido",onKeypress:r[5]||(r[5]=o=>e(d).last_name=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(V,{clearable:"",modelValue:e(s).email,"onUpdate:modelValue":r[6]||(r[6]=o=>e(s).email=o),rules:["requiredValidator"in a?a.requiredValidator:e(m),"emailValidator"in a?a.emailValidator:e(X)],"error-messages":e(d).email,label:"Correo",onKeypress:r[7]||(r[7]=o=>e(d).email=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(V,{clearable:"",modelValue:e(s).password,"onUpdate:modelValue":r[8]||(r[8]=o=>e(s).password=o),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).password,label:"Contraseña",onKeypress:r[9]||(r[9]=o=>e(d).password=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(V,{clearable:"",modelValue:e(s).phone,"onUpdate:modelValue":r[10]||(r[10]=o=>e(s).phone=o),rules:["requiredValidator"in a?a.requiredValidator:e(m)],"error-messages":e(d).phone,label:"Teléfono",onKeypress:r[11]||(r[11]=o=>e(d).phone=""),requiredField:!0},null,8,["modelValue","rules","error-messages"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[(_(),K(fe,{accept:"image/*",rules:e(y).photo,key:e(c).key,onChange:r[12]||(r[12]=o=>J(o)),"onClick:clear":e(c).clearData},{label:t(()=>[q(" Foto "),ye]),_:1},8,["rules","onClick:clear"]))]),_:1})]),_:1}),l(g,null,{default:t(()=>[l(i,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[T("div",_e,[l(Ve,{src:e(c).imageUrl??e(s).photo},null,8,["src"])])]),_:1})]),_:1})]),_:1},512),l(e(z),{ref_key:"complementaryValidation",ref:B,"lazy-validation":""},{default:t(()=>[l(g,null,{default:t(()=>[l(i,{cols:"12"},{default:t(()=>[qe]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(n,{clearable:"",items:e(F),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(u).grade_id,"onUpdate:modelValue":r[13]||(r[13]=o=>e(u).grade_id=o),label:"Grados y niveles"},null,8,["items","rules","modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(n,{clearable:"",items:e(A),rules:["requiredValidator"in a?a.requiredValidator:e(m)],modelValue:e(u).section_id,"onUpdate:modelValue":r[14]||(r[14]=o=>e(u).section_id=o),label:"Secciones"},null,8,["items","rules","modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(n,{clearable:"",multiple:"",rules:["requiredValidator"in a?a.requiredValidator:e(m)],items:e(D),modelValue:e(u).subjects,"onUpdate:modelValue":r[15]||(r[15]=o=>e(u).subjects=o),label:"Materias"},null,8,["rules","items","modelValue"])]),_:1}),l(i,{cols:"12",sm:"3"},{default:t(()=>[l(S,{color:"success",onClick:r[16]||(r[16]=o=>H())},{default:t(()=>[q("Agregar")]),_:1})]),_:1}),l(i,{cols:"12"},{default:t(()=>[l(e(ge),{headers:L,items:e(W),"items-per-page":999},{"item.subjects":t(({item:o})=>[(_(!0),E(oe,null,te(o.subjects,(j,N)=>(_(),K(be,{color:"primary",class:"mr-2",key:N},{default:t(()=>[q(de(j.title),1)]),_:2},1024))),128))]),"item.actions":t(({item:o,index:j})=>[l(S,{icon:"",size:"x-small",color:"error",variant:"text",onClick:N=>Q(j)},{default:t(()=>[l(se,{size:"22",icon:"tabler-trash"}),l(ie,{location:"top",transition:"scale-transition",activator:"parent",text:"Eliminar"})]),_:2},1032,["onClick"])]),bottom:t(()=>[]),_:1},8,["items"])]),_:1})]),_:1})]),_:1},512),l(g,null,{default:t(()=>[l(i,{cols:"12",class:"d-flex justify-center"},{default:t(()=>[l(S,{loading:e(k).form,color:"primary",onClick:r[17]||(r[17]=o=>M())},{default:t(()=>[q(" Guardar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading","disabled"])])}}});export{Ye as default};
