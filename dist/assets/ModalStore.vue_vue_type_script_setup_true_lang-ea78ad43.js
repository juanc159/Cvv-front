import{V as k,r as E}from"./VForm-3e42ce90.js";import{_}from"./AppTextField.vue_vue_type_script_setup_true_lang-52fa7eed.js";import{_ as U}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-ff5a7105.js";import{r as b,cj as D,ck as j,aF as A,ah as T,d as B,w as L,o as F,c as H,b as d,f as m,k as y,ag as v,B as S}from"./index-f3b96d19.js";import{a as N,w as O}from"./index-d8e09ff2.js";import{V as P}from"./VCard-c8ced344.js";import{V as q}from"./VCardText-c3844e3c.js";import{V as M}from"./VRow-78945eb9.js";import{V as J}from"./VCol-c1bc80a4.js";import{V as z}from"./VDialog-1b8f92ac.js";function I(){const o="127.0.0.1",r="http",i=b(localStorage.getItem("baseUrl")??`${r}://${o}:8000/api`),n=`${o}://${o}:8000`;return{baseURL:i,baseURLBack:n,setBaseUrl:u=>{i.value=u}}}class G extends Error{constructor(t,r){super(t,r),this.name="FetchError",r!=null&&r.cause&&!this.cause&&(this.cause=r.cause)}}function K(o){var l,a,e,h,f;const t=((l=o.error)==null?void 0:l.message)||((a=o.error)==null?void 0:a.toString())||"",r=((e=o.request)==null?void 0:e.method)||((h=o.options)==null?void 0:h.method)||"GET",i=((f=o.request)==null?void 0:f.url)||String(o.request)||"/",n=`[${r}] ${JSON.stringify(i)}`,c=o.response?`${o.response.status} ${o.response.statusText}`:"<no response>",u=`${n}: ${c}${t?` ${t}`:""}`,s=new G(u,o.error?{cause:o.error}:void 0);for(const p of["request","options","response"])Object.defineProperty(s,p,{get(){return o[p]}});for(const[p,g]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(s,p,{get(){return o.response&&o.response[g]}});return s}const Q=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function V(o="GET"){return Q.has(o.toUpperCase())}function W(o){if(o===void 0)return!1;const t=typeof o;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(o)?!0:o.buffer?!1:o.constructor&&o.constructor.name==="Object"||typeof o.toJSON=="function"}const X=new Set(["image/svg","application/xml","application/xhtml","application/html"]),Y=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Z(o=""){if(!o)return"json";const t=o.split(";").shift()||"";return Y.test(t)?"json":X.has(t)||t.startsWith("text/")?"text":"blob"}function x(o,t,r=globalThis.Headers){const i={...t,...o};if(t!=null&&t.params&&(o!=null&&o.params)&&(i.params={...t==null?void 0:t.params,...o==null?void 0:o.params}),t!=null&&t.query&&(o!=null&&o.query)&&(i.query={...t==null?void 0:t.query,...o==null?void 0:o.query}),t!=null&&t.headers&&(o!=null&&o.headers)){i.headers=new r((t==null?void 0:t.headers)||{});for(const[n,c]of new r((o==null?void 0:o.headers)||{}))i.headers.set(n,c)}return i}const ee=new Set([408,409,425,429,500,502,503,504]),oe=new Set([101,204,205,304]);function $(o={}){const{fetch:t=globalThis.fetch,Headers:r=globalThis.Headers,AbortController:i=globalThis.AbortController}=o;async function n(s){const l=s.error&&s.error.name==="AbortError"&&!s.options.timeout||!1;if(s.options.retry!==!1&&!l){let e;typeof s.options.retry=="number"?e=s.options.retry:e=V(s.options.method)?0:1;const h=s.response&&s.response.status||500;if(e>0&&(Array.isArray(s.options.retryStatusCodes)?s.options.retryStatusCodes.includes(h):ee.has(h))){const f=s.options.retryDelay||0;return f>0&&await new Promise(p=>setTimeout(p,f)),c(s.request,{...s.options,retry:e-1,timeout:s.options.timeout})}}const a=K(s);throw Error.captureStackTrace&&Error.captureStackTrace(a,c),a}const c=async function(l,a={}){var f;const e={request:l,options:x(a,o.defaults,r),response:void 0,error:void 0};if(e.options.method=(f=e.options.method)==null?void 0:f.toUpperCase(),e.options.onRequest&&await e.options.onRequest(e),typeof e.request=="string"&&(e.options.baseURL&&(e.request=N(e.request,e.options.baseURL)),(e.options.query||e.options.params)&&(e.request=O(e.request,{...e.options.params,...e.options.query}))),e.options.body&&V(e.options.method)&&(W(e.options.body)?(e.options.body=typeof e.options.body=="string"?e.options.body:JSON.stringify(e.options.body),e.options.headers=new r(e.options.headers||{}),e.options.headers.has("content-type")||e.options.headers.set("content-type","application/json"),e.options.headers.has("accept")||e.options.headers.set("accept","application/json")):("pipeTo"in e.options.body&&typeof e.options.body.pipeTo=="function"||typeof e.options.body.pipe=="function")&&("duplex"in e.options||(e.options.duplex="half"))),!e.options.signal&&e.options.timeout){const p=new i;setTimeout(()=>p.abort(),e.options.timeout),e.options.signal=p.signal}try{e.response=await t(e.request,e.options)}catch(p){return e.error=p,e.options.onRequestError&&await e.options.onRequestError(e),await n(e)}if(e.response.body&&!oe.has(e.response.status)&&e.options.method!=="HEAD"){const p=(e.options.parseResponse?"json":e.options.responseType)||Z(e.response.headers.get("content-type")||"");switch(p){case"json":{const g=await e.response.text(),C=e.options.parseResponse||D;e.response._data=C(g);break}case"stream":{e.response._data=e.response.body;break}default:e.response._data=await e.response[p]()}}return e.options.onResponse&&await e.options.onResponse(e),!e.options.ignoreResponseError&&e.response.status>=400&&e.response.status<600?(e.options.onResponseError&&await e.options.onResponseError(e),await n(e)):e.response},u=async function(l,a){return(await c(l,a))._data};return u.raw=c,u.native=(...s)=>t(...s),u.create=(s={})=>$({...o,defaults:{...o.defaults,...s}}),u}const w=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),te=w.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),se=w.Headers,re=w.AbortController,R=$({fetch:te,Headers:se,AbortController:re});R.create({baseURL:"https://back.colegiovirgendelvalle.com.co/api",async onRequest({options:o}){const t=j("accessToken").value;t&&(o.headers={...o.headers,Authorization:`Bearer ${t}`})}});const ae=R.create({baseURL:"https://back.colegiovirgendelvalle.com.co/",async onRequest({options:o}){}}),ne=A("useTenantStore",{state:()=>({loading:{form:!1,table:!1},tenants:[]}),getters:{},actions:{async setHost(o){localStorage.setItem("baseUrl",`http://${o}.127.0.0.1:8000/api`),window.location.href="http://"+o+".localhost:5173",setTimeout(()=>{window.location.reload()},1e3)},async setHostLogin(o){window.location.href="http://"+o+".localhost:5173"},async setHostCentral(){const o=b(I());o.value.baseURL,localStorage.setItem("baseUrl",o.value.baseURL),window.location.reload()},async fetchSave(o){var c;this.loading.form=!0;const{data:t,response:r,error:i,isFetching:n}=await T("/tenant-store").post(o);return this.loading.form=!1,(c=r.value)!=null&&c.ok&&t.value&&await ae("/linkstorage",{method:"get"}),t.value},async fetchList(){var n;this.loading.form=!0;const{data:o,response:t,error:r,isFetching:i}=await T("/tenant-list").post({typeData:"todos"});return this.loading.form=!1,(n=t.value)!=null&&n.ok&&o.value&&(this.tenants=o.value.data),o.value}}}),be=B({__name:"ModalStore",props:{isDialogDetailVisible:{type:Boolean}},emits:["update:isDialogDetailVisible"],setup(o,{emit:t}){const r=b(),i=ne(),n=b({name:null}),c=async()=>{var a;const l=await((a=r.value)==null?void 0:a.validate());l!=null&&l.valid&&(await i.fetchSave(n.value),u("update:isDialogDetailVisible",!1),await i.fetchList())},u=t;L(n.value,l=>{n.value.name&&(n.value.name=n.value.name.replaceAll(" ","_"))});const s=()=>{u("update:isDialogDetailVisible",!1)};return(l,a)=>{const e=U,h=_;return F(),H("div",null,[d(z,{"model-value":o.isDialogDetailVisible,width:"500",persistent:""},{default:m(()=>[d(e,{onClick:a[0]||(a[0]=f=>s())}),d(P,{title:"Nuevo subdominio"},{default:m(()=>[d(q,null,{default:m(()=>[d(y(k),{ref_key:"formValidation",ref:r},{default:m(()=>[d(M,null,{default:m(()=>[d(J,{cols:"12"},{default:m(()=>[d(h,{modelValue:y(n).name,"onUpdate:modelValue":a[1]||(a[1]=f=>y(n).name=f),class:"mt-1",label:"Nombre de tenant a crear",rules:["requiredValidator"in l?l.requiredValidator:y(E)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),d(q,{class:"d-flex justify-end"},{default:m(()=>[d(v,{loading:y(i).loading.form,color:"secondary",class:"mr-5",onClick:a[2]||(a[2]=f=>s())},{default:m(()=>[S(" Cancelar ")]),_:1},8,["loading"]),d(v,{loading:y(i).loading.form,onClick:a[3]||(a[3]=f=>c())},{default:m(()=>[S(" Crear ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])])}}});export{be as _,ne as u};
