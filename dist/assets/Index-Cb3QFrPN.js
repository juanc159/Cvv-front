import{_ as ve}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-CpRBG7xm.js";import{r as ge}from"./validators-HMCtv8cK.js";import{d as ae,r as m,bd as ye,be as W,bf as be,a as he,h,o as u,f as a,b as e,af as L,l as o,e as f,c as N,a7 as oe,a9 as E,D as g,F as K,q as Y,aU as z,y as R,E as H,aI as Ve,ae as we,V as ke,aa as Ce,Y as xe,N as De,b7 as Se,ab as Ae,ad as Z,b6 as Ne}from"./index-u3uCcp0U.js";import{_ as le}from"./AppSelect.vue_vue_type_script_setup_true_lang-C8fi0YBF.js";import{V as A,b as Ee,a as P}from"./VCard-BkC9YkE3.js";import{V as J}from"./VForm-CWjbSSbs.js";import{V as y,a as _}from"./VRow-CjKMUkpB.js";import{V}from"./VCardText-CxgYmRY-.js";import{V as Fe}from"./VImg-dor5jAhO.js";import{V as $e}from"./VSpacer-DmOvfHvo.js";import{_ as Me}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-BEC9U_Us.js";import{u as qe}from"./useFileUpload-DKIPOxFX.js";import{c as Be}from"./createUrl-FP-g9SSp.js";import{b as X}from"./helpers-BYlhGQ9-.js";import{V as Ue}from"./VFileInput-CdYFo9MH.js";import{V as ee}from"./VSwitch-IydBCN1J.js";import{V as ze}from"./VDivider-B1Lyz9XH.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-DGnluLV1.js";import"./VDialog-B1xiXXYP.js";import"./dialog-transition-DgJH26s6.js";import"./VSelect-BqmxrYly.js";import"./VTextField-Duve1Hnw.js";/* empty css                   */import"./VCounter-BIc85nI4.js";import"./VList-BCHZ89lP.js";import"./ssrBoot-CyUYJk7f.js";import"./VAvatar-CNTIVpoH.js";import"./VMenu-Cvor8687.js";import"./VCheckboxBtn-C0lS4T3U.js";import"./VSelectionControl-Com20bhz.js";import"./VChip-BAZ8QfII.js";/* empty css              */import"./filter-Cqq3NWet.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import"./index-0F-JFElI.js";import"./constants-2GBt7OCP.js";const Re={class:"flex"},Ie={class:"w-full h-auto relative"},Pe={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},je=f("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquÃ­. ",-1),Oe=f("span",{class:"text-disabled"},"o",-1),Qe={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},Te={class:"mt-2"},Ge={class:"clamp-text text-wrap"},Le={key:0,class:"mt-2"},Ze=f("span",null,"Cargando...",-1),Ke={key:1,class:"mt-2 text-success"},Ye=f("span",null,"Â¡Archivo cargado exitosamente!",-1),He=[Ye],Je={key:2,class:"mt-2 text-danger"},We=f("span",null,"Error al cargar el archivo",-1),Xe=[We],ea=ae({__name:"DragAndDrop",setup(te){const j=m(),w=m(),p=m([]),{open:F,onChange:t}=ye({});function b(v){v==null||v.forEach(i=>{if(i.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}p.value.push({file:i,url:W(i).value??"",progress:void 0,status:"pending"})})}t(v=>{if(v)for(const i of v)p.value.push({file:i,url:W(i).value??"",progress:void 0,status:"pending"})}),be(w,b);const C=async()=>{var i,x;const v=await((i=j.value)==null?void 0:i.validate());if(v!=null&&v.valid){if(p.value.length===0){alert("No hay archivos para guardar");return}M.value=!0;for(let D=0;D<p.value.length;D++){const c=p.value[D];c.status="uploading";try{const k=new FormData;k.append("file",c.file),k.append("field",q.value);const{data:I,response:O}=await z("/savefiles").post(k);(x=O.value)!=null&&x.ok&&I.value&&(c.status="completed",c.progress=100,console.log(`Archivo ${c.file.name} guardado correctamente`))}catch(k){c.status="failed",c.progress=void 0,console.error("Error al guardar el archivo",c.file.name,k),alert(`Error al guardar el archivo ${c.file.name}`)}}M.value=!1}},M=m(!1),q=m(),$=[{title:"Foto",value:"photo"},{title:"BoletÃ­n",value:"boletin"}];return(v,i)=>{const x=le,D=he("IconBtn");return u(),h(A,{class:"mb-6",title:"Archivos"},{default:a(()=>[e(V,null,{default:a(()=>[e(J,{ref_key:"formValidation",ref:j,onSubmit:L(()=>{},["prevent"])},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",md:"6"},{default:a(()=>[e(x,{requiredField:!0,label:"Campo",items:$,modelValue:q.value,"onUpdate:modelValue":i[0]||(i[0]=c=>q.value=c),rules:["requiredValidator"in v?v.requiredValidator:o(ge)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(V,null,{default:a(()=>[f("div",Re,[f("div",Ie,[f("div",{ref_key:"dropZoneRef",ref:w,class:"cursor-pointer",onClick:i[2]||(i[2]=()=>o(F)())},[p.value.length===0?(u(),N("div",Pe,[e(D,{variant:"tonal",class:"rounded-sm"},{default:a(()=>[e(oe,{icon:"tabler-upload"})]),_:1}),je,Oe,e(E,{variant:"tonal"},{default:a(()=>[g("Explorar archivos")]),_:1})])):(u(),N("div",Qe,[e(y,{class:"match-height w-100"},{default:a(()=>[(u(!0),N(K,null,Y(p.value,(c,k)=>(u(),h(_,{key:k,cols:"12",sm:"4"},{default:a(()=>[e(A,{ripple:!1,border:"",class:"d-flex flex-column"},{default:a(()=>[e(V,{onClick:i[1]||(i[1]=L(()=>{},["stop"]))},{default:a(()=>[e(Fe,{src:c.url,width:"150px",height:"100px"},null,8,["src"]),f("div",Te,[f("span",Ge,H(c.file.name),1),f("span",null,H(c.file.size/1e3)+" KB ",1)]),c.status==="uploading"?(u(),N("div",Le,[e(Ve,{size:24,value:c.progress,color:"primary"},null,8,["value"]),Ze])):R("",!0),c.status==="completed"?(u(),N("div",Ke,He)):R("",!0),c.status==="failed"?(u(),N("div",Je,Xe)):R("",!0)]),_:2},1024),e($e),e(Ee,null,{default:a(()=>[e(E,{variant:"outlined",block:"",onClick:L(I=>p.value.splice(k,1),["stop"])},{default:a(()=>[g(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(E,{disabled:M.value,loading:M.value,color:"primary",onClick:C},{default:a(()=>[g(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),aa=f("b",{class:"text-warning"},"*",-1),oa={class:"demo-space-x"},la={class:"demo-space-x"},ta={class:"demo-space-x"},sa={class:"demo-space-x"},Oa=ae({__name:"Index",setup(te){const j=we(),w=ke(),{toast:p}=Ne(),F=m(qe());F.value.allowedExtensions=["xls","xlsx"];const t=Ce({form:!1,download_notes:!1,block_uploading_of_grades_to_teachers:!1,delete_all_student_grade_scores_permission:!1,viewing_notes:!1}),b=m({company_id:null,type_education_id:null,teacher_id:null,archive:null}),C=m({}),M=m(),q=m(),$=m([]),v=m([]),i=m(!1),x=m({}),D=s=>!!s||"Campo requerido",c=async()=>{var l;b.value.archive=F.value.imageFile,b.value.company_id=w.company.id;const s=await((l=M.value)==null?void 0:l.validate());if(s!=null&&s.valid){const n=new FormData;n.append("company_id",String(b.value.company_id)),n.append("user_id",String(w.user.id)),n.append("type_education_id",String(b.value.type_education_id)),n.append("teacher_id",String(b.value.teacher_id||"")),n.append("archive",b.value.archive),t.form=!0;try{console.log("ðŸ“¤ [FORM] Enviando formulario...");const{data:r,response:S}=await Z("note-store").post(n);console.log("ðŸ“¥ [FORM] Respuesta del servidor:",r.value),S.status==200&&r?r.status==="success"?(console.log("ðŸš€ [FORM] Iniciando loading para batch_id:",r.batch_id),j.startLoading(r.batch_id)?(p("ImportaciÃ³n iniciada correctamente","","success"),b.value={company_id:w.company.id,type_education_id:null,teacher_id:null,archive:null},F.value.clearData()):p("Error iniciando la importaciÃ³n","","danger")):r.status==="error"&&(p("Error en la importaciÃ³n",r.message,"danger"),r.errors&&(C.value=r.errors)):p("Error en la respuesta del servidor","","danger")}catch(r){console.error("âŒ [FORM] Error en submitForm:",r),p("Error al procesar el archivo","","danger")}finally{t.form=!1}}else p("Faltan Campos Por Diligenciar","","danger")},k=async()=>{t.form=!0;const{data:s,response:l}=await Z("note-dataForm").get({params:{company_id:w.company.id}});l.status==200&&s&&($.value=s.typeEducations,i.value=s.blockData,v.value=s.teachers),t.form=!1},I=s=>!0,O=async()=>{var n;const{data:s,response:l}=await z("/type_educations/visualization/show").get();(n=l.value)!=null&&n.ok&&s.value&&(x.value=s.value.selectedNotes)},B=m({type_education_id:null}),se=async()=>{var l,n;const s=await((l=q.value)==null?void 0:l.validate());if(s!=null&&s.valid){t.download_notes=!0;const r=$.value.find(d=>d.value==B.value.type_education_id),{data:S,response:U}=await z(Be("/note-downloadAllConsolidated",{query:{type_education_id:B.value.type_education_id,company_id:w.company.id}}));t.download_notes=!1,(n=U.value)!=null&&n.ok&&S.value&&X(S.value.excel,"Consolidado "+(r==null?void 0:r.title))}else p("Faltan Campos Por Diligenciar","","danger")},ne=async()=>{var l;const s=await((l=q.value)==null?void 0:l.validate());if(s!=null&&s.valid){t.download_notes=!0;const n=$.value.find(U=>U.value==B.value.type_education_id),{response:r,data:S}=await Z("/note-downloadConsolidatedPocentage").get({params:{type_education_id:B.value.type_education_id,company_id:w.company.id}});t.download_notes=!1,S.code==200&&X(S.excel,"Consolidado porcentajes "+(n==null?void 0:n.title))}else p("Faltan Campos Por Diligenciar","","danger")},re=async s=>{var r;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:n}=await z("/note-blockPayrollUpload").post({value:s});(r=n.value)!=null&&r.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},de=async s=>{var r;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:n}=await z("/note-resetOptionDownloadPdf").post({company_id:w.company.id});(r=n.value)!=null&&r.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},ie=xe(()=>i.value?"SÃ­":"No"),ue=async()=>{t.viewing_notes=!0;const{data:s,response:l}=await z("/type_educations/visualization/store").post({selectedNotes:x.value});t.viewing_notes=!1},Q=m(),ce=()=>{Q.value.openModal(),Q.value.componentData.title="Esta seguro que desea activar a todos los estudiantes en un estado insolventes"};De(async()=>{await O(),console.log("ðŸš€ [PAGE] Component mounted - Queue system enabled"),await k()});const T=m(),_e=()=>{T.value.openModal(),T.value.componentData.title="Esta seguro que desea eliminar todas las notas de los estudiantes"},pe=async()=>{var n;t.delete_all_student_grade_scores_permission=!0;const{data:s,response:l}=await z("/note-deleteAllStudentGradeScores").post({company_id:w.company.id});(n=l.value)!=null&&n.ok&&s.value,t.delete_all_student_grade_scores_permission=!1};return(s,l)=>{const n=le,r=Me,S=ea,U=ve;return u(),N("div",null,[(u(),h(A,{key:0,disabled:o(t).form,loading:o(t).form},{default:a(()=>[e(P,{"primary-title":""},{default:a(()=>[g(" Cargar Notas ")]),_:1}),e(V,null,{default:a(()=>[e(o(J),{ref_key:"formValidation",ref:M,"lazy-validation":""},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[e(n,{clearable:"",modelValue:o(b).type_education_id,"onUpdate:modelValue":l[0]||(l[0]=d=>o(b).type_education_id=d),rules:[D],"error-messages":o(C).type_education_id,label:"Tipo",onChange:l[1]||(l[1]=d=>o(C).type_education_id=""),requiredField:!0,items:o($)},null,8,["modelValue","rules","error-messages","items"])]),_:1}),e(_,{cols:"12",sm:"4"},{default:a(()=>[e(Se,null,{default:a(()=>[g("ArchivoÂ "),aa]),_:1}),(u(),h(Ue,{key:o(F).key,onChange:o(F).handleImageSelected,"onClick:clear":o(F).clearData,rules:[D]},null,8,["onChange","onClick:clear","rules"]))]),_:1}),e(_,{cols:"12",sm:"4"},{default:a(()=>[e(r,{clearable:"",modelValue:o(b).teacher_id,"onUpdate:modelValue":l[2]||(l[2]=d=>o(b).teacher_id=d),"error-messages":o(C).teacher_id,label:"Docente",onChange:l[3]||(l[3]=d=>o(C).teacher_id=""),items:o(v)},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(E,{loading:o(t).form,color:"primary",onClick:l[4]||(l[4]=d=>c())},{default:a(()=>[e(oe,{start:"",icon:"tabler-upload"}),g(" Cargar Archivo ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),(u(),h(A,{key:1,disabled:o(t).download_notes,loading:o(t).download_notes,class:"mt-3"},{default:a(()=>[e(P,{"primary-title":""},{default:a(()=>[g("Descargar Notas")]),_:1}),e(V,null,{default:a(()=>[e(o(J),{ref_key:"formValidationDownload",ref:q,"lazy-validation":""},{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[e(n,{clearable:"",modelValue:o(B).type_education_id,"onUpdate:modelValue":l[5]||(l[5]=d=>o(B).type_education_id=d),rules:[D],"error-messages":o(C).type_education_id,label:"Tipo",onChange:l[6]||(l[6]=d=>o(C).type_education_id=""),requiredField:!0,items:o($)},null,8,["modelValue","rules","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-start gap-3 flex-wrap mt-5"},{default:a(()=>[e(E,{loading:o(t).download_notes,disabled:o(t).download_notes,color:"primary",onClick:l[7]||(l[7]=d=>se())},{default:a(()=>[g(" Descargar Consolidado ")]),_:1},8,["loading","disabled"]),o(B).type_education_id=="3"?(u(),h(E,{key:0,loading:o(t).download_notes,disabled:o(t).download_notes,color:"primary",onClick:l[8]||(l[8]=d=>ne())},{default:a(()=>[g(" Descargar Reporte % ")]),_:1},8,["loading","disabled"])):R("",!0)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),e(y,null,{default:a(()=>[e(_,{cols:"4"},{default:a(()=>[I("note.block_uploading_of_grades_to_teachers")?(u(),h(A,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(P,{"primary-title":""},{default:a(()=>[g("Bloquear carga de notas a los profesores")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[f("div",oa,[e(ee,{modelValue:o(i),"onUpdate:modelValue":[l[9]||(l[9]=d=>Ae(i)?i.value=d:null),l[10]||(l[10]=d=>re(d))],label:o(ie),color:"success"},null,8,["modelValue","label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):R("",!0)]),_:1}),e(_,{cols:"4"},{default:a(()=>[I("note.reset_option_download_pdf")?(u(),h(A,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(P,{"primary-title":""},{default:a(()=>[g("Reiniciar opciÃ³n descarga pdf y boletin")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[f("div",la,[e(E,{color:"primary",onClick:ce},{default:a(()=>[g("Reiniciar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):R("",!0)]),_:1}),e(_,{cols:"4"},{default:a(()=>[I("note.delete_all_student_grade_scores_permission")?(u(),h(A,{key:0,disabled:o(t).delete_all_student_grade_scores_permission,loading:o(t).delete_all_student_grade_scores_permission,class:"mt-3"},{default:a(()=>[e(P,{"primary-title":""},{default:a(()=>[g("Borrar todas las notas de los alumnos")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",sm:"4"},{default:a(()=>[f("div",ta,[e(E,{color:"primary",onClick:_e},{default:a(()=>[g("Eliminar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):R("",!0)]),_:1})]),_:1}),(u(),h(A,{key:2,disabled:o(t).viewing_notes,loading:o(t).viewing_notes,class:"mt-3",title:"VisualizaciÃ³n de las notas"},{default:a(()=>[(u(!0),N(K,null,Y(o($),d=>(u(),h(V,{key:d.value},{default:a(()=>[e(ze),e(y,null,{default:a(()=>[e(_,null,{default:a(()=>[f("span",null,H(d.title),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:a(()=>[(u(!0),N(K,null,Y(d.cantNotes,(G,me)=>(u(),h(_,{cols:"12",sm:"4",key:me},{default:a(()=>[f("div",sa,[e(ee,{modelValue:o(x)[d.value]["note_"+G],"onUpdate:modelValue":fe=>o(x)[d.value]["note_"+G]=fe,label:"Nota "+G,color:"success"},null,8,["modelValue","onUpdate:modelValue","label"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128)),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(_,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(E,{loading:o(t).form,disabled:o(t).form,color:"primary",onClick:l[11]||(l[11]=d=>ue())},{default:a(()=>[g(" Guardar VisualizaciÃ³n ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])),(u(),h(A,{key:3,title:"Carga de archivos masivos",class:"mt-3"},{default:a(()=>[e(V,null,{default:a(()=>[e(S)]),_:1})]),_:1})),e(U,{ref_key:"refModalQuestion",ref:Q,onSuccess:de},null,512),e(U,{ref_key:"refModalQuestionDeleteNoteStudents",ref:T,onSuccess:pe},null,512)])}}});export{Oa as default};
