import{V as E,r as B}from"./VForm-d1f14f9f.js";import{_ as D}from"./AppTextField.vue_vue_type_script_setup_true_lang-c24db756.js";import{d as V,a as U,o as C,g as j,f as m,b as u,a8 as A,r as b,cj as L,ck as F,aE as H,ah as v,w as N,c as O,k as y,ag as T,B as S}from"./index-5f64080f.js";import{a as P,w as z}from"./index-d8e09ff2.js";import{V as I}from"./VCard-51c7a21e.js";import{V as _}from"./VCardText-a3602111.js";import{V as M}from"./VRow-2667029d.js";import{V as J}from"./VCol-7542f4b4.js";import{V as G}from"./VDialog-f49bef88.js";const K=V({__name:"DialogCloseBtn",props:{icon:{default:"tabler-x"},iconSize:{default:"20"}},setup(o){const t=o;return(r,i)=>{const a=U("IconBtn");return C(),j(a,{variant:"elevated",class:"v-dialog-close-btn"},{default:m(()=>[u(A,{icon:t.icon,size:t.iconSize},null,8,["icon","size"])]),_:1})}}});function Q(){const o="127.0.0.1",r="http",i=b(localStorage.getItem("baseUrl")??`${r}://${o}:8000/api`),a=`${o}://${o}:8000`;return{baseURL:i,baseURLBack:a,setBaseUrl:d=>{i.value=d}}}class W extends Error{constructor(t,r){super(t,r),this.name="FetchError",r!=null&&r.cause&&!this.cause&&(this.cause=r.cause)}}function X(o){var l,n,e,h,f;const t=((l=o.error)==null?void 0:l.message)||((n=o.error)==null?void 0:n.toString())||"",r=((e=o.request)==null?void 0:e.method)||((h=o.options)==null?void 0:h.method)||"GET",i=((f=o.request)==null?void 0:f.url)||String(o.request)||"/",a=`[${r}] ${JSON.stringify(i)}`,c=o.response?`${o.response.status} ${o.response.statusText}`:"<no response>",d=`${a}: ${c}${t?` ${t}`:""}`,s=new W(d,o.error?{cause:o.error}:void 0);for(const p of["request","options","response"])Object.defineProperty(s,p,{get(){return o[p]}});for(const[p,g]of[["data","_data"],["status","status"],["statusCode","status"],["statusText","statusText"],["statusMessage","statusText"]])Object.defineProperty(s,p,{get(){return o.response&&o.response[g]}});return s}const Y=new Set(Object.freeze(["PATCH","POST","PUT","DELETE"]));function q(o="GET"){return Y.has(o.toUpperCase())}function Z(o){if(o===void 0)return!1;const t=typeof o;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(o)?!0:o.buffer?!1:o.constructor&&o.constructor.name==="Object"||typeof o.toJSON=="function"}const x=new Set(["image/svg","application/xml","application/xhtml","application/html"]),ee=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function oe(o=""){if(!o)return"json";const t=o.split(";").shift()||"";return ee.test(t)?"json":x.has(t)||t.startsWith("text/")?"text":"blob"}function te(o,t,r=globalThis.Headers){const i={...t,...o};if(t!=null&&t.params&&(o!=null&&o.params)&&(i.params={...t==null?void 0:t.params,...o==null?void 0:o.params}),t!=null&&t.query&&(o!=null&&o.query)&&(i.query={...t==null?void 0:t.query,...o==null?void 0:o.query}),t!=null&&t.headers&&(o!=null&&o.headers)){i.headers=new r((t==null?void 0:t.headers)||{});for(const[a,c]of new r((o==null?void 0:o.headers)||{}))i.headers.set(a,c)}return i}const se=new Set([408,409,425,429,500,502,503,504]),re=new Set([101,204,205,304]);function $(o={}){const{fetch:t=globalThis.fetch,Headers:r=globalThis.Headers,AbortController:i=globalThis.AbortController}=o;async function a(s){const l=s.error&&s.error.name==="AbortError"&&!s.options.timeout||!1;if(s.options.retry!==!1&&!l){let e;typeof s.options.retry=="number"?e=s.options.retry:e=q(s.options.method)?0:1;const h=s.response&&s.response.status||500;if(e>0&&(Array.isArray(s.options.retryStatusCodes)?s.options.retryStatusCodes.includes(h):se.has(h))){const f=s.options.retryDelay||0;return f>0&&await new Promise(p=>setTimeout(p,f)),c(s.request,{...s.options,retry:e-1,timeout:s.options.timeout})}}const n=X(s);throw Error.captureStackTrace&&Error.captureStackTrace(n,c),n}const c=async function(l,n={}){var f;const e={request:l,options:te(n,o.defaults,r),response:void 0,error:void 0};if(e.options.method=(f=e.options.method)==null?void 0:f.toUpperCase(),e.options.onRequest&&await e.options.onRequest(e),typeof e.request=="string"&&(e.options.baseURL&&(e.request=P(e.request,e.options.baseURL)),(e.options.query||e.options.params)&&(e.request=z(e.request,{...e.options.params,...e.options.query}))),e.options.body&&q(e.options.method)&&(Z(e.options.body)?(e.options.body=typeof e.options.body=="string"?e.options.body:JSON.stringify(e.options.body),e.options.headers=new r(e.options.headers||{}),e.options.headers.has("content-type")||e.options.headers.set("content-type","application/json"),e.options.headers.has("accept")||e.options.headers.set("accept","application/json")):("pipeTo"in e.options.body&&typeof e.options.body.pipeTo=="function"||typeof e.options.body.pipe=="function")&&("duplex"in e.options||(e.options.duplex="half"))),!e.options.signal&&e.options.timeout){const p=new i;setTimeout(()=>p.abort(),e.options.timeout),e.options.signal=p.signal}try{e.response=await t(e.request,e.options)}catch(p){return e.error=p,e.options.onRequestError&&await e.options.onRequestError(e),await a(e)}if(e.response.body&&!re.has(e.response.status)&&e.options.method!=="HEAD"){const p=(e.options.parseResponse?"json":e.options.responseType)||oe(e.response.headers.get("content-type")||"");switch(p){case"json":{const g=await e.response.text(),k=e.options.parseResponse||L;e.response._data=k(g);break}case"stream":{e.response._data=e.response.body;break}default:e.response._data=await e.response[p]()}}return e.options.onResponse&&await e.options.onResponse(e),!e.options.ignoreResponseError&&e.response.status>=400&&e.response.status<600?(e.options.onResponseError&&await e.options.onResponseError(e),await a(e)):e.response},d=async function(l,n){return(await c(l,n))._data};return d.raw=c,d.native=(...s)=>t(...s),d.create=(s={})=>$({...o,defaults:{...o.defaults,...s}}),d}const w=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}(),ae=w.fetch||(()=>Promise.reject(new Error("[ofetch] global.fetch is not supported!"))),ne=w.Headers,ie=w.AbortController,R=$({fetch:ae,Headers:ne,AbortController:ie});R.create({baseURL:"https://back.colegiovirgendelvalle.com.co/api",async onRequest({options:o}){const t=F("accessToken").value;t&&(o.headers={...o.headers,Authorization:`Bearer ${t}`})}});const le=R.create({baseURL:"https://back.colegiovirgendelvalle.com.co/",async onRequest({options:o}){}}),ce=H("useTenantStore",{state:()=>({loading:{form:!1,table:!1},tenants:[]}),getters:{},actions:{async setHost(o){localStorage.setItem("baseUrl",`http://${o}.127.0.0.1:8000/api`),window.location.href="http://"+o+".localhost:5173",setTimeout(()=>{window.location.reload()},1e3)},async setHostLogin(o){window.location.href="http://"+o+".localhost:5173"},async setHostCentral(){const o=b(Q());o.value.baseURL,localStorage.setItem("baseUrl",o.value.baseURL),window.location.reload()},async fetchSave(o){var c;this.loading.form=!0;const{data:t,response:r,error:i,isFetching:a}=await v("/tenant-store").post(o);return this.loading.form=!1,(c=r.value)!=null&&c.ok&&t.value&&await le("/linkstorage",{method:"get"}),t.value},async fetchList(){var a;this.loading.form=!0;const{data:o,response:t,error:r,isFetching:i}=await v("/tenant-list").post({typeData:"todos"});return this.loading.form=!1,(a=t.value)!=null&&a.ok&&o.value&&(this.tenants=o.value.data),o.value}}}),we=V({__name:"ModalStore",props:{isDialogDetailVisible:{type:Boolean}},emits:["update:isDialogDetailVisible"],setup(o,{emit:t}){const r=b(),i=ce(),a=b({name:null}),c=async()=>{var n;const l=await((n=r.value)==null?void 0:n.validate());l!=null&&l.valid&&(await i.fetchSave(a.value),d("update:isDialogDetailVisible",!1),await i.fetchList())},d=t;N(a.value,l=>{a.value.name&&(a.value.name=a.value.name.replaceAll(" ","_"))});const s=()=>{d("update:isDialogDetailVisible",!1)};return(l,n)=>{const e=K,h=D;return C(),O("div",null,[u(G,{"model-value":o.isDialogDetailVisible,width:"500",persistent:""},{default:m(()=>[u(e,{onClick:n[0]||(n[0]=f=>s())}),u(I,{title:"Nuevo subdominio"},{default:m(()=>[u(_,null,{default:m(()=>[u(y(E),{ref_key:"formValidation",ref:r},{default:m(()=>[u(M,null,{default:m(()=>[u(J,{cols:"12"},{default:m(()=>[u(h,{modelValue:y(a).name,"onUpdate:modelValue":n[1]||(n[1]=f=>y(a).name=f),class:"mt-1",label:"Nombre de tenant a crear",rules:["requiredValidator"in l?l.requiredValidator:y(B)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),u(_,{class:"d-flex justify-end"},{default:m(()=>[u(T,{loading:y(i).loading.form,color:"secondary",class:"mr-5",onClick:n[2]||(n[2]=f=>s())},{default:m(()=>[S(" Cancelar ")]),_:1},8,["loading"]),u(T,{loading:y(i).loading.form,onClick:n[3]||(n[3]=f=>c())},{default:m(()=>[S(" Crear ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])])}}});export{we as _,ce as u};
