import{_ as oe}from"./BtnBack.vue_vue_type_script_setup_true_lang-Bqqux5iC.js";import{_ as se}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-DfccHCZ9.js";import{_ as ue}from"./AppSelectRemote-DXBzlG4S.js";import{_ as ne}from"./AppTextField.vue_vue_type_script_setup_true_lang-1kb894KG.js";import{_ as re}from"./AppSelect.vue_vue_type_script_setup_true_lang-CBNeKW5u.js";import{d as de,V as ie,t as me,r as V,aa as ce,N as pe,Y as j,c as p,o as n,b as a,f as l,af as _e,h as w,y as h,F as N,q as R,D as P,E as m,a9 as q,e as r,l as ve,G as fe,aU as ge,ad as ye,aZ as be,b6 as Ve,Z as he,$ as ke}from"./index-C9b6hrcK.js";import{c as Ee}from"./createUrl-DXD3sDF2.js";import{a as Fe,V as Se}from"./VCard-e9jpbFqx.js";import{V as D}from"./VCardText-CxJltrbS.js";import{V as $e}from"./VForm-CokzWhvo.js";import{V as k,a as _}from"./VRow-ZGlPE998.js";import{V as Ae,a as xe,b as Ce,c as je}from"./VExpansionPanels-wyqC7bhe.js";import{V as we}from"./VTable-DPNAykMc.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ModalQuestion.vue_vue_type_script_setup_true_lang-CLeitNmU.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-D7mzW6Fx.js";import"./VDialog-RqZjDXAw.js";import"./dialog-transition-Di1pGNk8.js";import"./VSelect-BhKRerLF.js";import"./VTextField-J-V-HBXf.js";/* empty css                   */import"./VCounter-J0O_p47B.js";import"./VImg-MODgQ4GY.js";import"./VList-MUuu6vN0.js";import"./ssrBoot-DxvvqgRH.js";import"./VAvatar-CaIuQVp3.js";import"./VDivider-DvYWI5ti.js";import"./VMenu-CsSg1Nwp.js";import"./VCheckboxBtn-CZeXJj-D.js";import"./VSelectionControl-CN7dOi7m.js";import"./VChip-DuawQfnX.js";import"./filter-BDNlLOSp.js";import"./helpers-k4gBJwIF.js";import"./constants-30sb_wC2.js";import"./index-0F-JFElI.js";/* empty css              */const U=E=>(he("data-v-488abbe7"),E=E(),ke(),E),Re=U(()=>r("span",null," Formulario periodo escolar ",-1)),Ue={key:0,class:"error--text"},Ie={class:"text-center"},Te={class:"text-center"},Be=U(()=>r("p",{class:"text-center"}," Reporte de materia pendiente. ",-1)),Pe=U(()=>r("th",null,"No.",-1)),qe=U(()=>r("th",null,"ALUMNO",-1)),De={key:0},Le=["colspan"],Me=de({__name:"Form",setup(E){const I=ie(),L=me(),{toast:H}=Ve(),d=V({}),c=V(!1),M=V(),g=ce({form:!1}),F=V([]),S=V([]),t=V({id:null,term_id:null,type_education_id:null,grade_id:null,code:null,students:[]}),J=()=>{t.value={id:null,term_id:null,type_education_id:null,grade_id:null,students:[]}},K=async()=>{var y;t.value.id=L.params.id;const o=t.value.id?`/pendingRegistration/${t.value.id}/edit`:"/pendingRegistration/create";g.form=!0;const{data:e,response:v}=await ge(Ee(`${o}`,{query:{company_id:I.company.id}}));g.form=!1,(y=v.value)!=null&&y.ok&&e.value&&(e.value.form&&(t.value={id:e.value.form.id||null,term_id:e.value.form.term_id||null,code:e.value.form.code||null,type_education_id:e.value.form.type_education_id||null,grade_id:e.value.form.grade_id||null,students:e.value.form.students||[]}),e.value.terms&&(F.value=e.value.terms),e.value.typeEducations&&(S.value=e.value.typeEducations))},Q=()=>{t.value.students.push({student_id:null,subjects:[]})},W=o=>{t.value.students.splice(o,1)},G=async()=>{var e;const o=await((e=M.value)==null?void 0:e.validate());if(o!=null&&o.valid){const v={...t.value,company_id:I.company.id,students:t.value.students.map(x=>({student_id:x.student_id,subjects:x.subjects}))},y=t.value.id?`/pendingRegistration/update/${t.value.id}`:"/pendingRegistration/store";g.form=!0;const{data:b,response:B}=await ye(y).post(v);g.form=!1,B.status==200&&b&&b.code===200&&be.push({name:"PendingRegistration-List"}),b.code===422&&(d.value=b.errors??{})}else H("Faltan campos por diligenciar","","danger")};L.params.action==="view"&&(c.value=!0),pe(async()=>{J(),await K()});const $=j(()=>Object.values(g).some(o=>o)),X=[o=>!!o||"El código es obligatorio"],O=[o=>!!o||"El periodo es obligatorio"],ee=[o=>!!o||"El grado es obligatorio"],te=[o=>!!o||"El estudiante es obligatorio"],ae=[o=>o.length>0||"Debe seleccionar al menos una materia"],T=j(()=>{if(t.value.type_education_id){const o=S.value.find(e=>e.value==t.value.type_education_id);return o?o.grades:[]}return[]}),Z=j(()=>t.value.grade_id?T.value.find(o=>o.value==t.value.grade_id).subjects:[]),A=j(()=>{const o=t.value.students.flatMap(e=>e.subjects);return[...new Set(o)].map(e=>Z.value.find(v=>v.value===e)).filter(e=>e!==void 0)});return(o,e)=>{const v=re,y=ne,b=ue,B=se,x=oe;return n(),p("div",null,[a(Se,{disabled:g.form,loading:g.form},{default:l(()=>[a(Fe,{class:"d-flex justify-space-between"},{default:l(()=>[Re]),_:1}),a(D,null,{default:l(()=>[a($e,{ref_key:"formValidation",ref:M,onSubmit:_e(G,["prevent"]),disabled:c.value},{default:l(()=>[a(k,null,{default:l(()=>[a(_,{cols:"12",md:"3"},{default:l(()=>[a(v,{requiredField:"true",clearable:"",modelValue:t.value.term_id,"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.term_id=s),items:F.value,label:"Periodo",rules:O,"error-messages":d.value.term_id,onChange:e[1]||(e[1]=s=>d.value.term_id=""),readonly:c.value},null,8,["modelValue","items","error-messages","readonly"])]),_:1}),a(_,{cols:"12",md:"3"},{default:l(()=>[a(y,{requiredField:"true",modelValue:t.value.code,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.code=s),rules:X,label:"Código de sección"},null,8,["modelValue"])]),_:1}),a(_,{cols:"12",md:"3"},{default:l(()=>[a(v,{requiredField:"true",clearable:"",modelValue:t.value.type_education_id,"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.type_education_id=s),items:S.value,label:"Tipo de educación",rules:O,"error-messages":d.value.term_id,onChange:e[4]||(e[4]=s=>d.value.term_id=""),readonly:c.value},null,8,["modelValue","items","error-messages","readonly"])]),_:1}),a(_,{cols:"12",md:"3"},{default:l(()=>[a(v,{requiredField:"true",clearable:"",modelValue:t.value.grade_id,"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.grade_id=s),items:T.value,label:"Grados y niveles",rules:ee,"error-messages":d.value.grade_id,onChange:e[6]||(e[6]=s=>d.value.grade_id=""),readonly:c.value},null,8,["modelValue","items","error-messages","readonly"])]),_:1}),a(_,{cols:"12"},{default:l(()=>[a(Ae,{multiple:""},{default:l(()=>[(n(!0),p(N,null,R(t.value.students,(s,i)=>(n(),w(xe,{key:i},{default:l(()=>[a(Ce,null,{actions:l(()=>[c.value?h("",!0):(n(),w(q,{key:0,icon:"tabler-x",color:"error",onClick:f=>W(i)},null,8,["onClick"]))]),default:l(()=>[P(" Estudiante "+m(i+1)+" ",1)]),_:2},1024),a(je,null,{default:l(()=>[a(k,null,{default:l(()=>[a(_,{cols:"12",md:"6"},{default:l(()=>[a(b,{modelValue:s.student_id,"onUpdate:modelValue":f=>s.student_id=f,url:"selectInfiniteStudent",arrayInfo:"student",rules:te,label:"Estudiante","error-messages":d.value[`students.${i}.student_id`],onInput:f=>d.value[`students.${i}.student_id`]="",readonly:c.value,params:{type_education_id:t.value.type_education_id}},null,8,["modelValue","onUpdate:modelValue","error-messages","onInput","readonly","params"])]),_:2},1024),a(_,{cols:"12",md:"6"},{default:l(()=>[a(B,{modelValue:s.subjects,"onUpdate:modelValue":f=>s.subjects=f,items:Z.value,label:"Materias",multiple:"",chips:"","closable-chips":"",rules:ae,"error-messages":d.value[`students.${i}.subjects`],onInput:f=>d.value[`students.${i}.subjects`]="",readonly:c.value},null,8,["modelValue","onUpdate:modelValue","items","error-messages","onInput","readonly"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),c.value?h("",!0):(n(),w(q,{key:0,color:"primary",onClick:Q,class:"mt-2"},{default:l(()=>[P(" Agregar Estudiante ")]),_:1}))]),_:1})]),_:1}),a(k,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>[Object.keys(d.value).length>0?(n(),p("div",Ue," Por favor, corrige los errores indicados. ")):h("",!0)]),_:1})]),_:1})]),_:1},8,["disabled"])]),_:1}),a(D,null,{default:l(()=>[a(k,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>{var s;return[r("h2",Ie,m(ve(I).company.name),1),r("p",Te," Año Escolar: "+m(((s=F.value.find(i=>i.value===t.value.term_id))==null?void 0:s.title)||"N/A")+" | Fecha: "+m(new Date().toLocaleDateString("es-ES")),1),Be]}),_:1})]),_:1}),a(k,null,{default:l(()=>[a(_,{cols:"12"},{default:l(()=>{var s,i,f;return[r("h3",null," Sección: "+m(((s=F.value.find(u=>u.value===t.value.term_id))==null?void 0:s.title)||"N/A")+" - "+m(((i=S.value.find(u=>u.value===t.value.type_education_id))==null?void 0:i.title)||"N/A")+" - "+m(((f=T.value.find(u=>u.value===t.value.grade_id))==null?void 0:f.title)||"N/A")+" - "+m(t.value.code||"N/A"),1),a(we,{class:"bordered-table"},{default:l(()=>[r("thead",null,[r("tr",null,[Pe,qe,(n(!0),p(N,null,R(A.value,u=>(n(),p("th",{key:u.value},m(u.abbreviation||u.title),1))),128))])]),r("tbody",null,[(n(!0),p(N,null,R(t.value.students,(u,le)=>{var z,Y;return n(),p("tr",{key:(z=u.student_id)==null?void 0:z.value},[r("td",null,m(le+1),1),r("td",null,m(((Y=u.student_id)==null?void 0:Y.title)||"N/A"),1),(n(!0),p(N,null,R(A.value,C=>(n(),p("td",{key:C.value,class:fe({"bg-yellow-lighten-3":u.subjects.includes(C.value),"bg-grey-lighten-3":!u.subjects.includes(C.value)&&A.value.length>0})},m(u.subjects.includes(C.value)?"--":""),3))),128))])}),128)),t.value.students.length?h("",!0):(n(),p("tr",De,[r("td",{colspan:A.value.length+2,class:"text-center"}," No hay estudiantes seleccionados. ",8,Le)]))])]),_:1})]}),_:1})]),_:1})]),_:1}),a(D,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:l(()=>[a(x,{disabled:$.value,loading:$.value},null,8,["disabled","loading"]),c.value?h("",!0):(n(),w(q,{key:0,disabled:$.value,loading:$.value,onClick:G,color:"primary"},{default:l(()=>[P(" Guardar ")]),_:1},8,["disabled","loading"]))]),_:1})]),_:1},8,["disabled","loading"])])}}}),St=Ne(Me,[["__scopeId","data-v-488abbe7"]]);export{St as default};
