import{_ as ce}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-CA8mSXlV.js";import{r as _e}from"./validators-BRob6R3L.js";import{d as X,r as m,bc as pe,bd as H,be as fe,a as me,h as b,o as u,f as a,b as e,ac as G,l as o,e as v,c as A,a7 as ee,a9 as N,D as h,F as Q,q as Z,aT as B,y as M,E as K,aG as ve,ab as ge,V as ye,b5 as he,Y as be,N as Ve,b6 as ke,aa as we,b7 as J,aS as xe}from"./index-CPwhtSgK.js";import{_ as ae}from"./AppSelect.vue_vue_type_script_setup_true_lang-huC62Px3.js";import{V as S,b as Ce,a as O}from"./VCard-B7sj5Nmp.js";import{V as Y}from"./VForm-BKIHj-pQ.js";import{V as y,a as f}from"./VRow-BLWzftUR.js";import{V}from"./VCardText-BO_T3VgW.js";import{V as De}from"./VImg-CBVvkvKd.js";import{V as Ae}from"./VSpacer-CE0YHy3b.js";import{_ as Fe}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-7NAP-lTp.js";import{u as Se,V as Ee}from"./VFileInput-CY-E-7zd.js";import{c as $e}from"./createUrl-bFNo1-S4.js";import{b as Ne}from"./helpers-Dh_CHnDW.js";import{V as W}from"./VSwitch-BeREQvYn.js";import{V as qe}from"./VDivider-DhMtNSTJ.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-ClnwK2-I.js";import"./VDialog-CcFFQs7Y.js";import"./dialog-transition-BzJz2Y5A.js";import"./VSelect-COdd_cGw.js";import"./VTextField-DVAJ4D6q.js";/* empty css                   */import"./VCounter-C5J3IHoT.js";import"./VList-CkSi65FC.js";import"./ssrBoot-BVITu9xw.js";import"./VAvatar-DFdPWHkH.js";import"./VMenu-DlCvdLnT.js";import"./VCheckboxBtn-CgMwaTT1.js";import"./VSelectionControl-CBfg-izY.js";import"./VChip-CBXLIrq5.js";/* empty css              */import"./filter-ByJ5Yngr.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import"./index-0F-JFElI.js";import"./constants-2GBt7OCP.js";const ze={class:"flex"},Be={class:"w-full h-auto relative"},Ue={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},Me=v("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquí. ",-1),Re=v("span",{class:"text-disabled"},"o",-1),Ie={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},Te={class:"mt-2"},Oe={class:"clamp-text text-wrap"},Pe={key:0,class:"mt-2"},je=v("span",null,"Cargando...",-1),Le={key:1,class:"mt-2 text-success"},Ge=v("span",null,"¡Archivo cargado exitosamente!",-1),Qe=[Ge],Ze={key:2,class:"mt-2 text-danger"},Ke=v("span",null,"Error al cargar el archivo",-1),Ye=[Ke],He=X({__name:"DragAndDrop",setup(oe){const R=m(),w=m(),_=m([]),{open:F,onChange:t}=pe({});function g(p){p==null||p.forEach(i=>{if(i.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}_.value.push({file:i,url:H(i).value??"",progress:void 0,status:"pending"})})}t(p=>{if(p)for(const i of p)_.value.push({file:i,url:H(i).value??"",progress:void 0,status:"pending"})}),fe(w,g);const x=async()=>{var i,C;const p=await((i=R.value)==null?void 0:i.validate());if(p!=null&&p.valid){if(_.value.length===0){alert("No hay archivos para guardar");return}E.value=!0;for(let D=0;D<_.value.length;D++){const d=_.value[D];d.status="uploading";try{const k=new FormData;k.append("file",d.file),k.append("field",q.value);const{data:U,response:P}=await B("/savefiles").post(k);(C=P.value)!=null&&C.ok&&U.value&&(d.status="completed",d.progress=100,console.log(`Archivo ${d.file.name} guardado correctamente`))}catch(k){d.status="failed",d.progress=void 0,console.error("Error al guardar el archivo",d.file.name,k),alert(`Error al guardar el archivo ${d.file.name}`)}}E.value=!1}},E=m(!1),q=m(),$=[{title:"Foto",value:"photo"},{title:"Boletín",value:"boletin"}];return(p,i)=>{const C=ae,D=me("IconBtn");return u(),b(S,{class:"mb-6",title:"Archivos"},{default:a(()=>[e(V,null,{default:a(()=>[e(Y,{ref_key:"formValidation",ref:R,onSubmit:G(()=>{},["prevent"])},{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",md:"6"},{default:a(()=>[e(C,{requiredField:!0,label:"Campo",items:$,modelValue:q.value,"onUpdate:modelValue":i[0]||(i[0]=d=>q.value=d),rules:["requiredValidator"in p?p.requiredValidator:o(_e)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(V,null,{default:a(()=>[v("div",ze,[v("div",Be,[v("div",{ref_key:"dropZoneRef",ref:w,class:"cursor-pointer",onClick:i[2]||(i[2]=()=>o(F)())},[_.value.length===0?(u(),A("div",Ue,[e(D,{variant:"tonal",class:"rounded-sm"},{default:a(()=>[e(ee,{icon:"tabler-upload"})]),_:1}),Me,Re,e(N,{variant:"tonal"},{default:a(()=>[h("Explorar archivos")]),_:1})])):(u(),A("div",Ie,[e(y,{class:"match-height w-100"},{default:a(()=>[(u(!0),A(Q,null,Z(_.value,(d,k)=>(u(),b(f,{key:k,cols:"12",sm:"4"},{default:a(()=>[e(S,{ripple:!1,border:"",class:"d-flex flex-column"},{default:a(()=>[e(V,{onClick:i[1]||(i[1]=G(()=>{},["stop"]))},{default:a(()=>[e(De,{src:d.url,width:"150px",height:"100px"},null,8,["src"]),v("div",Te,[v("span",Oe,K(d.file.name),1),v("span",null,K(d.file.size/1e3)+" KB ",1)]),d.status==="uploading"?(u(),A("div",Pe,[e(ve,{size:24,value:d.progress,color:"primary"},null,8,["value"]),je])):M("",!0),d.status==="completed"?(u(),A("div",Le,Qe)):M("",!0),d.status==="failed"?(u(),A("div",Ze,Ye)):M("",!0)]),_:2},1024),e(Ae),e(Ce,null,{default:a(()=>[e(N,{variant:"outlined",block:"",onClick:G(U=>_.value.splice(k,1),["stop"])},{default:a(()=>[h(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(N,{disabled:E.value,loading:E.value,color:"primary",onClick:x},{default:a(()=>[h(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),Je=v("b",{class:"text-warning"},"*",-1),We={class:"demo-space-x"},Xe={class:"demo-space-x"},ea={class:"demo-space-x"},Ua=X({__name:"Index",setup(oe){const R=ge(),w=ye(),{toast:_}=xe(),F=m(Se());F.value.allowedExtensions=["xls","xlsx"];const t=he({form:!1,download_notes:!1,block_uploading_of_grades_to_teachers:!1,viewing_notes:!1}),g=m({company_id:null,type_education_id:null,teacher_id:null,archive:null}),x=m({}),E=m(),q=m(),$=m([]),p=m([]),i=m(!1),C=m({}),D=s=>!!s||"Campo requerido",d=async()=>{var l;g.value.archive=F.value.imageFile,g.value.company_id=w.company.id;const s=await((l=E.value)==null?void 0:l.validate());if(s!=null&&s.valid){const c=new FormData;c.append("company_id",String(g.value.company_id)),c.append("user_id",String(w.user.id)),c.append("type_education_id",String(g.value.type_education_id)),c.append("teacher_id",String(g.value.teacher_id||"")),c.append("archive",g.value.archive),t.form=!0;try{console.log("📤 [FORM] Enviando formulario...");const{data:n,response:z}=await J("note-store").post(c);console.log("📥 [FORM] Respuesta del servidor:",n.value),z.status==200&&n?n.status==="success"?(console.log("🚀 [FORM] Iniciando loading para batch_id:",n.batch_id),R.startLoading(n.batch_id)?(_("Importación iniciada correctamente","","success"),g.value={company_id:w.company.id,type_education_id:null,teacher_id:null,archive:null},F.value.clearData()):_("Error iniciando la importación","","danger")):n.status==="error"&&(_("Error en la importación",n.message,"danger"),n.errors&&(x.value=n.errors)):_("Error en la respuesta del servidor","","danger")}catch(n){console.error("❌ [FORM] Error en submitForm:",n),_("Error al procesar el archivo","","danger")}finally{t.form=!1}}else _("Faltan Campos Por Diligenciar","","danger")},k=async()=>{t.form=!0;const{data:s,response:l}=await J("note-dataForm").get({params:{company_id:w.company.id}});l.status==200&&s&&($.value=s.typeEducations,i.value=s.blockData,p.value=s.teachers),t.form=!1},U=s=>!0,P=async()=>{var c;const{data:s,response:l}=await B("/type_educations/visualization/show").get();(c=l.value)!=null&&c.ok&&s.value&&(C.value=s.value.selectedNotes)},I=m({type_education_id:null}),le=async()=>{var l,c;const s=await((l=q.value)==null?void 0:l.validate());if(s!=null&&s.valid){t.download_notes=!0;const n=$.value.find(r=>r.value==I.value.type_education_id),{data:z,response:T}=await B($e("/note-downloadAllConsolidated",{query:{type_education_id:I.value.type_education_id,company_id:w.company.id}}));t.download_notes=!1,(c=T.value)!=null&&c.ok&&z.value&&Ne(z.value.excel,"Consolidado "+(n==null?void 0:n.title))}else _("Faltan Campos Por Diligenciar","","danger")},te=async s=>{var n;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:c}=await B("/note-blockPayrollUpload").post({value:s});(n=c.value)!=null&&n.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},se=async s=>{var n;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:c}=await B("/note-resetOptionDownloadPdf").post({company_id:w.company.id});(n=c.value)!=null&&n.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},ne=be(()=>i.value?"Sí":"No"),re=async()=>{t.viewing_notes=!0;const{data:s,response:l}=await B("/type_educations/visualization/store").post({selectedNotes:C.value});t.viewing_notes=!1},j=m(),ie=()=>{j.value.openModal(),j.value.componentData.title="Esta seguro que desea activar a todos los estudiantes en un estado insolventes"};return Ve(async()=>{await P(),console.log("🚀 [PAGE] Component mounted - Queue system enabled"),await k()}),(s,l)=>{const c=ae,n=Fe,z=He,T=ce;return u(),A("div",null,[(u(),b(S,{key:0,disabled:o(t).form,loading:o(t).form},{default:a(()=>[e(O,{"primary-title":""},{default:a(()=>[h(" Cargar Notas ")]),_:1}),e(V,null,{default:a(()=>[e(o(Y),{ref_key:"formValidation",ref:E,"lazy-validation":""},{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[e(c,{clearable:"",modelValue:o(g).type_education_id,"onUpdate:modelValue":l[0]||(l[0]=r=>o(g).type_education_id=r),rules:[D],"error-messages":o(x).type_education_id,label:"Tipo",onChange:l[1]||(l[1]=r=>o(x).type_education_id=""),requiredField:!0,items:o($)},null,8,["modelValue","rules","error-messages","items"])]),_:1}),e(f,{cols:"12",sm:"4"},{default:a(()=>[e(ke,null,{default:a(()=>[h("Archivo "),Je]),_:1}),(u(),b(Ee,{key:o(F).key,onChange:o(F).handleImageSelected,"onClick:clear":o(F).clearData,rules:[D]},null,8,["onChange","onClick:clear","rules"]))]),_:1}),e(f,{cols:"12",sm:"4"},{default:a(()=>[e(n,{clearable:"",modelValue:o(g).teacher_id,"onUpdate:modelValue":l[2]||(l[2]=r=>o(g).teacher_id=r),"error-messages":o(x).teacher_id,label:"Docente",onChange:l[3]||(l[3]=r=>o(x).teacher_id=""),items:o(p)},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(N,{loading:o(t).form,color:"primary",onClick:l[4]||(l[4]=r=>d())},{default:a(()=>[e(ee,{start:"",icon:"tabler-upload"}),h(" Cargar Archivo ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),(u(),b(S,{key:1,disabled:o(t).download_notes,loading:o(t).download_notes,class:"mt-3"},{default:a(()=>[e(O,{"primary-title":""},{default:a(()=>[h("Descargar Notas")]),_:1}),e(V,null,{default:a(()=>[e(o(Y),{ref_key:"formValidationDownload",ref:q,"lazy-validation":""},{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[e(c,{clearable:"",modelValue:o(I).type_education_id,"onUpdate:modelValue":l[5]||(l[5]=r=>o(I).type_education_id=r),rules:[D],"error-messages":o(x).type_education_id,label:"Tipo",onChange:l[6]||(l[6]=r=>o(x).type_education_id=""),requiredField:!0,items:o($)},null,8,["modelValue","rules","error-messages","items"])]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(N,{loading:o(t).download_notes,disabled:o(t).download_notes,color:"primary",onClick:l[7]||(l[7]=r=>le())},{default:a(()=>[h(" Descargar ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),e(y,null,{default:a(()=>[e(f,{cols:"4"},{default:a(()=>[U("note.block_uploading_of_grades_to_teachers")?(u(),b(S,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(O,{"primary-title":""},{default:a(()=>[h("Bloquear carga de notas a los profesores")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[v("div",We,[e(W,{modelValue:o(i),"onUpdate:modelValue":[l[8]||(l[8]=r=>we(i)?i.value=r:null),l[9]||(l[9]=r=>te(r))],label:o(ne),color:"success"},null,8,["modelValue","label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):M("",!0)]),_:1}),e(f,{cols:"4"},{default:a(()=>[U("note.reset_option_download_pdf")?(u(),b(S,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(O,{"primary-title":""},{default:a(()=>[h("Reiniciar opción descarga pdf y boletin")]),_:1}),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[v("div",Xe,[e(N,{color:"primary",onClick:ie},{default:a(()=>[h("Reiniciar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):M("",!0)]),_:1})]),_:1}),(u(),b(S,{key:2,disabled:o(t).viewing_notes,loading:o(t).viewing_notes,class:"mt-3",title:"Visualización de las notas"},{default:a(()=>[(u(!0),A(Q,null,Z(o($),r=>(u(),b(V,{key:r.value},{default:a(()=>[e(qe),e(y,null,{default:a(()=>[e(f,null,{default:a(()=>[v("span",null,K(r.title),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:a(()=>[(u(!0),A(Q,null,Z(r.cantNotes,(L,de)=>(u(),b(f,{cols:"12",sm:"4",key:de},{default:a(()=>[v("div",ea,[e(W,{modelValue:o(C)[r.value]["note_"+L],"onUpdate:modelValue":ue=>o(C)[r.value]["note_"+L]=ue,label:"Nota "+L,color:"success"},null,8,["modelValue","onUpdate:modelValue","label"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128)),e(V,null,{default:a(()=>[e(y,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(N,{loading:o(t).form,disabled:o(t).form,color:"primary",onClick:l[10]||(l[10]=r=>re())},{default:a(()=>[h(" Guardar Visualización ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])),(u(),b(S,{key:3,title:"Carga de archivos masivos",class:"mt-3"},{default:a(()=>[e(V,null,{default:a(()=>[e(z)]),_:1})]),_:1})),e(T,{ref_key:"refModalQuestion",ref:j,onSuccess:se},null,512)])}}});export{Ua as default};
