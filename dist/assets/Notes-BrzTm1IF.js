import{_ as ue}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-B9CXAvdJ.js";import{_ as de}from"./AppTextField.vue_vue_type_script_setup_true_lang-tPb9GRlz.js";import{_ as ie}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-6vZWU1pl.js";import{_ as re}from"./BtnBack.vue_vue_type_script_setup_true_lang-LvM9IGc6.js";import{d as me,V as ce,t as pe,r as g,b5 as _e,Y as H,N as fe,c as _,o as c,b as l,f as n,e as i,E as p,l as ve,F as M,q as N,y as S,G as ge,h as E,a9 as T,a7 as q,D as U,aT as w,aS as be,Z as ye,$ as Ve}from"./index-CtOr4Wu7.js";import{c as J}from"./createUrl-D9sypOAs.js";import{a as he,V as K}from"./VCard-COZucsTL.js";import{V as $}from"./VCardText-v8gCKQRH.js";import{V as j,a as y}from"./VRow-C1C7EzPn.js";import{V as ke}from"./VTable-ClsD0PQ0.js";import{V as we}from"./VChip-X8cnhpwt.js";import{V as xe}from"./VDialog-CybUf8DC.js";import{V as Ce,a as Ae}from"./VToolbar-5bAjszzX.js";import{V as Me}from"./VForm-BhvUgRDX.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VTextField-B5WBRC1t.js";/* empty css                   */import"./VCounter-DANGpuYg.js";import"./VImg-Ctxsnw81.js";import"./index-0F-JFElI.js";import"./VAvatar-e7AxYF9T.js";/* empty css              */import"./dialog-transition-dwJwLnHT.js";const D=x=>(ye("data-v-1dfce7d0"),x=x(),Ve(),x),Se=D(()=>i("span",null,"Gestionar Notas",-1)),$e={class:"text-center"},De={class:"text-center"},Fe=D(()=>i("p",{class:"text-center"}," Reporte de materia pendiente. ",-1)),Ie=D(()=>i("th",null,"No.",-1)),Re=D(()=>i("th",null,"ALUMNO",-1)),Be={key:0,class:"d-flex flex-column justify-center align-center"},Ee=["onClick"],Te={key:0},qe=["colspan"],Ue=me({__name:"Notes",setup(x){const F=ce(),C=pe(),{toast:L}=be(),G=g({}),V=g(!1);g("");const Q=g(),m=_e({form:!1,attempts:!1,submit:!1,momento:!1}),b=g({id:null,term_id:null,term_name:null,type_education_id:null,type_education_name:null,grade_name:null,grade_id:null,students:[]}),I=()=>{V.value=!V.value},h=g([]),u=g(null),A=H(()=>{const o=new Map;return b.value.students.forEach(t=>{t.subjects.forEach(e=>{o.has(e.id)||o.set(e.id,{value:e.id,title:e.name})})}),Array.from(o.values())}),P=async()=>{var s;const t=`/pendingRegistration/${C.params.id}/show`;m.form=!0;const{data:e,response:d}=await w(J(t,{query:{company_id:F.company.id}}));m.form=!1,(s=d.value)!=null&&s.ok&&e.value?e.value.form&&(b.value={id:e.value.form.id||null,term_id:e.value.form.term_id||null,term_name:e.value.form.term_name||null,type_education_id:e.value.form.type_education_id||null,type_education_name:e.value.form.type_education_name||null,grade_name:e.value.form.grade_name||null,grade_id:e.value.form.grade_id||null,students:e.value.form.students||[]}):L("Error al cargar la sección","","danger")},R=async()=>{var s;const t=`/pendingRegistration/attempts/${C.params.id}`;m.attempts=!0;const{data:e,response:d}=await w(J(t,{query:{company_id:F.company.id}}));m.attempts=!1,(s=d.value)!=null&&s.ok&&e.value&&(h.value=e.value.data||[])},W=async o=>{var d,s;m.submit=!0;const{data:t,response:e}=await w("/pendingRegistration/attempts/store").post(o);m.submit=!1,(d=e.value)!=null&&d.ok&&t.value?t.value.code===200&&(await R(),V.value=!1):((s=t.value)==null?void 0:s.code)===422&&(G.value=t.value.errors??{})},X=async(o,t)=>{var s,f;m.submit=!0;const{data:e,response:d}=await w(`/pendingRegistration/attempts/update/${o}`).post(t);m.submit=!1,(s=d.value)!=null&&s.ok&&e.value?e.value.code===200&&(await R(),V.value=!1):((f=e.value)==null?void 0:f.code)===422&&(G.value=e.value.errors??{})},z=(o,t,e=null)=>{const d=o.student_id.value,s=t.value,f=h.value.filter(a=>a.student_id.value===d&&a.subject_id.value===s);u.value=e?{...e}:{pending_registration_id:C.params.id,student_id:{value:o.student_id.value,title:o.student_id.title},subject_id:{value:s,title:t.title},attempt_number:f.length+1,note:null,attempt_date:null},I()},ee=async()=>{var t;const o=await((t=Q.value)==null?void 0:t.validate());if(o!=null&&o.valid){const e={pending_registration_id:C.params.id,student_id:u.value.student_id.value,subject_id:u.value.subject_id.value,attempt_number:u.value.attempt_number,note:u.value.note,attempt_date:u.value.attempt_date};u.value.id?await X(u.value.id,e):await W(e)}else L("Faltan campos por diligenciar","","danger")},k=H(()=>Object.values(m).some(o=>o));fe(async()=>{await P(),await R()});const B=g(),te=o=>{B.value.componentData.title="¿Está seguro que desea eliminar el momento?",B.value.openModal(o)},ae=async o=>{var s;m.momento=!0;const t=`/pendingRegistration/attempts/delete/${o}`,{data:e,response:d}=await w(t).delete();m.momento=!1,(s=d.value)!=null&&s.ok&&e.value&&(h.value=h.value.filter(f=>f.id!==o))},O=(o,t)=>h.value.filter(e=>e.student_id.value===o&&e.subject_id.value===t).sort((e,d)=>d.attempt_number-e.attempt_number),le=(o,t)=>{const e=O(o,t);return e.length<4&&(e.length===0||!e[0].approved)};return(o,t)=>{const e=re,d=ie,s=de,f=ue;return c(),_("div",null,[l(K,{disabled:m.form,loading:m.form},{default:n(()=>[l(he,{class:"d-flex justify-space-between"},{default:n(()=>[Se]),_:1}),l($,null,{default:n(()=>[l(j,null,{default:n(()=>[l(y,{cols:"12"},{default:n(()=>[i("h2",$e,p(ve(F).company.name),1),i("p",De," Año Escolar: "+p(b.value.term_name||"N/A")+" | Fecha: "+p(new Date().toLocaleDateString("es-ES")),1),Fe]),_:1})]),_:1}),l(j,null,{default:n(()=>[l(y,{cols:"12"},{default:n(()=>[i("h3",null," Sección: "+p(b.value.type_education_name||"N/A")+" - "+p(b.value.grade_name||"N/A"),1),l(ke,{class:"bordered-table"},{default:n(()=>[i("thead",null,[i("tr",null,[Ie,Re,(c(!0),_(M,null,N(A.value,a=>(c(),_("th",{key:a.value},p(a.title),1))),128))])]),i("tbody",null,[(c(!0),_(M,null,N(b.value.students,(a,oe)=>{var Y,Z;return c(),_("tr",{key:(Y=a.student_id)==null?void 0:Y.value},[i("td",null,p(oe+1),1),i("td",null,p(((Z=a.student_id)==null?void 0:Z.title)||"N/A"),1),(c(!0),_(M,null,N(A.value,v=>(c(),_("td",{key:v.value,class:ge({"bg-yellow-lighten-3":a.subjects.some(r=>r.id===v.value),"bg-grey-lighten-3":!a.subjects.some(r=>r.id===v.value)&&A.value.length>0})},[a.subjects.some(r=>r.id===v.value)?(c(),_("div",Be,[le(a.student_id.value,v.value)?(c(),E(T,{key:0,icon:"tabler-plus",size:"small",color:"primary",onClick:r=>z(a,v)},null,8,["onClick"])):S("",!0),(c(!0),_(M,null,N(O(a.student_id.value,v.value),(r,ne)=>(c(),E(we,{key:r.id,color:r.approved?"success":"warning",class:"ma-1"},{default:n(()=>[i("span",{onClick:se=>z(a,v,r),style:{cursor:"pointer"}}," Momento "+p(r.attempt_number)+": "+p(r.note)+" ("+p(r.attempt_date)+") ",9,Ee),ne===0?(c(),E(q,{key:0,color:"error",class:"ml-2",onClick:se=>te(r.id),icon:"tabler-trash"},null,8,["onClick"])):S("",!0)]),_:2},1032,["color"]))),128))])):S("",!0)],2))),128))])}),128)),b.value.students.length?S("",!0):(c(),_("tr",Te,[i("td",{colspan:A.value.length+2,class:"text-center"}," No hay estudiantes seleccionados. ",8,qe)]))])]),_:1})]),_:1})]),_:1})]),_:1}),l($,{class:"d-flex justify-end gap-3 flex-wrap mt-5"},{default:n(()=>[l(e,{disabled:k.value,loading:k.value},null,8,["disabled","loading"])]),_:1}),l(xe,{modelValue:V.value,"onUpdate:modelValue":t[8]||(t[8]=a=>V.value=a),"max-width":"500px",persistent:""},{default:n(()=>[l(d,{onClick:t[0]||(t[0]=a=>I())}),i("div",null,[l(Ce,{color:"primary"},{default:n(()=>[l(Ae,null,{default:n(()=>{var a;return[U(p((a=u.value)!=null&&a.id?"Editar Momento":"Agregar Momento"),1)]}),_:1})]),_:1})]),l(K,null,{default:n(()=>[l($,null,{default:n(()=>[l(Me,{ref_key:"formValidation",ref:Q},{default:n(()=>[l(j,null,{default:n(()=>[l(y,{cols:"12"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.student_id.title,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.student_id.title=a),label:"Estudiante",disabled:""},null,8,["modelValue"])]),_:1}),l(y,{cols:"12"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.subject_id.title,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.subject_id.title=a),label:"Materia",disabled:""},null,8,["modelValue"])]),_:1}),l(y,{cols:"12",md:"6"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.attempt_number,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value.attempt_number=a),disabled:"",label:"Número de Momento",type:"number",rules:[a=>!!a&&a>=1&&a<=4||"Debe ser entre 1 y 4"]},null,8,["modelValue","disabled","rules"])]),_:1}),l(y,{cols:"12",md:"6"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.note,"onUpdate:modelValue":t[4]||(t[4]=a=>u.value.note=a),label:"Nota (0-20)",type:"number",rules:[a=>!!a&&a>=0&&a<=20||"Debe estar entre 0 y 20"]},null,8,["modelValue","rules"])]),_:1}),l(y,{cols:"12",md:"6"},{default:n(()=>[l(s,{requiredField:"true",modelValue:u.value.attempt_date,"onUpdate:modelValue":t[5]||(t[5]=a=>u.value.attempt_date=a),label:"Fecha del Momento",type:"date",rules:[a=>!!a||"La fecha es obligatoria"]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l($,{class:"d-flex justify-end gap-3 flex-wrap"},{default:n(()=>[l(T,{loading:k.value,color:"secondary",variant:"tonal",onClick:t[6]||(t[6]=a=>I())},{default:n(()=>[l(q,{start:"",icon:"tabler-x"}),U(" Cancelar ")]),_:1},8,["loading"]),l(T,{disabled:k.value,loading:k.value,onClick:t[7]||(t[7]=a=>ee()),color:"primary"},{default:n(()=>[l(q,{start:"",icon:"tabler-device-floppy"}),U(" Guardar ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["disabled","loading"]),l(f,{ref_key:"refModalQuestion",ref:B,onSuccess:ae},null,512)])}}}),it=Ne(Ue,[["__scopeId","data-v-1dfce7d0"]]);export{it as default};
