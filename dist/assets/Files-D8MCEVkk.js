import{r as F}from"./validators-CMXCoPct.js";import{_ as J}from"./AppTextField.vue_vue_type_script_setup_true_lang-CeRiEnJN.js";import{_ as O}from"./HeaderAlertView.vue_vue_type_script_setup_true_lang-BeBCzkO4.js";import{d as P,V as Z,U as K,t as Q,r as b,aU as w,N as W,aJ as S,c as T,o as p,b as e,f as a,h as g,y as B,e as _,E as y,F as X,q as Y,l as $,D as E,a8 as h,a6 as C,aM as ee,Z as ae,$ as te}from"./index-8SQbxB83.js";import{u as le,V as oe}from"./VFileInput-BR7GJ9MM.js";import{V as k}from"./VCardText-BtGMt_ph.js";import{V as f,a as n}from"./VRow-CugFyr-8.js";import{V as ie}from"./VSkeletonLoader-DqIXY7U5.js";import{V as x,a as re}from"./VCard-C70SBN61.js";import{V as se}from"./VInput-17yuJ0qV.js";import{V as ne}from"./VDataTable-BNR3NZJZ.js";import{V as R}from"./VTooltip-DGmvvybB.js";import{V as ue}from"./VForm-CSjkUXVS.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./helpers-C3c6tHut.js";import"./constants-2GBt7OCP.js";import"./VTextField-BLRe7Hf2.js";/* empty css                   */import"./VCounter-ClhUsMgh.js";import"./VImg-cxLM0865.js";import"./forwardRefs-C-GTDzx5.js";import"./VAlert-DBL5mf_D.js";import"./VAvatar-WJPY0oQh.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import"./VChip-D6M_WKfE.js";/* empty css              */import"./VOverlay-Brixf5Ma.js";import"./VSelect-DnCvkXdL.js";import"./VList-DLEb92Ge.js";import"./ssrBoot-Bzqv-bkS.js";import"./VDivider-CPpONYaL.js";import"./dialog-transition-CsGW7g0i.js";import"./VMenu-Cb7roRYT.js";import"./VCheckboxBtn-DmGkb5Aj.js";import"./VSelectionControl-DkugQovs.js";import"./VTable-D6231PkW.js";import"./filter-Bg7CVthA.js";const de=v=>(ae("data-v-3848d722"),v=v(),te(),v),pe={class:"text-h5 font-weight-bold mb-2"},fe={class:"text-subtitle-1 text--secondary"},me=de(()=>_("b",{class:"text-warning"},"*",-1)),_e=P({__name:"Files",setup(v){const q=Z(),{company:z,user:ve}=K(q),A=Q(),D=b(null),d=w({form:!1}),m=b(null),V=b([]),r=w({}),I=[{title:"Título",key:"name",sortable:!1},{title:"Acciones",key:"actions",sortable:!1}];W(async()=>{var u;d.form=!0;const{data:t,response:i}=await S(`/pendingRegistration/files/${A.params.id}`).get();(u=i.value)!=null&&u.ok&&t.value&&(m.value=t.value.pendingRegistration,V.value=t.value.subjects.map(o=>({subject:o.subject,value:o.subject.id,files:o.files||[]})),V.value.forEach(o=>{r[`file-${o.value}`]=le(),r[`file-${o.value}`].allowedExtensions=["jpg","jpeg","png","pdf","ppsx","pptx"]})),d.form=!1});const j=async()=>{var l;const t=new FormData;t.append("company_id",z.value.id),t.append("pending_registration_id",m.value.id);let i=0;V.value.forEach(c=>{c.files.forEach(s=>{t.append(`file_id_${i}`,s.id||""),t.append(`file_subject_id_${i}`,c.value),s.file&&t.append(`file_file_${i}`,s.file),t.append(`file_name_${i}`,s.name),i++})}),t.append("files_cant",i.toString()),d.form=!0;const{data:u,response:o}=await S("/pendingRegistration/attempts/storeOrUpdate").post(t);d.form=!1,(l=o.value)!=null&&l.ok&&u.value&&ee.push({name:"PendingRegistration-List"})},N=async t=>{r[`file-${t.value}`].imageFile&&(t.files.push({id:null,name:r[`file-${t.value}`].name||"Nuevo archivo",file:r[`file-${t.value}`].imageFile}),r[`file-${t.value}`].clearData())},U=(t,i)=>{t.splice(i,1)},L=(t,i)=>{const u=`undefined/storage/${t}`,o=document.createElement("a");o.href=u,o.download=i,o.click()},M=t=>t;return(t,i)=>{const u=O,o=J;return p(),T("div",null,[e(x,null,{default:a(()=>[e(k,null,{default:a(()=>[e(f,null,{default:a(()=>[e(n,null,{default:a(()=>[e(u,{"sub-title":"Formulario archivos de materias pendientes","btn-action":"list","validate-crud":!0,"btn-back":!0,onChangeScreenBack:t.$router.back},null,8,["onChangeScreenBack"])]),_:1})]),_:1}),e(k,null,{default:a(()=>[e(ie,{type:"image, list-item-two-line",loading:d.form,class:"mt-5"},{default:a(()=>[m.value?(p(),g(f,{key:0},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>[e(x,{class:"elevation-2",outlined:""},{default:a(()=>[e(k,{class:"pa-4"},{default:a(()=>[e(f,{"no-gutters":"",align:"center",class:"header-info"},{default:a(()=>[e(n,{cols:"12"},{default:a(()=>{var l,c;return[_("h2",pe,y((l=m.value)==null?void 0:l.company_name),1),_("p",fe," Sección: "+y((c=m.value)==null?void 0:c.section_name),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):B("",!0),e(f,null,{default:a(()=>[(p(!0),T(X,null,Y(V.value,(l,c)=>(p(),g(n,{cols:"12",key:c},{default:a(()=>[e(x,null,{default:a(()=>[e(re,{"primary-title":""},{default:a(()=>[_("h4",null,y(l.subject.name),1)]),_:2},1024),e(k,null,{default:a(()=>[e($(ue),{ref_for:!0,ref_key:"formValidation",ref:D,"lazy-validation":""},{default:a(()=>[e(f,null,{default:a(()=>[e(n,{cols:"12",sm:"6"},{default:a(()=>[e(o,{clearable:"",modelValue:r[`file-${l.value}`].name,"onUpdate:modelValue":s=>r[`file-${l.value}`].name=s,rules:["requiredValidator"in t?t.requiredValidator:$(F)],label:"Título",requiredField:!0},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(n,{cols:"12",sm:"5"},{default:a(()=>[e(se,null,{default:a(()=>[E("Archivo "),me]),_:1}),(p(),g(oe,{rules:["requiredValidator"in t?t.requiredValidator:$(F)],onChange:r[`file-${l.value}`].handleImageSelected,key:r[`file-${l.value}`].key,"onClick:clear":r[`file-${l.value}`].clearData},null,8,["rules","onChange","onClick:clear"]))]),_:2},1024),e(n,{cols:"12",sm:"1"},{default:a(()=>[e(h,{size:"30",class:"mt-6",icon:"",color:"success",onClick:s=>N(l)},{default:a(()=>[e(C,{icon:"tabler-plus"})]),_:2},1032,["onClick"])]),_:2},1024),e(n,{cols:"12"},{default:a(()=>[e(ne,{headers:I,items:l.files,"items-per-page":999},{"item.actions":a(({item:s,index:G})=>[_("div",null,[s.file?(p(),g(h,{key:0,icon:"",size:"x-small",color:"primary",variant:"text",onClick:H=>L(M(s.file),s.name)},{default:a(()=>[e(C,{size:"22",icon:"tabler-eye"}),e(R,{location:"top",transition:"scale-transition",activator:"parent",text:"Visualizar"})]),_:2},1032,["onClick"])):B("",!0),e(h,{icon:"",size:"x-small",color:"error",variant:"text",onClick:H=>U(l.files,G)},{default:a(()=>[e(C,{size:"22",icon:"tabler-trash"}),e(R,{location:"top",transition:"scale-transition",activator:"parent",text:"Eliminar"})]),_:2},1032,["onClick"])])]),bottom:a(()=>[]),_:2},1032,["items"])]),_:2},1024)]),_:2},1024)]),_:2},1536)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["loading"])]),_:1}),e(f,null,{default:a(()=>[e(n,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(h,{loading:d.form,color:"primary",onClick:j},{default:a(()=>[E(" Guardar ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})])}}}),ea=ce(_e,[["__scopeId","data-v-3848d722"]]);export{ea as default};
