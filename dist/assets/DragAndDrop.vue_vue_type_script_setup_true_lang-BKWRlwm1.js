import{V as $,r as R}from"./VForm-CpTkIOA0.js";import{d as U,r as c,cn as Z,co as w,cp as F,a as G,o as i,g as A,f as s,b as e,ac as v,k as B,e as l,c as d,a8 as O,ad as h,C as g,F as T,p as K,D as E,aA as L,G as V,af as M}from"./index-WEYjfviR.js";import{_ as P}from"./AppSelect.vue_vue_type_script_setup_true_lang-B4bOJrVh.js";import{V as x,a as y}from"./VRow-D59lUUrL.js";import{V as m}from"./VGrid-DDsKsHMS.js";import{V as D,c as H}from"./VCard-6Fjj8wGG.js";import{V as J}from"./VImg-CEO3XFy-.js";import{V as Q}from"./VSpacer-uJdlUf9D.js";const W={class:"flex"},X={class:"w-full h-auto relative"},Y={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},ee=l("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquí. ",-1),ae=l("span",{class:"text-disabled"},"o",-1),se={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},te={class:"mt-2"},oe={class:"clamp-text text-wrap"},le={key:0,class:"mt-2"},re=l("span",null,"Cargando...",-1),ne={key:1,class:"mt-2 text-success"},ie=l("span",null,"¡Archivo cargado exitosamente!",-1),de=[ie],ue={key:2,class:"mt-2 text-danger"},ce=l("span",null,"Error al cargar el archivo",-1),fe=[ce],ke=U({__name:"DragAndDrop",setup(pe){const k=c(),C=c(),r=c([]),{open:q,onChange:I}=Z({});function N(o){o==null||o.forEach(t=>{if(console.log("file",t),t.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}r.value.push({file:t,url:w(t).value??"",progress:void 0,status:"pending"})})}I(o=>{if(o)for(const t of o)r.value.push({file:t,url:w(t).value??"",progress:void 0,status:"pending"})}),F(C,N);const j=async()=>{var t,p;const o=await((t=k.value)==null?void 0:t.validate());if(o!=null&&o.valid){if(r.value.length===0){alert("No hay archivos para guardar");return}f.value=!0;for(let u=0;u<r.value.length;u++){const a=r.value[u];a.status="uploading";try{const n=new FormData;n.append("file",a.file),n.append("field",_.value);const{data:b,response:S}=await M("/savefiles").post(n);(p=S.value)!=null&&p.ok&&b.value&&(a.status="completed",a.progress=100,console.log(`Archivo ${a.file.name} guardado correctamente`))}catch(n){a.status="failed",a.progress=void 0,console.error("Error al guardar el archivo",a.file.name,n),alert(`Error al guardar el archivo ${a.file.name}`)}}f.value=!1}},f=c(!1),_=c(),z=[{title:"Foto",value:"photo"},{title:"Boletín",value:"boletin"}];return(o,t)=>{const p=P,u=G("IconBtn");return i(),A(D,{class:"mb-6",title:"Archivos"},{default:s(()=>[e(m,null,{default:s(()=>[e($,{ref_key:"formValidation",ref:k,onSubmit:v(()=>{},["prevent"])},{default:s(()=>[e(x,null,{default:s(()=>[e(y,{cols:"12",md:"6"},{default:s(()=>[e(p,{requiredField:!0,label:"Campo",items:z,modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),rules:["requiredValidator"in o?o.requiredValidator:B(R)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(m,null,{default:s(()=>[l("div",W,[l("div",X,[l("div",{ref_key:"dropZoneRef",ref:C,class:"cursor-pointer",onClick:t[2]||(t[2]=()=>B(q)())},[r.value.length===0?(i(),d("div",Y,[e(u,{variant:"tonal",class:"rounded-sm"},{default:s(()=>[e(O,{icon:"tabler-upload"})]),_:1}),ee,ae,e(h,{variant:"tonal"},{default:s(()=>[g("Explorar archivos")]),_:1})])):(i(),d("div",se,[e(x,{class:"match-height w-100"},{default:s(()=>[(i(!0),d(T,null,K(r.value,(a,n)=>(i(),A(y,{key:n,cols:"12",sm:"4"},{default:s(()=>[e(D,{ripple:!1,border:"",class:"d-flex flex-column"},{default:s(()=>[e(m,{onClick:t[1]||(t[1]=v(()=>{},["stop"]))},{default:s(()=>[e(J,{src:a.url,width:"150px",height:"100px"},null,8,["src"]),l("div",te,[l("span",oe,E(a.file.name),1),l("span",null,E(a.file.size/1e3)+" KB ",1)]),a.status==="uploading"?(i(),d("div",le,[e(L,{size:24,value:a.progress,color:"primary"},null,8,["value"]),re])):V("",!0),a.status==="completed"?(i(),d("div",ne,de)):V("",!0),a.status==="failed"?(i(),d("div",ue,fe)):V("",!0)]),_:2},1024),e(Q),e(H,null,{default:s(()=>[e(h,{variant:"outlined",block:"",onClick:v(b=>r.value.splice(n,1),["stop"])},{default:s(()=>[g(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(m,null,{default:s(()=>[e(x,null,{default:s(()=>[e(y,{cols:"12",class:"d-flex justify-center"},{default:s(()=>[e(h,{disabled:f.value,loading:f.value,color:"primary",onClick:j},{default:s(()=>[g(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}});export{ke as _};
