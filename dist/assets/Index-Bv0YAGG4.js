import{_ as pe}from"./ModalQuestion.vue_vue_type_script_setup_true_lang-D9SNDYHe.js";import{r as fe}from"./validators-C4jeh3Yb.js";import{d as ee,r as m,bd as me,be as J,bf as ve,a as ge,h,o as c,f as a,b as e,af as Q,l as o,e as v,c as F,a7 as ae,a9 as S,D as y,F as Z,q as K,aU as R,y as I,E as Y,aI as ye,ae as be,V as he,aa as Ve,Y as we,N as ke,b7 as Ce,ab as xe,ad as G,b6 as De}from"./index-D-B3Y6bN.js";import{_ as oe}from"./AppSelect.vue_vue_type_script_setup_true_lang-ChBFCt2Y.js";import{V as N,b as Ae,a as j}from"./VCard-DOX-owg-.js";import{V as H}from"./VForm-C_LgAls0.js";import{V as b,a as f}from"./VRow-DClxnqCZ.js";import{V}from"./VCardText-CSI-zWXl.js";import{V as Fe}from"./VImg-CbATnCB8.js";import{V as $e}from"./VSpacer-CKGJddaH.js";import{_ as Ee}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-Ca1ni9Sr.js";import{u as Ne}from"./useFileUpload-DFov6PR2.js";import{c as Se}from"./createUrl-BpthdiFz.js";import{b as W}from"./helpers-CiFxscXz.js";import{V as qe}from"./VFileInput-t_HraGXZ.js";import{V as X}from"./VSwitch-CVq-LD7Z.js";import{V as Ue}from"./VDivider-BDuFbcMr.js";import"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-TPY2zCiM.js";import"./VDialog-BqIMSebF.js";import"./dialog-transition-C_MzqWLQ.js";import"./VSelect-B1lBZF6L.js";import"./VTextField-BgKJCdm0.js";/* empty css                   */import"./VCounter-CFz81t17.js";import"./VList-B5u8dM2Y.js";import"./ssrBoot-B0h8wzj8.js";import"./VAvatar-CgTtSMK2.js";import"./VMenu-B1_tQ2QR.js";import"./VCheckboxBtn-BHPBMDG2.js";import"./VSelectionControl-DL0p7_yN.js";import"./VChip-DMXltytW.js";/* empty css              */import"./filter-DbAUetCK.js";import"./sweetalert2.esm.all-DV3w3JmD.js";import"./index-0F-JFElI.js";import"./constants-2GBt7OCP.js";const ze={class:"flex"},Be={class:"w-full h-auto relative"},Re={key:0,class:"d-flex flex-column justify-center align-center gap-y-3 px-6 py-10 border-dashed drop-zone"},Ie=v("div",{class:"text-base text-high-emphasis font-weight-medium"}," Arrastra y suelta tu archivo aquÃ­. ",-1),Me=v("span",{class:"text-disabled"},"o",-1),Pe={key:1,class:"d-flex justify-center align-center gap-3 pa-8 border-dashed drop-zone flex-wrap"},je={class:"mt-2"},Oe={class:"clamp-text text-wrap"},Te={key:0,class:"mt-2"},Le=v("span",null,"Cargando...",-1),Qe={key:1,class:"mt-2 text-success"},Ge=v("span",null,"Â¡Archivo cargado exitosamente!",-1),Ze=[Ge],Ke={key:2,class:"mt-2 text-danger"},Ye=v("span",null,"Error al cargar el archivo",-1),He=[Ye],Je=ee({__name:"DragAndDrop",setup(le){const P=m(),w=m(),_=m([]),{open:$,onChange:t}=me({});function g(p){p==null||p.forEach(d=>{if(d.type.slice(0,6)!=="image/"){alert("Only image files are allowed");return}_.value.push({file:d,url:J(d).value??"",progress:void 0,status:"pending"})})}t(p=>{if(p)for(const d of p)_.value.push({file:d,url:J(d).value??"",progress:void 0,status:"pending"})}),ve(w,g);const C=async()=>{var d,x;const p=await((d=P.value)==null?void 0:d.validate());if(p!=null&&p.valid){if(_.value.length===0){alert("No hay archivos para guardar");return}q.value=!0;for(let D=0;D<_.value.length;D++){const u=_.value[D];u.status="uploading";try{const k=new FormData;k.append("file",u.file),k.append("field",U.value);const{data:M,response:O}=await R("/savefiles").post(k);(x=O.value)!=null&&x.ok&&M.value&&(u.status="completed",u.progress=100,console.log(`Archivo ${u.file.name} guardado correctamente`))}catch(k){u.status="failed",u.progress=void 0,console.error("Error al guardar el archivo",u.file.name,k),alert(`Error al guardar el archivo ${u.file.name}`)}}q.value=!1}},q=m(!1),U=m(),E=[{title:"Foto",value:"photo"},{title:"BoletÃ­n",value:"boletin"}];return(p,d)=>{const x=oe,D=ge("IconBtn");return c(),h(N,{class:"mb-6",title:"Archivos"},{default:a(()=>[e(V,null,{default:a(()=>[e(H,{ref_key:"formValidation",ref:P,onSubmit:Q(()=>{},["prevent"])},{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",md:"6"},{default:a(()=>[e(x,{requiredField:!0,label:"Campo",items:E,modelValue:U.value,"onUpdate:modelValue":d[0]||(d[0]=u=>U.value=u),rules:["requiredValidator"in p?p.requiredValidator:o(fe)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(V,null,{default:a(()=>[v("div",ze,[v("div",Be,[v("div",{ref_key:"dropZoneRef",ref:w,class:"cursor-pointer",onClick:d[2]||(d[2]=()=>o($)())},[_.value.length===0?(c(),F("div",Re,[e(D,{variant:"tonal",class:"rounded-sm"},{default:a(()=>[e(ae,{icon:"tabler-upload"})]),_:1}),Ie,Me,e(S,{variant:"tonal"},{default:a(()=>[y("Explorar archivos")]),_:1})])):(c(),F("div",Pe,[e(b,{class:"match-height w-100"},{default:a(()=>[(c(!0),F(Z,null,K(_.value,(u,k)=>(c(),h(f,{key:k,cols:"12",sm:"4"},{default:a(()=>[e(N,{ripple:!1,border:"",class:"d-flex flex-column"},{default:a(()=>[e(V,{onClick:d[1]||(d[1]=Q(()=>{},["stop"]))},{default:a(()=>[e(Fe,{src:u.url,width:"150px",height:"100px"},null,8,["src"]),v("div",je,[v("span",Oe,Y(u.file.name),1),v("span",null,Y(u.file.size/1e3)+" KB ",1)]),u.status==="uploading"?(c(),F("div",Te,[e(ye,{size:24,value:u.progress,color:"primary"},null,8,["value"]),Le])):I("",!0),u.status==="completed"?(c(),F("div",Qe,Ze)):I("",!0),u.status==="failed"?(c(),F("div",Ke,He)):I("",!0)]),_:2},1024),e($e),e(Ae,null,{default:a(()=>[e(S,{variant:"outlined",block:"",onClick:Q(M=>_.value.splice(k,1),["stop"])},{default:a(()=>[y(" Eliminar archivo ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]))],512)])])]),_:1}),e(V,null,{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(S,{disabled:q.value,loading:q.value,color:"primary",onClick:C},{default:a(()=>[y(" Guardar archivos ")]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1})]),_:1})}}}),We=v("b",{class:"text-warning"},"*",-1),Xe={class:"demo-space-x"},ea={class:"demo-space-x"},aa={class:"demo-space-x"},Ia=ee({__name:"Index",setup(le){const P=be(),w=he(),{toast:_}=De(),$=m(Ne());$.value.allowedExtensions=["xls","xlsx"];const t=Ve({form:!1,download_notes:!1,block_uploading_of_grades_to_teachers:!1,viewing_notes:!1}),g=m({company_id:null,type_education_id:null,teacher_id:null,archive:null}),C=m({}),q=m(),U=m(),E=m([]),p=m([]),d=m(!1),x=m({}),D=s=>!!s||"Campo requerido",u=async()=>{var l;g.value.archive=$.value.imageFile,g.value.company_id=w.company.id;const s=await((l=q.value)==null?void 0:l.validate());if(s!=null&&s.valid){const i=new FormData;i.append("company_id",String(g.value.company_id)),i.append("user_id",String(w.user.id)),i.append("type_education_id",String(g.value.type_education_id)),i.append("teacher_id",String(g.value.teacher_id||"")),i.append("archive",g.value.archive),t.form=!0;try{console.log("ðŸ“¤ [FORM] Enviando formulario...");const{data:n,response:A}=await G("note-store").post(i);console.log("ðŸ“¥ [FORM] Respuesta del servidor:",n.value),A.status==200&&n?n.status==="success"?(console.log("ðŸš€ [FORM] Iniciando loading para batch_id:",n.batch_id),P.startLoading(n.batch_id)?(_("ImportaciÃ³n iniciada correctamente","","success"),g.value={company_id:w.company.id,type_education_id:null,teacher_id:null,archive:null},$.value.clearData()):_("Error iniciando la importaciÃ³n","","danger")):n.status==="error"&&(_("Error en la importaciÃ³n",n.message,"danger"),n.errors&&(C.value=n.errors)):_("Error en la respuesta del servidor","","danger")}catch(n){console.error("âŒ [FORM] Error en submitForm:",n),_("Error al procesar el archivo","","danger")}finally{t.form=!1}}else _("Faltan Campos Por Diligenciar","","danger")},k=async()=>{t.form=!0;const{data:s,response:l}=await G("note-dataForm").get({params:{company_id:w.company.id}});l.status==200&&s&&(E.value=s.typeEducations,d.value=s.blockData,p.value=s.teachers),t.form=!1},M=s=>!0,O=async()=>{var i;const{data:s,response:l}=await R("/type_educations/visualization/show").get();(i=l.value)!=null&&i.ok&&s.value&&(x.value=s.value.selectedNotes)},z=m({type_education_id:null}),te=async()=>{var l,i;const s=await((l=U.value)==null?void 0:l.validate());if(s!=null&&s.valid){t.download_notes=!0;const n=E.value.find(r=>r.value==z.value.type_education_id),{data:A,response:B}=await R(Se("/note-downloadAllConsolidated",{query:{type_education_id:z.value.type_education_id,company_id:w.company.id}}));t.download_notes=!1,(i=B.value)!=null&&i.ok&&A.value&&W(A.value.excel,"Consolidado "+(n==null?void 0:n.title))}else _("Faltan Campos Por Diligenciar","","danger")},se=async()=>{var l;const s=await((l=U.value)==null?void 0:l.validate());if(s!=null&&s.valid){t.download_notes=!0;const i=E.value.find(B=>B.value==z.value.type_education_id),{response:n,data:A}=await G("/note-downloadConsolidatedPocentage").get({params:{type_education_id:z.value.type_education_id,company_id:w.company.id}});t.download_notes=!1,A.code==200&&W(A.excel,"Consolidado porcentajes "+(i==null?void 0:i.title))}else _("Faltan Campos Por Diligenciar","","danger")},ne=async s=>{var n;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:i}=await R("/note-blockPayrollUpload").post({value:s});(n=i.value)!=null&&n.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},re=async s=>{var n;t.block_uploading_of_grades_to_teachers=!0;const{data:l,response:i}=await R("/note-resetOptionDownloadPdf").post({company_id:w.company.id});(n=i.value)!=null&&n.ok&&l.value,t.block_uploading_of_grades_to_teachers=!1},ie=we(()=>d.value?"SÃ­":"No"),de=async()=>{t.viewing_notes=!0;const{data:s,response:l}=await R("/type_educations/visualization/store").post({selectedNotes:x.value});t.viewing_notes=!1},T=m(),ue=()=>{T.value.openModal(),T.value.componentData.title="Esta seguro que desea activar a todos los estudiantes en un estado insolventes"};return ke(async()=>{await O(),console.log("ðŸš€ [PAGE] Component mounted - Queue system enabled"),await k()}),(s,l)=>{const i=oe,n=Ee,A=Je,B=pe;return c(),F("div",null,[(c(),h(N,{key:0,disabled:o(t).form,loading:o(t).form},{default:a(()=>[e(j,{"primary-title":""},{default:a(()=>[y(" Cargar Notas ")]),_:1}),e(V,null,{default:a(()=>[e(o(H),{ref_key:"formValidation",ref:q,"lazy-validation":""},{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[e(i,{clearable:"",modelValue:o(g).type_education_id,"onUpdate:modelValue":l[0]||(l[0]=r=>o(g).type_education_id=r),rules:[D],"error-messages":o(C).type_education_id,label:"Tipo",onChange:l[1]||(l[1]=r=>o(C).type_education_id=""),requiredField:!0,items:o(E)},null,8,["modelValue","rules","error-messages","items"])]),_:1}),e(f,{cols:"12",sm:"4"},{default:a(()=>[e(Ce,null,{default:a(()=>[y("ArchivoÂ "),We]),_:1}),(c(),h(qe,{key:o($).key,onChange:o($).handleImageSelected,"onClick:clear":o($).clearData,rules:[D]},null,8,["onChange","onClick:clear","rules"]))]),_:1}),e(f,{cols:"12",sm:"4"},{default:a(()=>[e(n,{clearable:"",modelValue:o(g).teacher_id,"onUpdate:modelValue":l[2]||(l[2]=r=>o(g).teacher_id=r),"error-messages":o(C).teacher_id,label:"Docente",onChange:l[3]||(l[3]=r=>o(C).teacher_id=""),items:o(p)},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(b,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(S,{loading:o(t).form,color:"primary",onClick:l[4]||(l[4]=r=>u())},{default:a(()=>[e(ae,{start:"",icon:"tabler-upload"}),y(" Cargar Archivo ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),(c(),h(N,{key:1,disabled:o(t).download_notes,loading:o(t).download_notes,class:"mt-3"},{default:a(()=>[e(j,{"primary-title":""},{default:a(()=>[y("Descargar Notas")]),_:1}),e(V,null,{default:a(()=>[e(o(H),{ref_key:"formValidationDownload",ref:U,"lazy-validation":""},{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[e(i,{clearable:"",modelValue:o(z).type_education_id,"onUpdate:modelValue":l[5]||(l[5]=r=>o(z).type_education_id=r),rules:[D],"error-messages":o(C).type_education_id,label:"Tipo",onChange:l[6]||(l[6]=r=>o(C).type_education_id=""),requiredField:!0,items:o(E)},null,8,["modelValue","rules","error-messages","items"])]),_:1})]),_:1}),e(b,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-start gap-3 flex-wrap mt-5"},{default:a(()=>[e(S,{loading:o(t).download_notes,disabled:o(t).download_notes,color:"primary",onClick:l[7]||(l[7]=r=>te())},{default:a(()=>[y(" Descargar Consolidado ")]),_:1},8,["loading","disabled"]),o(z).type_education_id=="3"?(c(),h(S,{key:0,loading:o(t).download_notes,disabled:o(t).download_notes,color:"primary",onClick:l[8]||(l[8]=r=>se())},{default:a(()=>[y(" Descargar Reporte % ")]),_:1},8,["loading","disabled"])):I("",!0)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["disabled","loading"])),e(b,null,{default:a(()=>[e(f,{cols:"4"},{default:a(()=>[M("note.block_uploading_of_grades_to_teachers")?(c(),h(N,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(j,{"primary-title":""},{default:a(()=>[y("Bloquear carga de notas a los profesores")]),_:1}),e(V,null,{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[v("div",Xe,[e(X,{modelValue:o(d),"onUpdate:modelValue":[l[9]||(l[9]=r=>xe(d)?d.value=r:null),l[10]||(l[10]=r=>ne(r))],label:o(ie),color:"success"},null,8,["modelValue","label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):I("",!0)]),_:1}),e(f,{cols:"4"},{default:a(()=>[M("note.reset_option_download_pdf")?(c(),h(N,{key:0,disabled:o(t).block_uploading_of_grades_to_teachers,loading:o(t).block_uploading_of_grades_to_teachers,class:"mt-3"},{default:a(()=>[e(j,{"primary-title":""},{default:a(()=>[y("Reiniciar opciÃ³n descarga pdf y boletin")]),_:1}),e(V,null,{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",sm:"4"},{default:a(()=>[v("div",ea,[e(S,{color:"primary",onClick:ue},{default:a(()=>[y("Reiniciar")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])):I("",!0)]),_:1})]),_:1}),(c(),h(N,{key:2,disabled:o(t).viewing_notes,loading:o(t).viewing_notes,class:"mt-3",title:"VisualizaciÃ³n de las notas"},{default:a(()=>[(c(!0),F(Z,null,K(o(E),r=>(c(),h(V,{key:r.value},{default:a(()=>[e(Ue),e(b,null,{default:a(()=>[e(f,null,{default:a(()=>[v("span",null,Y(r.title),1)]),_:2},1024)]),_:2},1024),e(b,null,{default:a(()=>[(c(!0),F(Z,null,K(r.cantNotes,(L,ce)=>(c(),h(f,{cols:"12",sm:"4",key:ce},{default:a(()=>[v("div",aa,[e(X,{modelValue:o(x)[r.value]["note_"+L],"onUpdate:modelValue":_e=>o(x)[r.value]["note_"+L]=_e,label:"Nota "+L,color:"success"},null,8,["modelValue","onUpdate:modelValue","label"])])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128)),e(V,null,{default:a(()=>[e(b,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex justify-center"},{default:a(()=>[e(S,{loading:o(t).form,disabled:o(t).form,color:"primary",onClick:l[11]||(l[11]=r=>de())},{default:a(()=>[y(" Guardar VisualizaciÃ³n ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["disabled","loading"])),(c(),h(N,{key:3,title:"Carga de archivos masivos",class:"mt-3"},{default:a(()=>[e(V,null,{default:a(()=>[e(A)]),_:1})]),_:1})),e(B,{ref_key:"refModalQuestion",ref:T,onSuccess:re},null,512)])}}});export{Ia as default};
